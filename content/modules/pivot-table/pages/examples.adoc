= 示例

[[creating-pivottable-with-data-from-entity]]
== 使用实体数据创建透视表

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=pivottable-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

本章节我们将创建一个 `PivotTable`，数据从实体获取，所以必须定义 `dataContainer` 属性。

[[from-entity-creating-entity]]
=== 创建实体

首先，我们创建下列枚举类型：

* `Sex`，值为：`MALE`、`FEMALE`
* `Day`，值为 `SUN`、`MON`、`TUE`、`WED`、`THU`、`FRI`、`SAT`
* `Time`，值为 `DINNER`、`LUNCH`

下面创建 `TipInfo` 实体类，具有下列属性：

//* `row` of the type `Integer`
* `totalBill`，类型为：`Double`
* `tip`，类型为：`Double`
* `sex`，类型为枚举：`Sex` 
* `smoker`，类型为：`Boolean`
* `day`，类型为枚举：`Day`
* `time`，类型为枚举：`Time`
* `size`，类型为：`Integer`

`TipInfo` 实体创建完成。

[[from-entity-screen-xml-descriptor]]
=== 界面 xml 描述

创建一个新的空界面 `pivot-sample-screen`，将 XML 的内容替换为下列代码：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/pivottable/ex1/screen/example/pivot-sample-screen.xml[tags=pivot-table]
----

[[from-entity-screen-controller]]
=== 界面控制器

打开 `PivotSampleScreen` 界面控制器，将内容替换为下列代码：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/pivottable/ex1/screen/example/PivotSampleScreen.java[tags=pivot-table]
----

[[from-entity-result]]
=== 结果

应用程序中打开界面如下：

image::pivot-sample-screen.png[align="center"]

[[custom-aggregator-and-derived-properties]]
== 自定义聚合器和派生属性

下面 `pivotTable` 示例与 <<creating-pivottable-with-data-from-entity,上面示例>> 的不同之处在于，使用了自定义的聚合器以及在界面控制器中添加了派生属性。

[[agregator-xml-descriptor]]
=== 界面 XML 描述

示例中，我们将排序函数移至界面控制器，因此 XML 如下：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/pivottable/ex1/screen/example/pivot-sample.xml[tags=pivot-table]
----

[[agragator-screen-controller]]
=== 界面控制器

可以在 XML 描述或界面控制器中设置排序和聚合函数。在此例中，JavaScript 函数作为参数传递给 `JsFunction` 类的构造器。

派生属性也可以在界面控制器中定义。

[source,java,indent=0]
----
include::example$/ex1/src/main/java/pivottable/ex1/screen/example/PivotSample.java[tags=pivot-table1;pivot-table2;pivot-table3]
----

[[agregator-result]]
=== 结果

应用程序中打开界面如下：

image::pivot-sample.png[align="center"]

[[editable-pivot-table]]
== 可编辑的透视表

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=pivottable-editable" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

该示例中，让 `pivotTable` xref:pivot-table:elements.adoc#editable[可编辑] 并设置默认聚合函数。在可编辑模式下，可以直接在 UI 中更改外观（图表类型）和表格内容（行和列）。

应用程序中可编辑的透视表如下：

image::editable-pivot-table.png[align="center"]

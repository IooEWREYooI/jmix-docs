= Универсальный JavaScriptComponent

++++
<div class="backoffice-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=java-script-component-time-picker" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

`JavaScriptComponent` – это простой компонент пользовательского интерфейса, который представляет собой универсальную обертку для использования любой готовой библиотеки JavaScript в приложении на базе Jmix напрямую, без необходимости подключать компонент Vaadin.

Компонент можно использовать в XML-дескрипторе экрана, чтобы декларативно настраивать динамические свойства и зависимости JavaScript.

XML-имя компонента: `jsComponent`.

== Определение зависимостей

Вы можете задать для компонента несколько зависимостей (JavaScript, CSS). Каждая зависимость должна соответствовать одному из следующих источников:

* Ресурс WebJar - начинается с `webjar://`.
* Файл, расположенный в локальном каталоге VAADIN, начинается с `vaadin://`.
* Веб-ресурс — начинается с `http://` или `https://`.

[[element-dependencies]]
Список зависимостей определяется в элементе `dependencies`. Каждая зависимость описывается во вложенном элементе `dependency`.

[[dependency-path]]
Укажите путь зависимости в атрибуте `path`.

Пример определения зависимостей в XML:

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/components/javascript/java-script-component-sample.xml[tags=js-component]
----

[[dependency-type]]
Если тип зависимости нельзя вывести из расширения, укажите тип явно в XML-атрибуте `type`.

Зависимость можно добавить программно, используя метод `addDependency()`. Чтобы указать тип зависимости, передайте методу `DependencyType` значение перечисления `addDependency()`.

Пример добавления зависимостей программно:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/components/javascript/JavaScriptComponentSample.java[tags=add-dependencies]
----

[[init-function-name]]
== Определение функции инициализации

Для компонента необходимо задать функцию инициализации. Имя этой функции будет использовано JavaScript-коннектором для поиска точки входа.

[CAUTION]
====
В пределах окна имя функции инициализации должно быть уникальным.
====

Укажите имя функции в атрибуте `initFunctionName` компонента `jsComponent`.

Имя функции можно передать в компонент с помощью метода `setInitFunctionName()`:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/components/javascript/JavaScriptComponentSample.java[tags=set-init-function-name]
----

== Определение JavaScript-коннектора

Чтобы использовать компонент `JavaScriptComponent` для подключения библиотеки JavaScript, вам необходимо создать JavaScript-коннектор – функцию, которая будет инициализировать компонент JavaScript и управлять коммуникацией между сервером и кодом JavaScript.

Из функции коннектора доступны следующие методы:

* `this.getElement()` возвращает HTML DOM элемент компонента.
* `this.getState()` возвращает распределенный объект состояния с текущим состоянием компонента как синхронизируемый объект с серверной стороны.

== Возможности компонентов

Ниже перечислены возможности компонента `JavaScriptComponent`, которые позволяют следующее:

* Задать объект состояния, который можно использовать в коннекторе на стороне клиента и который будет доступен в поле `data` состояния компонента, к примеру:
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/components/javascript/JavaScriptComponentSample.java[tags=state]
----
* Зарегистрировать функцию, которая может быть вызвана из кода JavaScript по указанному имени, например:
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/components/javascript/JavaScriptComponentSample.java[tags=register-function]
----
* Вызвать именованную функцию, которую JavaScript-коннектор добавил к объекту-обертке коннектора.
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/components/javascript/JavaScriptComponentSample.java[tags=call-function]
----
+
[source,js,indent=0]
----
include::example$/ex1/src/main/resources/VAADIN/timepicker/time-picker-connector.js[tags=function]
----

== Использование JavaScriptComponent
В этом разделе описан пример интеграции сторонней JavaScript-библиотеки в приложение на основе Jmix на примере https://quilljs.com/[Quill Rich Text Editor^]. Чтобы использовать Quill в своем проекте, необходимо выполнить шаги, описанные ниже.

////
This section describes integrating a third-party JavaScript library to a Jmix-based application taking http://ericjgagnon.github.io/wickedpicker/[Wickedpicker^] - a simple jQuery timepicker plugin. To use Wickedpicker in your project, you should follow the steps below.
////

. Добавьте следующую зависимость в файл `build.gradle`:
+
[source,gradle,indent=0]
----
include::example$/ex1/build.gradle[tags=quill]
----

. Создайте файл `quill-connector.js` в каталоге `src/main/resources/VAADIN/quill`.
. Добавьте в этот файл код реализации коннектора:
+
[source,js,indent=0]
----
include::example$/ex1/src/main/resources/VAADIN/quill/quill-connector.js[]
----
<1> Обработка изменений со стороны сервера.
<2> Подписка на событие `textChange`.

. Создайте экран с описанием компонента `jsComponent`:
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/components/javascript/rich-text-editor-screen.xml[]
----

. Контроллер этого экрана включает в себя следующую реализацию:
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/components/javascript/RichTextEditorScreen.java[tags=rich-text-editor-screen]
----

В результате компонент Quill Rich Text Editor доступен на экране:

image::custom-components/java-script-component.png[align="center"]

[[xml]]
== Все XML-атрибуты

include::../vcl/xml-studio-tip.adoc[]

xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
<<init-function-name,initFunctionName>> -
xref:vcl/xml.adoc#required-indicator-visible[requiredIndicatorVisible] -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

[[xml-js-component-elements]]
=== XML-элементы JavaScriptComponent

<<element-dependencies,dependencies>>

[[xml-dependency-attributes]]
=== XML-атрибуты зависимостей

<<dependency-path,path>> -
<<dependency-type,type>>

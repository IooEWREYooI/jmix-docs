= Создание и использование дополнения с виджетами

Дополнение с виджетами предоставляет настраиваемые компоненты UI для их повторного использования в разных приложениях.

Должны быть соблюдены следующие условия:

* JAR-файл содержит `DemoaddonWidgets.gwt.xml`.
* В манифесте JAR указан путь к `*.gwt.xml`:
+
[source,gradle,indent=0]
----
jar {
    // pack client Java sources
    with copySpec {
        from sourceSets.main.allJava
        include "com/company/demoaddon/**"
        duplicatesStrategy = DuplicatesStrategy.WARN
    }
    // register exported widgetset
    manifest {
        attributes(['Vaadin-Widgetsets': 'com.company.demoaddon.DemoaddonWidgets',
                    'Vaadin-Stylesheets': 'VAADIN/addons/demoaddon/demoaddon.scss'])
    }
}
----

Набор виджетов будет сгенерирован автоматически на основе всех JAR-файлов с ключом *Vaadin-Widgetsets* в манифесте. Это обеспечивает удобство использования дополнений Vaadin.

Компилировать виджеты в дополнениях не нужно.

[[creating-widgets-add-on]]
== Создание дополнения с виджетами с помощью Studio

Следуйте данной инструкции, чтобы создать дополнение с виджетами с помощью Studio:

. Создайте новый проект. Выберите шаблон *UI Widgets Add-On*. Введите название проекта, например, `"demoaddon"`. Это будет простой Java-проект со следующей структурой:
+
image::custom-components/widgets-add-on-prj-structure.png[align="center"]
+
Jmix Studio предоставляет пример дополнения с виджетами на основе xref:ui:custom-components/custom-widget-sets.adoc[GWT-компонента] `ColorButton`. Вы можете создать свой собственный компонент вместо него.
. Откройте файл `demoaddon.scss` и определите xref:ui:themes/theme_addon.adoc[модификации] стиля темы.
. Создайте и опубликуйте дополнение в локальном репозитории maven, используя следующую команду:
+
[source, code,indent=0]
----
./gradlew clean publishToMavenLocal
----

[[using-widgets-add-on]]
== Использование дополнения с виджетами

. Откройте проект, к которому вы хотите применить дополнение с виджетами.
. Создайте xref:themes/custom_theme.adoc[новую тему], названную, например, `helium-extended`.
. Откройте файл `build.gradle` и внесите следующие изменения:
* Добавить `mavenLocal()` в репозитории.
* Удалите зависимость `implementation 'io.jmix.ui:jmix-ui-widgets-compiled'`.
* Добавьте зависимость дополнения к `implementation` проекта и конфигурациям `widgets`, например:
+
[source,gradle,indent=0]
----
implementation 'com.company:demoaddon:0.0.1-SNAPSHOT'
widgets 'com.company:demoaddon:0.0.1-SNAPSHOT'
implementation 'io.jmix.ui:jmix-ui-widgets'
widgets 'io.jmix.ui:jmix-ui-widgets'
----
* Добавьте задачу xref:ui:custom-components/custom-widget-sets.adoc#compile-widgets[compileWidgets] (измените пути в соответствии с базовым пакетом вашего приложения):
+
[source,gradle,indent=0]
----
compileWidgets {
    generate "com.company.sample.widget.CustomWidgetSet"
    includePaths('**/io/jmix/**/widget/**', '**/com/company/sample/widget/**')
}
----
. Добавьте свойство `jmix.ui.widget-set` в файл `application.properties` (настройте местоположение в соответствии с задачей `compileWidgets` выше):
+
[source,properties,indent=0]
----
jmix.ui.widget-set=com.company.sample.widget.CustomWidgetSet
----
. Перезагрузите проект.
. Для демонстрации работы компонента создадим новый `color-button-screen`.
+
Откройте контроллер экрана `ColorButtonScreen.java` и добавьте код размещения компонента на экране:
+
.ColorButtonScreen.java
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/components/colorbutton/ColorButtonScreen.java[tags=color-button-screen]
----
<1> Инициализирует экземпляр компонента `ColorButton`.
<2> Получает ссылку на контейнер Vaadin с помощью метода `unwrap()` и добавляет в него новый компонент.
. Запустите приложение и посмотрите результат:
+
image::custom-components/color-button.png[align="center"]
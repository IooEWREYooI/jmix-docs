= Использование механизма навигации и истории просмотров URL

Этот раздел содержит примеры использования механизма навигации и истории просмотров URL.

Предположим, у нас есть сущность `Event` и экран `EventInfo` с информацией о выбранном событии.

Контроллер экрана `EventInfo` содержит аннотацию `@Route` для указания маршрута к экрану:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/urlhistorynav/EventInfo.java[tags=event-info;event-info-start;event-info-end]
----

В результате пользователь может открыть экран, введя `++http://localhost:8081/#main/event-info++` в адресной строке:

image::url-history-navigation/event-info-route.png[align="center"]

Когда экран открыт, адрес также содержит метку состояния.

[[mapping-state-to-url]]
== Отображение состояния на URL

Предположим, на экране `EventInfo` отображается информация об одном событии и присутствует элемент управления для переключения событий. Вы можете отобразить просматриваемое событие в адресной строке, чтобы иметь возможность скопировать URL, а затем открыть экран для этого конкретного события, вставив URL в адресную строку.

Следующий код реализует отображение выбранного события на URL:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/urlhistorynav/EventInfo.java[tags=event-info;event-info-start;inject-event-field;inject-url-routing;select-btn;event-info-end]
----

<1> Получить текущее событие из `EntityComboBox`.
<2> Удалить параметры URL, если событие не выбрано.
<3> Сериализовать идентификатор события с помощью вспомогательного класса `UrlIdSerializer`.
<4> Заменить текущее состояние URL новым, содержащим в качестве параметра сериализованный идентификатор события.

В результате URL приложения изменяется, когда пользователь выбирает событие и нажимает кнопку *Select Event*:

image::url-history-navigation/event-info-url-change.png[align="center"]

[[url-params-changed-event]]
== UrlParamsChangedEvent

Теперь давайте выполним последнее требование: когда пользователь вводит URL с маршрутом и параметром `event_id`, приложение должно показать экран с соответствующим выбранным событием.

Ниже приведен пример подписки на `UrlParamsChangedEvent` в коде контроллера экрана:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/urlhistorynav/EventInfo.java[tags=url-params-changed-event]
----

<1> Получить значение параметра из `UrlParamsChangedEvent`.
<2> Десериализовать идентификатор события.
<3> Загрузить экземпляр события и установить его в поле.
= 创建自定义主题
:page-aliases: backoffice-ui:themes/custom_theme.adoc

内置主题可以在项目中修改。支持：

* 更换品牌图片。

* 添加图标，以便在可视化组件内使用。参阅下面的 xref:icons.adoc[Icons] 章节。

* 为可视化组件创建新的样式，然后通过 xref:vcl/xml.adoc#stylename[stylename] 属性使用。这一点需要一些 CSS 的专业知识。

* 修改可视化组件的已有样式。

* 修改通用参数，例如，背景色、边距、间距等。

[[creating-theme-using-studio]]
== 用 Studio 创建主题
//== File Structure and Build Scripts

主题定义在 https://sass-lang.com/[SCSS^] 文件中。如需在项目中创建自定义主题，需要在 `src/main/themes/<theme-name>` 文件夹创建特定的文件结构。

使用 Jmix Studio 可以很方便做到这点：右键点击 Jmix 项目窗口中的 *User Interface* 节点，然后选择 *New -> Custom Theme*。输入主题的唯一名称，然后在 *Base theme* 下拉列表中选择想要扩展的主题。

结果会创建下列目录结构（例如，扩展 Helium 主题）：

image::themes/structure.png[align="center"]

资源文件夹下必须有 `<theme-name>-theme.properties` 文件。

`styles.scss` 是主题编译的入口点：

[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/styles.scss[tags=styles]
----

<1> `addons` 是个特殊文件，基于添加的 xref:themes/theme_addon.adoc[主题扩展组件] 自动生成。

编译后的主题位于 `build/themes` 文件夹内，会一并打包至项目的 JAR/WAR 中。

`application.properties` 文件中定义了主题名称和对应的 `<theme-name>-theme.properties` 文件路径：

[source,properties,indent=0]
----
jmix.ui.theme.name = helium-extended
jmix.ui.theme-config = ui/ex1/theme/helium-extended-theme.properties
----

[[customizing-helium-theme]]
== 自定义 Helium 主题

自定义默认 *Helium* 主题最简单的方法是使用 https://demo.jmix.io/helium-editor[在线^] 交互式编辑器。这里可以创建自定义的颜色配置，然后在项目中使用，按照下列步骤：

. 用 Jmix Studio 扩展项目的 Helium 主题：右键点击 Jmix 项目窗口中的 *User Interface* 节点，然后选择 *New -> Custom Theme*。输入主题的新名称，例如，`helium-extended`，然后在 *Base theme* 下拉列表中选择 *helium* 主题。
. 打开线上的 https://demo.jmix.io/helium-editor[主题编辑器^]。这里可以设置样式变量并马上看到调整结果。
. 一旦样式设定满足要求，点击 *Download* 按钮。
. 复制变量定义，放置于 `helium-extended.scss` 文件内，示例：
+
[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/helium-extended.scss[tags=start;helium-extended;end]
----
. 重启应用程序。用户第一次登录后即可查看使用 *Helium-extended* 主题的应用。

[[helium-configuration]]
== Helium 主题预设样式

预设样式（Preset）是颜色的 CSS 变量列表。使用预设样式，你可以将颜色（例如，公司的颜色）集成到应用程序中。

可以创建自定义的预设样式或者使用内置的预设样式。

Helium 主题及其扩展主题带有两套内置的颜色预设样式：*dark* 和 *white*。

.*Departments* 界面使用 *light* 颜色预设样式

image::themes/light-preset.png[align="center"]

.*Departments* 界面使用 *dark* 颜色预设样式

image::themes/dark-preset.png[align="center"]

所有可用的颜色预设样式在 `application.properties` 文件定义：

[source,properties,indent=0]
----
jmix.ui.theme.modes = light, dark
----

默认颜色预设样式为 *light*。

Helium 主题及其扩展主题带有三套内置的尺寸预设样式：*small*、*medium* 和 *large*。

所有可用的主题尺寸预设样式在 `application.properties` 文件定义：

[source,properties,indent=0]
----
jmix.ui.theme.sizes = small, medium, large
----

默认尺寸预设样式为 *medium*。

下面我们创建一个新的颜色预设样式 - *cobalt*。

. 用 Jmix Studio 扩展项目的 Helium 主题：右键点击 Jmix 项目窗口中的 *User Interface* 节点，然后选择 *New -> Custom Theme*。输入主题的新名称，例如，`helium-ext`，然后在 *Base theme* 下拉列表中选择 *helium* 主题。
. 定义变量，并放置于 `helium-ext.scss` 文件内，示例：
+
[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-ext/helium-ext.scss[tags=helium-start;cobalt;helium-end;helium-cobalt]
----
. 在 `application.properties` 文件中定义新的颜色预设样式，并设为默认：
+
[source,properties,indent=0]
----
jmix.ui.theme.modes = light, dark, cobalt
jmix.ui.theme.default-mode-to-use = cobalt
----
. 重启应用程序。用户第一次登录后即可查看使用 *cobalt* 预设样式 *Helium-ext* 主题的应用。

.*Departments* 界面使用 *cobalt* 颜色预设样式

image::themes/cobalt-preset.png[align="center"]

[[changing-branding]]
== 更改品牌

可以配置品牌相关的属性，例如，图标、登录界面、主程序窗口标题、网站图标（`favicon.ico`）。

如需使用自定义图片，可以替换 `src/main/themes/<theme-name>/branding` 目录中的默认图片。

要设置窗口标题和登录窗口欢迎文本，请在 `messages.properties` 中设置。更新消息值内容反映应用程序的不同用途。示例：

[source,properties,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/messages.properties[tags=change-messages;change-messages2]
----

[[adding-fonts]]
== 添加字体

可以为主题添加自定义字体。添加一个 Font Family，在 `styles.scss` 文件的第一行导入，示例：

[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/styles.scss[tags=import-font]
----

如需替换项目中的标准字体，可在 `<theme-name>-defaults.scss` 文件中设置自定义字体：

[source, css,indent=0]
----
$v-font-family: 'Roboto';
----

[[creating-new-styles]]
== 创建新样式

考虑为显示客户名称的文本组件设置黄色背景颜色的示例。

在 XML 描述中，定义了 xref:vcl/components/text-field.adoc[TextField] 组件：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/textfield/textField-screen.xml[tags=stylename-text-field]
----

在 xref:vcl/xml.adoc#stylename[stylename] 属性中，设置样式的名称。

在 `<theme-name>.scss` 文件中的 `<theme-name>` mixin 内添加新的样式定义：

[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/helium-extended.scss[tags=start;name-field;end]
----

重建项目后，组件将如下所示：

image::themes/stylename.png[align="center"]

[[modifying-existing-styles]]
== 修改现有样式

要修改现有组件的样式参数，请将相应的 CSS 代码添加到 `<theme-name>.scss` 文件的 `<theme-name>` mixin 中。使用 Web 浏览器的开发者工具查找分配给可视化组件元素的 CSS 类。例如，要以粗体显示应用程序菜单项，`<theme-name>.scss` 文件的内容应如下所示：

[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/helium-extended.scss[tags=start;modify-style;end]
----

[[theme-modify-common-parameters]]
== 修改通用参数

主题包含许多控制应用程序背景颜色、组件大小、边距和其他参数的 SCSS 变量。

以下是 Halo 主题扩展的示例，因为它基于来自 *Vaadin* 的 https://vaadin.com/valo[Valo^] 主题，并提供最多的自定义选择。

`<theme-name>-defaults.scss` 文件用于覆盖主题变量。大多数 Halo 变量对应于 https://vaadin.com/api/valo/[Valo 文档^] 中描述的变量。以下是最常见的变量：

[source,css,indent=0]
----
$v-background-color: #fafafa;        /* component background color */
$v-app-background-color: #e7ebf2;    /* application background color */
$v-panel-background-color: #fff;     /* panel background color */
$v-focus-color: #3b5998;             /* focused element color */
$v-error-indicator-color: #ed473b;   /* empty required fields color */

$v-line-height: 1.35;                /* line height */
$v-font-size: 14px;                  /* font size */
$v-font-weight: 400;                 /* font weight */
$v-unit-size: 30px;                  /* base theme size, defines the height for buttons, fields and other elements */

$v-font-size--h1: 24px;              /* h1-style Label size */
$v-font-size--h2: 20px;              /* h2-style Label size */
$v-font-size--h3: 16px;              /* h3-style Label size */

/* margins for containers */
$v-layout-margin-top: 10px;
$v-layout-margin-left: 10px;
$v-layout-margin-right: 10px;
$v-layout-margin-bottom: 10px;

/* spacing between components in a container (if enabled) */
$v-layout-spacing-vertical: 10px;
$v-layout-spacing-horizontal: 10px;

/* whether filter search button should have "friendly" style*/
$jmix-filter-friendly-search-button: true;

/* whether button that has primary action or marked as primary itself should be highlighted*/
$jmix-highlight-primary-action: false;

/* basic table and datagrid settings */
$v-table-row-height: 30px;
$v-table-header-font-size: 13px;
$v-table-cell-padding-horizontal: 7px;
$v-grid-row-height
$v-grid-row-selected-background-color
$v-grid-cell-padding-horizontal

/* input field focus style */
$v-focus-style: inset 0px 0px 5px 1px rgba($v-focus-color, 0.5);
/* required fields focus style */
$v-error-focus-style: inset 0px 0px 5px 1px rgba($v-error-indicator-color, 0.5);

/* animation for elements is enabled by default */
$v-animations-enabled: true;
/* popup window animation is disabled by default */
$v-window-animations-enabled: false;

/* inverse header is controlled by cuba.web.useInverseHeader property */
$v-support-inverse-menu: true;

/* show "required" indicators for components */
$v-show-required-indicators: false !default;
----

下面提供了具有深色背景和略微减少边距主题的示例 `<theme-name>-defaults.scss`：

[source, css,indent=0]
----
include::example$/ex1/src/main/themes/halo-extended/halo-extended-defaults.scss[]
----

[[modifying-server-side-theme-parameters]]
== 修改服务端主题参数

可以重定义 `<theme-name>-theme.properties` 文件中的变量，这些变量指定了一些服务端的参数。例如，需要调整 `Filter` 组件中 *Add Condition（添加条件）* 对话框的大小，`<theme-name>-theme.properties` 文件可以包含下列内容：

[source,properties,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/theme/halo-extended-theme.properties[]
----

[[creating-theme-manually]]
== 手动创建主题

我们创建一个 Hover Dark 主题，是内置 Hover 主题的暗色变体。

. 在项目中创建如下文件结构：
+
image::themes/structure-hover-dark.png[align="center"]

. `hover-dark.scss` 文件：
+
[source,css,indent=0]
----
include::example$/ex1/src/main/themes/hover-dark/hover-dark.scss[]
----

. `hover-dark-defaults.scss` 文件：
+
[source,css,indent=0]
----
include::example$/ex1/src/main/themes/hover-dark/hover-dark-defaults.scss[tags=hover-defaults]
----
+
在 `hover-dark-defaults.scss` 文件中重写默认的样式变量；即，用下列变量替换原来的：
+
[source,css,indent=0]
----
include::example$/ex1/src/main/themes/hover-dark/hover-dark-defaults.scss[tags=hover-defaults;hover-dark-defaults]
----

. `styles.scss` 文件：
+
[source,css,indent=0]
----
include::example$/ex1/src/main/themes/hover-dark/styles.scss[]
----

. 在 `src/main/resources/<project package>/theme` 目录创建 `hover-dark-theme.properties` 文件：
+
[source,properties,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/theme/hover-dark-theme.properties[]
----

. 在 `build.gradle` 中定义下面的依赖以构建扩展主题：
+
[source, gradle,indent=0]
----
include::example$/ex1/build.gradle[tags=dependencies;themes-dependency]
----

. 在 `application.properties` 文件中定义主题名称和相应的 `<theme-name>-theme.properties` 文件路径：
+
[source,properties,indent=0]
----
jmix.ui.theme.name = hover-dark
jmix.ui.theme-config = ui/ex1/theme/hover-dark-theme.properties
----

. 重启应用程序。用户第一次登录后即可查看使用 *Hover-dark* 主题的应用。
+
image::themes/hover-dark.png[align="center"]

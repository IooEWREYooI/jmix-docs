= Создание новой темы

Встроенная в фреймворк тема может быть изменена в проекте приложения. В измененной теме можно сделать следующее:

* Изменить изображения для фирменного стиля.

* Добавлять значки для использования в визуальных компонентах. См. следующий раздел xref:icons.adoc[Значки].

* Создавать новые стили для визуальных компонентов и использовать их в атрибуте xref:vcl/xml.adoc#stylename[stylename]. Это требует некоторых знаний CSS.

* Изменять существующие стили компонентов.

* Изменить общие параметры, такие как цвет фона, отступы, промежутки и т.д.

[[creating-theme-using-studio]]
== Создание темы с помощью Studio
//== File Structure and Build Scripts

Темы определяются в файлах https://sass-lang.com/[SCSS^]. Чтобы создать свою тему в проекте, нужно создать определенную файловую структуру в каталоге `src/main/themes/<theme-name>`.

Это удобнее всего делать с помощью Jmix Studio: щелкните правой кнопкой мыши на узле *Backoffice UI* в окне проекта Jmix и выберите *New -> Custom Theme*. Введите уникальное название темы и выберите тему, которую вы хотите расширить, в выпадающем списке *Base theme*.

В результате будет создана следующая структура каталогов (например, для расширения темы Helium):

image::themes/structure.png[align="center"]

Файл `<theme-name>-theme.properties` должен быть расположен в resources.

`styles.scss` - это точка входа для компиляции темы:

[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/styles.scss[tags=styles]
----

<1> `addons` – это специальный файл, который автоматически генерируется на основе добавленных xref:themes/theme_addon.adoc[дополнений с темами].

Скомпилированные темы размещаются в каталоге `build/themes` и будут включены в артефакт JAR/WAR проекта.

Название темы и соответствующий путь к файлу `<theme-name>-theme.properties` определяются в файле `application.properties`:

[source,properties,indent=0]
----
jmix.ui.theme.name = helium-extended
jmix.ui.theme-config = ui/ex1/theme/helium-extended-theme.properties
----

[[recompile-theme]]
[NOTE]
====
Вы можете перекомпилировать тему без перезапуска приложения:

* Откройте окно инструмента *Gradle* В Jmix Studio и дважды щелкните *Tasks* → *web* → *compileThemes*.
* В командной строке используйте следующую команду:
+
[source,code,indent=0]
----
./gradlew compileThemes
----

Затем принудительно перезагрузите страницу.

Например, в Google Chrome это можно сделать нажатием `Shift` + `Ctrl/Cmd` + `R`.
====

[[customizing-helium-theme]]
== Изменение темы Helium

Самый простой способ настроить тему по умолчанию *Helium* – это воспользоваться https://demo.jmix.io/helium-editor[интерактивным онлайн-редактором^]. В нем вы можете создать свой цветовой пресет для использования в проекте. Для этого выполните следующие действия:

. Расширьте тему Helium в вашем проекте с помощью Jmix Studio: щелкните правой кнопкой мыши на узле *Backoffice UI* в окне проекта Jmix и выберите *New -> Custom Theme*. Введите название новой темы, например, `helium-extended`, и выберите тему *helium* в выпадающем списке *Base theme*.
. Откройте https://demo.jmix.io/helium-editor[Редактор темы]. В нем можно поиграть с доступными переменными стиля и сразу увидеть результат.
. Нажмите *Download*, чтобы скачать настроенную вами тему.
. Скопируйте объявления переменных и поместите их в файл `helium-extended.scss`, например:
+
[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/helium-extended.scss[tags=start;helium-extended;end]
----
. Перезапустите приложение. Теперь при первом входе в систему пользователь будет видеть приложение с темой *Helium-extended*.

[[helium-configuration]]
== Пресеты темы Helium

Пресет – это список переменных CSS для определения цветов. С помощью пресетов вы можете изменять цвета своего приложения (например, на фирменные).

Вы можете создать свой пресет или использовать предопределенные.

Тема Helium и ее расширения имеют два предопределенных цветовых пресета: *dark* и *white*.

.Экран *Departments* с пресетом *light*.

image::themes/light-preset.png[align="center"]

.Экран *Departments* с пресетом *dark*.

image::themes/dark-preset.png[align="center"]

Все доступные цветовые пресеты определены в файле `application.properties`:

[source,properties,indent=0]
----
jmix.ui.theme.modes = light, dark
----

Цветовой пресет по умолчанию – *light*.

Тема Helium и ее расширения имеют три предопределенных пресета размера темы: *small*, *medium*, и *large*.

Все доступные пресеты размеров определены в файле `application.properties`:

[source,properties,indent=0]
----
jmix.ui.theme.sizes = small, medium, large
----

Пресет размера темы по умолчанию – *medium*.

Давайте создадим новый цветовой пресет - *cobalt*.

. Расширьте тему Helium в вашем проекте с помощью Jmix Studio: щелкните правой кнопкой мыши на узле *Backoffice UI* в окне проекта Jmix и выберите *New -> Custom Theme*. Введите название новой темы, например, `helium-ext`, и выберите тему *helium* в выпадающем списке *Base theme*.
. Определите объявления переменных и поместите их в файл `helium-ext.scss`, например:
+
[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-ext/helium-ext.scss[tags=helium-start;cobalt;helium-end;helium-cobalt]
----
. Определите новый цветовой пресет в файле `application.properties` и установите его как пресет по умолчанию:
+
[source,properties,indent=0]
----
jmix.ui.theme.modes = light, dark, cobalt
jmix.ui.theme.default-mode-to-use = cobalt
----
. Перезапустите приложение. Теперь при первом входе в систему пользователь будет видеть приложение с темой *Helium-ext* с цветами пресета *cobalt*.

.Экран *Departments* цветовым пресетом *cobalt*.

image::themes/cobalt-preset.png[align="center"]

[[changing-branding]]
== Изменение фирменного стиля

Вы можете настроить такие параметры фирменного стиля (branding), как значки, заголовки окна входа в систему и главного окна, значок вебсайта (`favicon.ico`).

Для использования собственных изображений, замените соответствующие файлы по умолчанию в каталоге `src/main/themes/<theme-name>/branding`.

Чтобы задать текст в окне и текст приветствия в окне входа в систему, измените их в файле "сообщения.свойства". Например:

[source,properties,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/messages.properties[tags=change-messages;change-messages2]
----

[[adding-fonts]]
== Добавление шрифтов

Вы можете добавить в тему собственные шрифты. Для добавления семейства шрифтов импортируйте его в первой строке файла `styles.scss`, например:

[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/styles.scss[tags=import-font]
----

Чтобы заменить стандартный шрифт проекта, задайте свой в файле `<theme-name>-defaults.scss`:

[source, css,indent=0]
----
$v-font-family: 'Roboto';
----

[[creating-new-styles]]
== Создание новых стилей

Рассмотрим пример установки желтого цвета фона для поля, отображающего имя клиента.

В XML-дескрипторе экрана определите компонент xref:vcl/components/text-field.adoc[TextField]:

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/textfield/textField-screen.xml[tags=stylename-text-field]
----

В атрибуте xref:vcl/xml.adoc#stylename[stylename] задайте имя стиля.

В файле `<theme-name>.scss` добавьте определение нового стиля в миксин `<theme-name>`:

[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/helium-extended.scss[tags=start;name-field;end]
----

После перезапуска проекта поля будут выглядеть следующим образом:

image::themes/stylename.png[align="center"]

[[modifying-existing-styles]]
== Изменение существующих стилей

Для изменения параметров стиля существующих компонентов необходимо добавить соответствующий код CSS в миксин `<theme-name>` файла `<theme-name>.scss`. Используйте инструменты разработчика вашего веб-браузера, чтобы узнать классы CSS, назначенные элементам визуальных компонентов. Например, для того, чтобы пункты главного меню отображались жирным шрифтом, содержимое файла `<theme-name>.scss` должно быть следующим:

[source, css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/helium-extended.scss[tags=start;modify-style;end]
----

[[theme-modify-common-parameters]]
== Изменение общих параметров

Темы содержат переменные SCSS, которые управляют цветом фона, размерами компонентов, отступами и пр.

Рассмотрим пример расширения темы Halo, так как она основана на теме https://vaadin.com/valo[Valo^] фреймворка *Vaadin*, и предоставляет максимальные возможности настройки.

Файл `<theme-name>-defaults.scss` предназначен для размещения в нем переменных темы. Большинство переменных Halo соответствует описанным в https://vaadin.com/api/valo/[документации по Valo^]. Ниже приведены основные:

[source,css,indent=0]
----
$v-background-color: #fafafa;        /* component background color */
$v-app-background-color: #e7ebf2;    /* application background color */
$v-panel-background-color: #fff;     /* panel background color */
$v-focus-color: #3b5998;             /* focused element color */
$v-error-indicator-color: #ed473b;   /* empty required fields color */

$v-line-height: 1.35;                /* line height */
$v-font-size: 14px;                  /* font size */
$v-font-weight: 400;                 /* font weight */
$v-unit-size: 30px;                  /* base theme size, defines the height for buttons, fields and other elements */

$v-font-size--h1: 24px;              /* h1-style Label size */
$v-font-size--h2: 20px;              /* h2-style Label size */
$v-font-size--h3: 16px;              /* h3-style Label size */

/* margins for containers */
$v-layout-margin-top: 10px;
$v-layout-margin-left: 10px;
$v-layout-margin-right: 10px;
$v-layout-margin-bottom: 10px;

/* spacing between components in a container (if enabled) */
$v-layout-spacing-vertical: 10px;
$v-layout-spacing-horizontal: 10px;

/* whether filter search button should have "friendly" style*/
$jmix-filter-friendly-search-button: true;

/* whether button that has primary action or marked as primary itself should be highlighted*/
$jmix-highlight-primary-action: false;

/* basic table and datagrid settings */
$v-table-row-height: 30px;
$v-table-header-font-size: 13px;
$v-table-cell-padding-horizontal: 7px;
$v-grid-row-height
$v-grid-row-selected-background-color
$v-grid-cell-padding-horizontal

/* input field focus style */
$v-focus-style: inset 0px 0px 5px 1px rgba($v-focus-color, 0.5);
/* required fields focus style */
$v-error-focus-style: inset 0px 0px 5px 1px rgba($v-error-indicator-color, 0.5);

/* animation for elements is enabled by default */
$v-animations-enabled: true;
/* popup window animation is disabled by default */
$v-window-animations-enabled: false;

/* inverse header is controlled by cuba.web.useInverseHeader property */
$v-support-inverse-menu: true;

/* show "required" indicators for components */
$v-show-required-indicators: false !default;
----

Пример файла `<theme-name>-defaults.scss` для темы с темным фоном и немного уменьшенными отступами:

[source, css,indent=0]
----
include::example$/ex1/src/main/themes/halo-extended/halo-extended-defaults.scss[]
----

[[modifying-server-side-theme-parameters]]
== Изменение server-side параметров темы

Вы можете переопределить переменные в файле `<theme-name>-theme.properties`, которые задают некоторые server-side параметры. Например, чтобы изменить размер диалогового окна *Add Condition* компонента `Filter`, файл `<theme-name>-theme.properties` должен содержать следующее:

[source,properties,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/theme/halo-extended-theme.properties[]
----

[[creating-theme-manually]]
== Создание темы вручную

Давайте создадим темную версию стандартной темы Hover – Hover Dark.

. Создайте следующую файловую структуру в вашем проекте:
+
image::themes/structure-hover-dark.png[align="center"]

. Файл `hover-dark.scss`:
+
[source,css,indent=0]
----
include::example$/ex1/src/main/themes/hover-dark/hover-dark.scss[]
----

. Файл `hover-dark-defaults.scss`:
+
[source,css,indent=0]
----
include::example$/ex1/src/main/themes/hover-dark/hover-dark-defaults.scss[tags=hover-defaults]
----
+
Переопределите переменные стиля по умолчанию в файле `hover-dark-defaults.scss`; то есть замените переменные в нем на следующие:
+
[source,css,indent=0]
----
include::example$/ex1/src/main/themes/hover-dark/hover-dark-defaults.scss[tags=hover-defaults;hover-dark-defaults]
----

. Файл `styles.scss`:
+
[source,css,indent=0]
----
include::example$/ex1/src/main/themes/hover-dark/styles.scss[]
----

. Создайте файл `hover-dark-theme.properties` в папке `src/main/resources/<project package>/theme`:
+
[source,properties,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/theme/hover-dark-theme.properties[]
----

. Чтобы скомпилировать расширенную тему, определите следующие зависимости в `build.gradle`:
+
[source, gradle,indent=0]
----
include::example$/ex1/build.gradle[tags=dependencies;themes-dependency]
----

. Определите название темы и соответствующий путь к файлу `<theme-name>-theme.properties` в файле `application.properties`:
+
[source,properties,indent=0]
----
jmix.ui.theme.name = hover-dark
jmix.ui.theme-config = ui/ex1/theme/hover-dark-theme.properties
----

. Перезапустите приложение или <<recompile-theme,перекомпилируйте тему>>. Теперь пользователь будет видеть приложение с темой *Hover-dark* при первом входе в систему:
+
image::themes/hover-dark.png[align="center"]
= RelatedEntities
:page-aliases: backoffice-ui:vcl/components/related-entities.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=relatedentities-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`RelatedEntities - 关联实体` 组件是一个弹窗按钮，其中包含了与表格中显示的实体相关的实体类的下拉列表。当用户选择了需要查看的关联实体类，就会打开一个新的浏览界面，展示该关联实体列表。

image::vcl/components/related-entities.png[align="center"]

组件的 XML 名称：`relatedEntities`。

[[basics]]
== 基本用法

选中的关联实体受用户的实体、实体属性和界面权限机制的控制。

默认情况下，下拉列表中所选类的浏览界面使用约定的格式（`<entity_name>.browse`）定义。当然，也可以在组件中显式指定浏览界面。

[NOTE]
====
关联实体的浏览界面需要包含 xref:vcl/components/filter.adoc[Filter] 组件。
====

在新的浏览界面中会动态创建 xref:vcl/components/filter.adoc#configuration[过滤器配置]，这个过滤器只选择与选中实体相关的记录。

界面 XML 中使用该组件的示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/relatedentities/related-entities-screen.xml[tags=table-start;related-entities;table-end]
----

image::vcl/components/related-entities.gif[align="center"]

== 属性和元素

[[attribute-for]]
`for` 属性是必需的。包含 xref:vcl/components/table.adoc[Table]、xref:vcl/components/data-grid.adoc[DataGrid] 或 xref:vcl/components/tree.adoc[Tree] 组件的标识符。

[[attribute-open-mode]]
`openMode` 属性定义如何打开关联界面。对应 `OpenMode` 枚举类型，可选值：`NEW_TAB`、`THIS_TAB`、`DIALOG`、`NEW_WINDOW`。实体浏览界面默认在当前标签页打开。

[[attribute-exclude]]
可以使用 `exclude` 属性从下拉列表中排除一些关联实体。该属性的值是匹配要排除的引用属性的正则表达式。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/relatedentities/related-entities-screen.xml[tags=table-start;related-entities-exclude;table-end]
----

[[element-property]]
`property` 元素允许显式定义显示在下拉列表中的相关实体。

`property` 元素的属性：

[[property-name]]
* `name` - 必需属性。当前实体的属性名称，这个属性是一个引用类型的属性，引用了关联实体。

[[property-screen]]
* `screen` - 要打开的浏览界面标识符。默认情况下，关联实体打开 `<entity_name>.browse` 格式标识符的界面，例如，`demo_Order.browse`。

[[property-caption]]
* `caption` - 展示在下拉列表中关联实体的自定义名称。

[[property-configuration-name]]
* `configurationName` - 打开界面中 xref:vcl/components/filter.adoc#configuration[过滤器配置] 的自定义名称。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/relatedentities/related-entities-screen.xml[tags=related-entities-property]
----

[TIP]
====
如需在 Jmix Studio 中添加 `property`，可以在界面 XML 或者 *Component Hierarchy* 面板中选择 `RelatedEntities` 组件，然后点击 *Component Inspector* 面板的 xref:studio:screen-designer.adoc#component-inspector-add-button[Add]*->Property Option* 按钮。
====

== 关联实体支撑 API

框架提供了一个不使用 `RelatedEntities` 组件就可以打开关联实体界面的 API：`RelatedEntitiesSupport` 接口和 `RelatedEntitiesBuilder`。

`RelatedEntitiesSupport` 类可以创建 `RelatedEntitiesBuilder`。

[NOTE]
必须为 builder 设置 `MetaClass` 或实体类及其属性或 `MetaProperty`。

用实体类和属性创建界面的示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/relatedentities/related-entities-screen.xml[tags=related-button]
----

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/relatedentities/RelatedEntitiesScreen.java[tags=autowired-related-entities-support;autowired-orders-table;related-click]
----

默认情况下，将打开标准实体浏览界面。`RelatedEntitiesBuilder` 为打开的界面提供了很多方法设置可选参数。例如，下面的代码使用 `uiex1_Customer.browse-filter` id 创建 `Customer` 实体浏览界面，并以对话框模式打开：

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/relatedentities/RelatedEntitiesScreen.java[tags=autowired-related-entities-support;autowired-orders-table;related-btn-click]
----

[[xml]]
== XML 属性

include::../xml-studio-tip.adoc[]

=== RelatedEntities XML 属性

xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#enable[enable] -
<<attribute-exclude,exclude>> -
<<attribute-for,for>> -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
<<attribute-open-mode,openMode>> -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/xml.adoc#tab-index[tabIndex] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

=== RelatedEntities XML 元素

<<element-property,property>>

=== Property XML 属性

<<property-caption,caption>> -
<<property-configuration-name,configurationName>> -
<<property-name,name>> -
<<property-screen,screen>>

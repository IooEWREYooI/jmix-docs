= RelatedEntities

++++
<div class="backoffice-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=relatedentities-simple" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

`RelatedEntities` – это компонент в виде кнопки с выпадающим списком, при нажатии показывающим список классов, связанных с сущностью, экземпляры которой отображаются в таблице. Пользователь выбирает интересующий его класс сущности, после чего открывается новый браузер с экземплярами данной сущности, связанными с выбранными экземплярами в начальной таблице.

image::vcl/components/related-entities.png[align="center"]

XML-имя компонента: `relatedEntities`.

[[basics]]
== Основы

При отборе связанных сущностей для отображения учитываются xref:security:resource-roles.adoc[разрешения] пользователя на открытие экранов, чтение сущностей и чтение атрибутов.

По умолчанию для выбранного в списке класса сущности открывается браузер сущности, определенный по соглашению (`<entity_name>.browse`). Опционально, экран можно явно задать в компоненте.

[NOTE]
====
Экран браузера со списком связанных сущностей должен содержать компонент xref:vcl/components/filter.adoc[Filter].
====

В открытом браузере динамически создается xref:vcl/components/filter.adoc#configuration[конфигурация фильтра], которая выбирает связанные с выбранными сущностями записи.

Пример описания компонента в XML-дескрипторе экрана:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/relatedentities/related-entities-screen.xml[tags=table-start;related-entities;table-end]
----

image::vcl/components/related-entities.gif[align="center"]

== Атрибуты и элементы

[[attribute-for]]
Атрибут `for` является обязательным. Он содержит идентификаторы компонента xref:vcl/components/table.adoc[Table], xref:vcl/components/data-grid.adoc[DataGrid], или xref:vcl/components/tree.adoc[Tree].

[[attribute-open-mode]]
Атрибут `openMode` устанавливает режим открытия браузера. Он соответствует перечислению `OpenMode` со значениями: `NEW_TAB`, `THIS_TAB`, `DIALOG`, `NEW_WINDOW`. По умолчанию браузер открывается в текущей вкладке.

[[attribute-exclude]]
Атрибут `exclude` позволяет исключить определенные связанные сущности из числа отображаемых. В качестве значения указывается регулярное выражение, отбирающее ссылочные атрибуты текущей сущности для исключения.

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/relatedentities/related-entities-screen.xml[tags=table-start;related-entities-exclude;table-end]
----

[[element-property]]
Элемент `property` позволяет явно задать связанную сущность, которая будет отображаться в выпадающем списке.

Атрибуты `property`:

[[property-name]]
* `name` - имя атрибута текущей сущности, ссылающегося на связанную сущность. Атрибут `name` является обязательным.

[[property-screen]]
* `screen` - строковой идентификатор экрана браузера, открывающегося при выборе сущности в списке. По умолчанию  `RelatedEntities` открывает экран с идентификатором формата `<entity_name>.browse`, например `demo_Order.browse`.

[[property-caption]]
* `caption` - имя связанной сущности, отображаемой в выпадающем списке.

[[property-configuration-name]]
* `configurationName` - имя xref:vcl/components/filter.adoc#configuration[конфигурации фильтра] в открытом экране.

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/relatedentities/related-entities-screen.xml[tags=related-entities-property]
----

== Поддержка связанных сущностей

Во фреймворке есть API для открытия экранов связанных сущностей без использования компонента `RelatedEntities`: интерфейс `RelatedEntitiesSupport` и `RelatedEntitiesBuilder`.

Класс `RelatedEntitiesSupport` создает связанный builder экранов.

[NOTE]
Для builder'а должен быть установлен `MetaClass` или класс сущности и свойство или `MetaProperty`.

Пример создания экрана с классом сущности и свойством:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/relatedentities/related-entities-screen.xml[tags=related-button]
----

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/relatedentities/RelatedEntitiesScreen.java[tags=autowired-related-entities-support;autowired-orders-table;related-click]
----

По умолчанию открывается стандартный экран просмотра списка. `RelatedEntitiesBuilder` предоставляет множество методов для установки дополнительных параметров открытого экрана. Например, следующий код создает браузер `Customer` с идентификатором `uiex1_Customer.browse-filter`, открытым в виде диалогового окна:

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/relatedentities/RelatedEntitiesScreen.java[tags=autowired-related-entities-support;autowired-orders-table;related-btn-click]
----

[[xml]]
== Все XML-атрибуты

include::../xml-studio-tip.adoc[]

=== XML-атрибуты RelatedEntities

xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#enable[enable] -
<<attribute-exclude,exclude>> -
<<attribute-for,for>> -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
<<attribute-open-mode,openMode>> -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/xml.adoc#tab-index[tabIndex] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

=== XML-элемент RelatedEntities

<<element-property,property>>

=== XML-атрибуты Property

<<property-caption,caption>> -
<<property-configuration-name,configurationName>> -
<<property-name,name>> -
<<property-screen,screen>>

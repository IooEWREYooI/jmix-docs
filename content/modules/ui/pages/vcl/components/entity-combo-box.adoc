= EntityComboBox
:page-aliases: backoffice-ui:vcl/components/entity-combo-box.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=entitycombobox-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`EntityComboBox - 实体下拉列表` 支持用户从一个下拉列表中选择单一 xref:data-model:entities.adoc[实体] 实例，并在用户单击右侧的按钮时执行操作。

事实上，`EntityComboBox` 是 xref:vcl/components/combo-box.adoc[ComboBox] 和 xref:vcl/components/entity-picker.adoc[EntityPicker] 的组合。

组件的 XML 名称：`entityComboBox`。

== 基本用法

满足下列情况可以使用 `EntityComboBox`：

* 字段值是实体实例。
* 用户需要选择单一选项。
* 选项列表应该比较紧凑。如果选项列表对于 xref:vcl/components/radio-button-group.adoc[RadioButtonGroup] 或 xref:vcl/components/single-select-list.adoc[SingleSelectList] 太长时，用下拉列表更方便。
* 用户需要过滤功能。
* 用户需要对关联的实体实例做一些操作。

如果选项数量很大（数千个或更多），请不要使用 `EntityComboBox`。`EntityComboBox` 会将全部选项列表加载到用户的浏览器和服务器内存中。如需从大量选项列表中进行选择，请使用 xref:vcl/components/entity-picker.adoc[EntityPicker] 或 xref:vcl/components/suggestion-field.adoc[SuggestionField]。

`EntityComboBox` 是一个带有实体实例滚动列表的文本控件。支持自定义和预定义的操作：

image::vcl/components/entity-combo-box.gif[align="center"]

如需创建连接至数据的 `EntityComboBox`，可以用 XML 的 xref:vcl/xml.adoc#data-container[dataContainer] 和 xref:vcl/xml.adoc#property[property] 属性。而 xref:vcl/xml.adoc#options-container[optionsContainer] 属性用来创建选项列表。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/entitycombobox/entitycombobox-screen.xml[tags=data;simple-entity-combo-box;layout-end]
----

<1> `InstanceContainer` - `Address` 主实体。
<2> 数据容器内实体的 fetch plan。
<3> `CollectionContainer` - `Country` 实体列表容器。
<4> `countryField` 将 `countriesDc` 作为选项容器，展示 country 列表。

上面的例子中，界面为具有 `country` 属性的 `Address` 实体定义了 `addressDc` 数据容器。在 `entityComboBox` 元素中，`dataContainer` 属性指向 `addressDc` 数据容器，`property` 指向实体的 `country` 属性。实体属性必须是一个实体的引用。例子中是 `Country` 实体。

这样，通过下拉列表选择 `Country` 后，会设置到 `Address` 的 `country` 属性上。

[[actions]]
== 操作

`EntityComboBox` 没有默认操作，需要显式地添加需要的操作，示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/entitycombobox/entitycombobox-screen.xml[tags=actions-entity-combo-box]
----

[TIP]
====
如需在 Jmix Studio 中添加 `action`，可以在界面 XML 或者 *Component Hierarchy* 面板中选择组件，然后点击 *Component Inspector* 面板的 xref:studio:screen-designer.adoc#add-picker-action[Add->Action] 按钮。
====

自定义和预定义操作的详细信息请参阅 `EntityPicker` 的 xref:vcl/components/entity-picker.adoc#actions[操作] 部分。

[[validators-element]]
== 验证

如需验证 `EntityComboBox` 组件的值，可以在内部的 `validators` 元素使用 xref:vcl/miscellaneous/validator.adoc[validator]。

[[predefined-validators]]
`EntityComboBox` 可以使用下列预定义的 validators：

* xref:vcl/miscellaneous/validator.adoc#custom-validator[CustomValidator]
* xref:vcl/miscellaneous/validator.adoc#not-null-validator[NotNullValidator]

下面例子中，我们演示 `countryValidField` 中 `NotNullValidator` 的用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/entitycombobox/entitycombobox-screen.xml[tags=validator]
----

[[handling-user-input]]
== 处理用户输入

用户可以输入初始列表中没有的值，之后可以无需输入该值再次选择。用 `EnterPressHandler` 处理：

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/entity/address/AddressEdit.java[tags=data;new-option-handler]
----

<1> 创建一个新实例合并至上下文。
<2> 为新创建的 `country` 实体设置名称。
<3> 添加合并的实体。

当用户输入值并按下回车后调用 `EnterPressHandler`。此时，选项列表增添了新值，将来也能用。

[[handlers]]
== 事件和处理器

include::../events-hanlers-generation-tip.adoc[]

[[context-help-icon-click-handler]]
=== ContextHelpIconClickHandler

参阅 xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickHandler]。

[[enter-press-handler]]
=== EnterPressHandler

参阅 `ComboBox` 的 xref:vcl/components/combo-box.adoc#handling-user-input[处理用户输入] 章节的编程式注册示例。

`EnterPressHandler` 可以在界面控制器使用 `@Install` 注解声明式的注册。参阅 <<handling-user-input,处理用户输入>> 部分的示例。

[[field-icon-provider]]
=== FieldIconProvider

参阅 xref:vcl/components/entity-picker.adoc#field-icon-provider[FieldIconProvider]。

////
TODO:
[[lookupSelectHandler]]
Test this handler for LookupComponents
////

[[field-value-change-event]]
=== FieldValueChangeEvent

参阅 xref:vcl/components/entity-picker.adoc#field-value-change-event[FieldValueChangeEvent]。

[[option-caption-provider]]
=== OptionCaptionProvider

参阅 xref:vcl/api.adoc#option-caption-provider[OptionCaptionProvider]。

[[option-icon-provider]]
=== OptionIconProvider

参阅 xref:vcl/components/combo-box.adoc#option-icon-provider[OptionIconProvider]。

[[option-image-provider]]
=== OptionImageProvider

参阅 xref:vcl/components/combo-box.adoc#option-image-provider[OptionImageProvider]。

[[option-style-provider]]
=== OptionStyleProvider

参阅 xref:vcl/api.adoc#option-style-provider[OptionStyleProvider]。

[[options-caption-filter]]
=== OptionsCaptionFilter

参阅 xref:vcl/components/combo-box.adoc#options-caption-filter[OptionsCaptionFilter]。

[[validator]]
=== Validator

为组件添加 xref:vcl/miscellaneous/validator.adoc[validator] 实例。如果值验证失败，`validator` 必须抛出 `ValidationException` 异常。

如果 <<predefined-validators,预定义>> 的验证器不能满足要求，可以添加自定义的验证器实例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=validator]
----

[[value-change-event]]
=== ValueChangeEvent

参阅 xref:vcl/api.adoc#value-change-event[ValueChangeEvent]。

[[xml]]
== EntityComboBox XML 属性

include::../xml-studio-tip.adoc[]

xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#buffered[buffered] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#caption-property[captionProperty] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#editable[editable] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/components/combo-box.adoc#filter-mode[filterMode] -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
xref:vcl/xml.adoc#input-prompt[inputPrompt] -
xref:vcl/components/entity-picker.adoc#meta-class[metaClass] -
xref:vcl/components/combo-box.adoc#null-name[nullName] -
xref:vcl/components/combo-box.adoc#null-option-visible[nullOptionVisible] -
xref:vcl/xml.adoc#options-container[optionsContainer] -
xref:vcl/components/combo-box.adoc#paging[pageLength] -
xref:vcl/xml.adoc#property[property] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/xml.adoc#tab-index[tabIndex] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

== EntityComboBox XML 元素

<<actions,actions>> -
<<validators-element,validators>>

= GroupTable

++++
<div class="backoffice-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=grouptable-simple" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Компонент `GroupTable` – это таблица с возможностью динамической группировки по значениям одной или нескольких колонок.

XML-имя компонента: `groupTable`.

== Основы

`GroupTable` в основном повторяет функциональность компонента xref:vcl/components/table.adoc[Table].

Ниже показан типичный `GroupTable`:

image::vcl/components/group-table-anatomy.png[align="center"]

. Колонки, участвующие в группировке
. Разделитель групп
. Строки групп
. Кнопка разворачивания группы
. Кнопка сворачивания группы

Ниже представлен пример объявления `GroupTable` в XML-дескрипторе экрана:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/grouptable/groupTable-screen.xml[tags=data-start;customersDc;data-end;layout-start;group-table-simple;layout-end;]
----

В приведенном примере есть xref:data/collection-container.adoc[контейнер коллекции] для сущности `Customer`. Компонент `GroupTable` привязан к контейнеру с помощью атрибута `dataContainer`, в то время как его элемент `columns` определяет, какие атрибуты сущности отображаются в колонках таблицы.

[[grouping]]
== Группировка

Для того чтобы сгруппировать таблицу по какой-либо колонке, нужно в заголовке таблицы перетащить эту колонку в позицию слева от элемента image:vcl/components/group-table-icon.png[]. Сгруппированные значения можно разворачивать и сворачивать с помощью кнопок image:vcl/components/group-table-plus.png[]/image:vcl/components/group-table-minus.png[].

image::vcl/components/group-table-grouping.gif[align="center"]

[[group]]
`group` − необязательный элемент, может в единственном экземпляре находиться внутри колонок. Содержит набор элементов xref:vcl/components/table.adoc#column[column], по которым будет выполняться первоначальная группировка при открытии экрана.

В приведенном ниже примере мы будем использовать атрибут xref:vcl/components/table.adoc#include-all[includeAll] элемента `columns` совместно с элементом `group`. Группировка произведена по колонке `city`:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/grouptable/groupTable-screen.xml[tags=group-tab-include]
----

[[column-group-allowed]]
Каждый элемент `column` может содержать атрибут `groupAllowed` с булевым значением. С помощью этого атрибута можно запретить пользователю группировать таблицу по данной колонке. Значение по умолчанию – `true`.

[[fixed-grouping]]

С помощью атрибуты `fixedGrouping` можно позволить пользователю изменять то, какие колонки участвуют в группировке. Значение по умолчанию – `false`.

[[aggregatable]]
== Агрегация

`GroupTable` поддерживает агрегацию для строк таблицы. Для получения дополнительной информации см. раздел xref:vcl/components/table.adoc#aggregatable[Table].

При включенном атрибуте `aggregatable` таблица отображает результаты агрегации по всем строкам в дополнительной строке вверху, а также результаты агрегации по группам.

image::vcl/components/group-table-aggregation-anatomy.png[align="center"]

. Агрегация по всем строкам.
. Агрегация по группам.

[[show-total-aggregation]]
Отображение агрегации по всем строкам можно отключить, установив `false` в атрибуте `showTotalAggregation`. Значение по умолчанию – `true`.

[[multiselect]]
== Множественный выбор

При включенном атрибуте xref:vcl/components/table.adoc#multiselect[multiselect] клик по строке группировки с зажатой клавишей *Ctrl* разворачивает группу (если та была свернута) и применяет выделение ко всем строкам этой группы. При этом, если вся группа выделена, *Ctrl+click* не снимает выделение со всей группы. Вы по-прежнему можете снять выделение с отдельных строк, пользуясь стандартным поведением клавиши *Ctrl*.

== Экспорт значений колонок

См. раздел xref:vcl/components/table.adoc#exporting-column-values[Exporting Column Values] компонента `Table`.

== Методы интерфейса GroupTable

[[methods-group-by-columns]]
* `groupByColumns()` - применяет группировку по заданным колонкам.
+
В примере ниже таблица будет сгруппирована сначала по колонке `level`, а затем – по колонке `city`:
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/grouptable/GroupTableScreen.java[tags=group-by-columns]
----

[[methods-ungroup-by-columns]]
* `ungroupByColumns()` - снимает группировку по заданным колонкам.
+
Следующий пример снимет группировку по `level`, однако группировка по колонке `city` из предыдущего примера будет сохранена:
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/grouptable/GroupTableScreen.java[tags=ungroup-by-columns]
----

[[methods-ungroup]]
* `ungroup()` - снимает группировку по всем колонкам.

[[methods-set-show-items-count-for-group]]
* `setShowItemsCountForGroup()` - показывает или скрывает количество элементов группы `GroupTable`. Значение по умолчанию – `true`.

[[methods-get-aggregation-results]]
* Метод `getAggregationResults()` возвращает мэп с результатами агрегации по указанному объекту <<aggregation-distribution-provider,GroupInfo>>, где ключи в мэп – идентификаторы столбцов таблицы, а значения – значения агрегации.

[[methods-set-style-provider]]
* Метод `setStyleProvider()` позволяет задать стиль отображения ячеек таблицы. Для `GroupTable` данный метод будет принимать `GroupTable.GroupStyleProvider`, который расширяет `Table.StyleProvider`.
+
`GroupStyleProvider` имеет специальный метод для стилизации сгруппированных строк с <<aggregation-distribution-provider,GroupInfo>> в качестве принимаемого параметра. Он будет вызываться для каждой сгруппированной строки в `GroupTable`.
+
Пример задания стилей:
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/grouptable/GroupTableScreen.java[tags=inject-styledTable;on-init-start;set-style-provider;on-init-end]
----

Далее нужно определить стили в теме приложения. Подробная информация о создании темы находится в разделе xref:themes.adoc[Темы]. Имена стилей, заданные в контроллере, образуют CSS-селекторы. Например:

[source,css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/helium-extended.scss[tags=group-table-styles]
----

image::vcl/components/group-table-style-provider.png[align="center"]

== События и слушатели

include::../events-hanlers-generation-tip.adoc[]

[[aggregation-distribution-provider]]
=== AggregationDistributionProvider

`AggregationDistributionProvider` аналогичен xref:vcl/components/table.adoc#aggregation-distribution-provider[тому же] провайдеру компонента `Table` с той лишь разницей, что при создании провайдера используется объект `GroupAggregationDistributionContext<V>`, который содержит дополнительный `GroupInfo groupInfo` – объект с информацией о строке группировки: свойства сгруппированных столбцов и их значения.

[[column-collapse-event]]
=== ColumnCollapseEvent

См. xref:vcl/components/table.adoc#column-collapse-event[ColumnCollapseEvent].

[[column-reorder-event]]
=== ColumnReorderEvent

См. xref:vcl/components/table.adoc#column-reorder-event[ColumnReorderEvent].

[[context-help-icon-click-handler]]
=== ContextHelpIconClickHandler

См. xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickHandler].

[[empty-state-link-click-handler]]
=== EmptyStateLinkClickHandler

См. xref:vcl/components/table.adoc#empty-state-click-event[EmptyStateClickEvent].

=== GroupCellValueFormatter

`GroupCellValueFormatter` позволяет отображать в строках групп собственный текст.

В приведенном ниже примере заменим текст по умолчанию следующим форматом: `<Grouped column name>: <Grouping value>`.

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/grouptable/GroupTableScreen.java[tags=group-cell-value-formatter]
----

image::vcl/components/group-table-group-formatter.png[align="center"]

[[icon-provider]]
=== IconProvider

См. xref:vcl/components/table.adoc#icon-provider[IconProvider].

[[item-description-provider]]
=== ItemDescriptionProvider

См. xref:vcl/components/table.adoc#item-description-provider[ItemDescriptionProvider].

[[lookup-select-handler]]
=== LookupSelectHandler

См. xref:vcl/components/table.adoc#lookup-select-handler[LookupSelectHandler].

[[selection-event]]
=== SelectionEvent

См. xref:vcl/components/table.adoc#selection-event[SelectionEvent].

[[xml]]
== Все XML-атрибуты

include::../xml-studio-tip.adoc[]

=== XML-атрибуты Table
<<aggregatable,aggregatable>> -
xref:vcl/components/table.adoc#aggregation-style[aggregationStyle] -
xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/components/table.adoc#column-control-visible[columnControlVisible] -
xref:vcl/components/table.adoc#column-header-visible[columnHeaderVisible] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/components/table.adoc#context-menu-enabled[contextMenuEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/components/table.adoc#editable[editable] -
xref:vcl/components/table.adoc#empty-state-link-message[emptyStateLinkMessage] -
xref:vcl/components/table.adoc#empty-state-message[emptyStateMessage] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
<<fixed-grouping,fixedGrouping>> -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
xref:vcl/components/table.adoc#meta-class[metaClass] -
xref:vcl/components/table.adoc#multi-line-cells[multiLineCells] -
<<multiselect,multiselect>> -
xref:vcl/components/table.adoc#reordering-allowed[reorderingAllowed] -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/components/table.adoc#show-selection[showSelection] -
<<show-total-aggregation,showTotalAggregation>> -
xref:vcl/components/table.adoc#table-sorting[sortable] -
xref:vcl/components/table.adoc#stylename[stylename] -
xref:vcl/xml.adoc#tab-index[tabIndex] -
xref:vcl/components/table.adoc#text-selection-enabled[textSelectionEnabled] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

[[xml-table-elements]]
=== XML-элементы Table

xref:vcl/components/table.adoc#actions[actions] -
xref:vcl/components/table.adoc#buttons-panel[buttonsPanel] -
xref:vcl/components/table.adoc#columns[columns] -
xref:vcl/components/table.adoc#paging[simplePagination]

=== XML-атрибуты Columns

xref:vcl/components/table.adoc#exclude[exclude] -
xref:vcl/components/table.adoc#include-all[include-all]

=== XML-элементы Columns

xref:vcl/components/table.adoc#column[column] -
<<group,group>>

=== XML-атрибуты Column

xref:vcl/components/table.adoc#column-alignment[align] -
xref:vcl/components/table.adoc#column-caption[caption] -
xref:vcl/components/table.adoc#column-caption-as-html[captionAsHtml] -
xref:vcl/components/table.adoc#caption-property[captionProperty] -
xref:vcl/components/table.adoc#column-collapsed[collapsed] -
xref:vcl/components/table.adoc#column-date-format-resolution[dateFormat] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/components/table.adoc#column-editable[editable] -
xref:vcl/components/table.adoc#column-expand-ratio[expandRatio] -
<<column-group-allowed,groupAllowed>> -
xref:vcl/components/table.adoc#column-id[id] -
xref:vcl/components/table.adoc#column-link[link] -
xref:vcl/components/table.adoc#column-link-screen-id[linkScreenId] -
xref:vcl/components/table.adoc#column-link-screen-open-mode[linkScreenOpenMode] -
xref:vcl/components/table.adoc#column-max-text-length[maxTextLength] -
xref:vcl/components/table.adoc#column-options-container[optionsContainer] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/components/table.adoc#column-date-format-resolution[resolution] -
xref:vcl/components/table.adoc#column-sort[sort] -
xref:vcl/components/table.adoc#column-sortable[sortable] -
xref:vcl/components/table.adoc#column-visible[visible] -
xref:vcl/components/table.adoc#column-width[width]

=== XML-элементы Column

<<aggregatable,aggregation>> -
xref:vcl/components/table.adoc#column-formatter[formatter]

=== XML-атрибуты Aggregation

xref:vcl/components/table.adoc#aggregation-editable[editable] -
xref:vcl/components/table.adoc#aggregation-strategy-class[strategyClass] -
xref:vcl/components/table.adoc#aggregation-type[type] -
xref:vcl/components/table.adoc#aggregation-value-description[valueDescription]

=== XML-элементы Aggregation

xref:vcl/components/table.adoc#aggregation-formatter[formatter]

== API

<<methods-get-aggregation-results,getAggregationResults>> -
xref:vcl/components/table.adoc#methods-get-selected[getSelected] -
xref:vcl/components/table.adoc#methods-get-selected[getSingleSelected] -
<<methods-group-by-columns,groupByColumns>> -
xref:vcl/components/table.adoc#methods-request-focus[requestFocus] -
xref:vcl/components/table.adoc#methods-scroll-to[scrollTo] -
xref:vcl/components/table.adoc#methods-set-enter-press-action[setEnterPressAction] -
xref:vcl/components/table.adoc#methods-set-item-click-action[setItemClickAction] -
<<methods-set-show-items-count-for-group,setShowItemsCountForGroup>> -
<<methods-set-style-provider,setStyleProvider>> -
<<methods-ungroup,ungroup>> -
<<methods-ungroup-by-columns,ungroupByColumns>>
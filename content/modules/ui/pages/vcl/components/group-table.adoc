= GroupTable 分组表格
:page-aliases: backoffice-ui:vcl/components/group-table.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=grouptable-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`GroupTable - 分组表格` 组件是支持将数据按一列或多列进行分组的表格。

组件的 XML 名称：`groupTable`。

== 基本用法

`GroupTable` 主要功能与 the xref:vcl/components/table.adoc[Table] 组件一样。

典型的分组表格如下：

image::vcl/components/group-table-anatomy.png[align="center"]

. 参与数据分组的列
. 特殊的组分隔符
. 分组的数据行
. 展开分组按钮
. 折叠分组按钮

在 XML 描述中声明 `GroupTable` 的例子如下：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/grouptable/groupTable-screen.xml[tags=data-start;customersDc;data-end;layout-start;group-table-simple;layout-end;]
----

示例中，`Customer` 实体有一个 xref:data/collection-container.adoc[集合数据容器]。表格通过 `dataContainer` 属性绑定至该容器，`columns` 元素定义将哪些实体属性作为表格列展示。

[[grouping]]
== 分组

如需对数据按列分组，将需要分组的列拖至左侧，放置在表头的 image:vcl/components/group-table-icon.png[] 元素前。分组后的数据可以用 image:vcl/components/group-table-plus.png[]/image:vcl/components/group-table-minus.png[] 按钮展开或折叠。

image::vcl/components/group-table-grouping.gif[align="center"]

[[group]]
`group` 是 `columns` 中的可选元素，包含一组 xref:vcl/components/table.adoc#column[column]，打开对应界面时，会默认将数据按这些列进行分组。

下面的例子中，我们会使用 `columns` 元素的 xref:vcl/components/table.adoc#include-all[includeAll] 属性，以及 `group` 元素。表格按 `city` 列分组：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/grouptable/groupTable-screen.xml[tags=group-tab-include]
----

[TIP]
====
如需在 Jmix Studio 中添加分组列，可以在界面 XML 或者 *Component Hierarchy* 面板中选择 `GroupTable` 组件，然后点击 *Component Inspector* 面板的 xref:studio:screen-designer.adoc#add-column[Add]*->Group->Column* 按钮。
====

[[column-group-allowed]]
每个 `column` 都可以设置 `groupAllowed` 布尔值属性，控制该列是否可以用来分组数据。默认为 `true`。

[[fixed-grouping]]

`fixedGrouping` 属性控制用户是否可以改变参与数据分组的列。默认值为 `false`。

[[aggregatable]]
== 聚合

`GroupTable` 支持对表格列计算聚合值。参阅 xref:vcl/components/table.adoc#aggregatable[Table] 相关章节了解更多。

如果 `aggregatable` 属性设置为 `true`，则会针对每个分组显示聚合计算结果；并在第一行显示针对所有行的聚合计算结果。

image::vcl/components/group-table-aggregation-anatomy.png[align="center"]

. 总聚合值
. 分组聚合值

[[show-total-aggregation]]
如果 `showTotalAggregation` 属性设置为 `false`，针对所有行的聚合结果则不会显示。默认为 `true`。

[[multiselect]]
== 多选

如果 xref:vcl/components/table.adoc#multiselect[multiselect] 属性设置为 `true`，按下 *Ctrl* 键并单击分组行时，该组会展开（如果已经折叠），该组的所有行都会被选上。但反过来不同，如果整组都被选上，*Ctrl+单击* 并不会反选所有组数据。通过 *Ctrl* 还是可以反选特定的行。

== 导出列值

参阅 `Table` 组件的 xref:vcl/components/table.adoc#exporting-column-values[导出列值] 章节。

== GroupTable 接口方法

[[methods-group-by-columns]]
* `groupByColumns()` - 基于给定列进行分组。
+
以下示例中，会将数据先以 `level` 分组，再以 `city` 分组：
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/grouptable/GroupTableScreen.java[tags=group-by-columns]
----

[[methods-ungroup-by-columns]]
* `ungroupByColumns()` - 取消基于给定列的分组。
+
以下示例中，会取消针对 `level` 的分组，但基于 `city` 的分组会保留。
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/grouptable/GroupTableScreen.java[tags=ungroup-by-columns]
----

[[methods-ungroup]]
* `ungroup()` - 取消所有分组。

[[methods-set-show-items-count-for-group]]
* `setShowItemsCountForGroup()` - 显示或隐藏 `GroupTable` 分组内数据的计数。默认为 `true`。

[[methods-get-aggregation-results]]
* `getAggregationResults()` 方法会为特定的 <<aggregation-distribution-provider,GroupInfo>> 对象返回一个聚合值的映射（map），键值为表格列的标识符，值为聚合值。

[[methods-set-style-provider]]
* `setStyleProvider()` 方法可以为单元格设置显示样式。对于 `GroupTable`，该方法接收继承自 `Table.StyleProvider` 的 `GroupTable.GroupStyleProvider`。
+
`GroupStyleProvider` 有个特殊方法，用来为分组行设置样式，该方法使用 <<aggregation-distribution-provider,GroupInfo>> 参数。`GroupTable` 会为每个分组行调用此方法。
+
示例：
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/grouptable/GroupTableScreen.java[tags=inject-styledTable;on-init-start;set-style-provider;on-init-end]
----

然后，需要在应用程序主题中定义单元格和行的样式。创建主题的详细内容请参阅 xref:themes.adoc[Themes]。控制器中 provider 返回的样式名，会作为 CSS 选择器使用。示例：

[source,css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/helium-extended.scss[tags=group-table-styles]
----

image::vcl/components/group-table-style-provider.png[align="center"]

== 事件和处理器

include::../events-hanlers-generation-tip.adoc[]

[[aggregation-distribution-provider]]
=== AggregationDistributionProvider

`AggregationDistributionProvider` 与 `Table` 组件的 xref:vcl/components/table.adoc#aggregation-distribution-provider[同名] provider 类似。不同之处在于，当创建 provider 时，会使用 `GroupAggregationDistributionContext<V>` 对象，包含了额外的 `GroupInfo groupInfo` – 带有分组行信息的对象：分组的所有列的属性及其值。

[[column-collapse-event]]
=== ColumnCollapseEvent

参阅 xref:vcl/components/table.adoc#column-collapse-event[ColumnCollapseEvent]。

[[column-reorder-event]]
=== ColumnReorderEvent

参阅 xref:vcl/components/table.adoc#column-reorder-event[ColumnReorderEvent]。

[[context-help-icon-click-handler]]
=== ContextHelpIconClickHandler

参阅 xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickHandler]。

[[empty-state-link-click-handler]]
=== EmptyStateLinkClickHandler

参阅 xref:vcl/components/table.adoc#empty-state-click-event[EmptyStateClickEvent]。

[[group-cell-value-formatter]]
=== GroupCellValueFormatter

`GroupCellValueFormatter` 支持为分组行提供自定义的文本展示。

下面例子中，我们用 `<Grouped column name>: <Grouping value>` 格式的文本替换了默认的文本。

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/grouptable/GroupTableScreen.java[tags=group-cell-value-formatter]
----

image::vcl/components/group-table-group-formatter.png[align="center"]

如需以编程的方式注册 `GroupCellValueFormatter`，使用组件的 `setGroupCellValueFormatter()` 方法。

[[icon-provider]]
=== IconProvider

 参阅 xref:vcl/components/table.adoc#icon-provider[IconProvider]。

[[item-description-provider]]
=== ItemDescriptionProvider

 参阅 xref:vcl/components/table.adoc#item-description-provider[ItemDescriptionProvider]。

[[lookup-select-handler]]
=== LookupSelectHandler

 参阅 xref:vcl/components/table.adoc#lookup-select-handler[LookupSelectHandler]。

[[selection-event]]
=== SelectionEvent

 参阅 xref:vcl/components/table.adoc#selection-event[SelectionEvent]。

[[xml]]
== XML 属性

include::../xml-studio-tip.adoc[]

=== Table XML 属性
<<aggregatable,aggregatable>> -
xref:vcl/components/table.adoc#aggregation-style[aggregationStyle] -
xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/components/table.adoc#column-control-visible[columnControlVisible] -
xref:vcl/components/table.adoc#column-header-visible[columnHeaderVisible] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/components/table.adoc#context-menu-enabled[contextMenuEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/components/table.adoc#editable[editable] -
xref:vcl/components/table.adoc#empty-state-link-message[emptyStateLinkMessage] -
xref:vcl/components/table.adoc#empty-state-message[emptyStateMessage] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
<<fixed-grouping,fixedGrouping>> -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
xref:vcl/components/table.adoc#meta-class[metaClass] -
xref:vcl/components/table.adoc#multi-line-cells[multiLineCells] -
<<multiselect,multiselect>> -
xref:vcl/components/table.adoc#reordering-allowed[reorderingAllowed] -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/components/table.adoc#show-selection[showSelection] -
<<show-total-aggregation,showTotalAggregation>> -
xref:vcl/components/table.adoc#table-sorting[sortable] -
xref:vcl/components/table.adoc#stylename[stylename] -
xref:vcl/xml.adoc#tab-index[tabIndex] -
xref:vcl/components/table.adoc#text-selection-enabled[textSelectionEnabled] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

[[xml-table-elements]]
=== Table XML 元素

xref:vcl/components/table.adoc#actions[actions] -
xref:vcl/components/table.adoc#buttons-panel[buttonsPanel] -
xref:vcl/components/table.adoc#columns[columns] -
xref:vcl/components/table.adoc#paging[simplePagination]

=== Columns XML 属性

xref:vcl/components/table.adoc#exclude[exclude] -
xref:vcl/components/table.adoc#include-all[include-all]

=== Columns XML 元素

xref:vcl/components/table.adoc#column[column] -
<<group,group>>

=== Column XML 属性

xref:vcl/components/table.adoc#column-alignment[align] -
xref:vcl/components/table.adoc#column-caption[caption] -
xref:vcl/components/table.adoc#column-caption-as-html[captionAsHtml] -
xref:vcl/components/table.adoc#caption-property[captionProperty] -
xref:vcl/components/table.adoc#column-collapsed[collapsed] -
xref:vcl/components/table.adoc#column-date-format-resolution[dateFormat] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/components/table.adoc#column-editable[editable] -
xref:vcl/components/table.adoc#column-expand-ratio[expandRatio] -
<<column-group-allowed,groupAllowed>> -
xref:vcl/components/table.adoc#column-id[id] -
xref:vcl/components/table.adoc#column-link[link] -
xref:vcl/components/table.adoc#column-link-screen-id[linkScreenId] -
xref:vcl/components/table.adoc#column-link-screen-open-mode[linkScreenOpenMode] -
xref:vcl/components/table.adoc#column-max-text-length[maxTextLength] -
xref:vcl/components/table.adoc#column-options-container[optionsContainer] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/components/table.adoc#column-date-format-resolution[resolution] -
xref:vcl/components/table.adoc#column-sort[sort] -
xref:vcl/components/table.adoc#column-sortable[sortable] -
xref:vcl/components/table.adoc#column-visible[visible] -
xref:vcl/components/table.adoc#column-width[width]

=== Column XML 元素

<<aggregatable,aggregation>> -
xref:vcl/components/table.adoc#column-formatter[formatter]

=== Aggregation XML 属性

xref:vcl/components/table.adoc#aggregation-editable[editable] -
xref:vcl/components/table.adoc#aggregation-strategy-class[strategyClass] -
xref:vcl/components/table.adoc#aggregation-type[type] -
xref:vcl/components/table.adoc#aggregation-value-description[valueDescription]

=== Aggregation XML 元素

xref:vcl/components/table.adoc#aggregation-formatter[formatter]

== API

<<methods-get-aggregation-results,getAggregationResults>> -
xref:vcl/components/table.adoc#methods-get-selected[getSelected] -
xref:vcl/components/table.adoc#methods-get-selected[getSingleSelected] -
<<methods-group-by-columns,groupByColumns>> -
xref:vcl/components/table.adoc#methods-request-focus[requestFocus] -
xref:vcl/components/table.adoc#methods-scroll-to[scrollTo] -
xref:vcl/components/table.adoc#methods-set-enter-press-action[setEnterPressAction] -
xref:vcl/components/table.adoc#methods-set-item-click-action[setItemClickAction] -
<<methods-set-show-items-count-for-group,setShowItemsCountForGroup>> -
<<methods-set-style-provider,setStyleProvider>> -
<<methods-ungroup,ungroup>> -
<<methods-ungroup-by-columns,ungroupByColumns>>

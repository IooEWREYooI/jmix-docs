= DateField 日期时间
:page-aliases: backoffice-ui:vcl/components/date-field.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=datefield-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`DateField - 日期时间组件` 由 xref:vcl/components/date-picker.adoc[DatePicker] 和 xref:vcl/components/time-field.adoc[TimeField] 组成。支持展示和输入日期时间。

image::vcl/components/date-field.png[align="center"]

组件的 XML 名称：`dateField`。

[[basics]]
== 基本用法

如需创建关联至数据的 `DateField`，可以用 XML 的 xref:vcl/xml.adoc#data-container[dataContainer] 和 xref:vcl/xml.adoc#property[property] 属性：

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/entity/Person.java[tags=date-field]
----

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/datefield/date-field-screen.xml[tags=data;layout-start;date-field-1;layout-end]
----

在上面这个例子中，界面有 `Person` 实体的数据容器 `personDc`，`Person` 实体拥有 `birthday` 属性。XML 里面将 xref:vcl/xml.adoc#data-container[dataContainer] 属性指向这个数据容器，然后将 xref:vcl/xml.adoc#property[property] 属性指向实体中需要显示在这个组件的字段。

[[date-and-time-format]]
== 日期和时间格式

[[entity-associated-datefield]]
=== 数据感知的 DateField

如果这个组件关联实体的一个属性，它能根据实体属性的类型自动填充日期时间格式：

1. 如果这个实体属性是 `java.sql.Date` 类型或者这个属性有 `@Temporal(TemporalType.DATE)` 注解，那么时间部分会被隐藏不显示。
2. 其他情况下，时间会显示小时和分钟。

可以用 `date` 和 `time` xref:jmix:data-model:data-types.adoc[datatypes] 并在本地消息包中设置 `dateFormat` 和 `timeFormat` 定义日期和时间格式。

[[standalone-datefield]]
=== 独立的 DateField

[[datatype]]
如果此组件不关联任何实体属性，可以用 `datatype` XML 属性设置数据类型，允许使用下列值：

* `date`
* `dateTime`
* `localDate`
* `localDateTime`
* `offsetDateTime`

[[date-format]]
=== dateFormat 属性

可以用 `dateFormat` 属性修改日期时间格式。属性值可以是一个格式字符串或者本地消息包内的一个键值。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/datefield/date-field-screen.xml[tags=date-format]
----

日期时间格式是使用 https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html[SimpleDateFormat^] 类提供的规则来定义。如果格式中没有 `H` 或者 `h` 的话，时间部分将不显示。

[NOTE]
====

`DateField` 主要目的是通过填充占位符来使用键盘快速输入。所以这个组件只支持包含数字和分隔符的日期时间格式。那些复杂的含有星期文字表述或者月文字表述的格式目前是不支持的。

====

[[attributes]]
== 属性

[[autofill]]
=== autofill

`autofill` 属性设置为 `true` 则会支持在输入了日期之后会自动填充年和月。如果该属性未启用，且日期没有填全，`DateField` 会清空值。

如果 `autofill` 启用，并且设置了 xref:vcl/components/date-picker.adoc#range-start-and-range-end[rangeStart] 或 xref:vcl/components/date-picker.adoc#range-start-and-range-end[rangeEnd]，会在自动填写日期时考虑这两个值的设置。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/datefield/date-field-screen.xml[tags=autofill]
----

[[resolution]]
=== resolution

日期和时间的精度可以用组件的 `resolution` 属性来定义，这个属性的值需要是 `DateField.Resolution` 枚举类型：

* `SEC`
* `MIN` - 默认值，精确到分钟。
* `HOUR`
* `DAY`
* `MONTH`
* `YEAR`

如果 `resolution="DAY"` 或 `resolution="MIN"` 而且 `dateFormat` 没有设置的话，组件的显示格式会从消息包里的 `dateFormat` 或 `dateTimeFormat` 键获取。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/datefield/date-field-screen.xml[tags=resolution]
----

[[timestamp-conversions]]
== 时间戳换算

`DateField` 还可以在服务器和用户之间转换时间戳的时区，前提是用户通过 `setTimeZone()` 设置了时区。

当这个组件绑定了一个实体里的时间戳类型的属性的时候，时区会通过当前的用户会话自动设定。如果组件没有绑定时间戳类型的属性，可以通过在界面控制器调用 `setTimeZone()` 手动设置时区。

日历中的当前日期是根据用户浏览器的时间戳确定的，依赖操作系统时区的设置。用户时区不会影响此功能。

[[validators-element]]
== 验证

如需验证 `DateField` 组件的值，可以在内部的 `validators` 元素使用 xref:vcl/miscellaneous/validator.adoc[validator]。

[[predefined-validators]]
`DateField` 可以使用下列预定义的 validators：

* xref:vcl/miscellaneous/validator.adoc#custom-validator[CustomValidator]
* xref:vcl/miscellaneous/validator.adoc#future-or-present-validator[FutureOrPresentValidator]
* xref:vcl/miscellaneous/validator.adoc#future-validator[FutureValidator]
* xref:vcl/miscellaneous/validator.adoc#not-null-validator[NotNullValidator]
* xref:vcl/miscellaneous/validator.adoc#past-or-present-validator[PastOrPresentValidator]
* xref:vcl/miscellaneous/validator.adoc#past-validator[PastValidator]

下面例子中，我们展示 `FutureValidator` 的用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/datefield/date-field-screen.xml[tags=predefined-validator]
----

[[handlers]]
== 事件和处理器

include::../events-hanlers-generation-tip.adoc[]

[[context-help-icon-click-handler]]
=== ContextHelpIconClickHandler

参阅 xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickHandler]。

[[validator]]
=== Validator

为组件添加 xref:vcl/miscellaneous/validator.adoc[validator] 实例。如果值验证失败，`validator` 必须抛出 `ValidationException` 异常。

如果 <<predefined-validators,预定义>> 的验证器不能满足要求，可以添加自定义的验证器实例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/datefield/DateFieldScreen.java[tags=validator]
----

[[value-change-event]]
=== ValueChangeEvent

参阅 xref:vcl/api.adoc#value-change-event[ValueChangeEvent]。

[[xml]]
== DateField XML 属性

include::../xml-studio-tip.adoc[]

xref:vcl/xml.adoc#align[align] -
<<autofill, autofill>> -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#buffered[buffered] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
<<datatype, datatype>> -
<<date-format, dateFormat>> -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#editable[editable] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
xref:vcl/xml.adoc#property[property] -
xref:vcl/components/date-picker.adoc#range-start-and-range-end[rangeEnd] -
xref:vcl/components/date-picker.adoc#range-start-and-range-end[rangeStart] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
<<resolution, resolution>> -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/xml.adoc#tab-index[tabIndex] -
xref:vcl/components/time-field.adoc#time-mode[timeMode] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

== DateField XML 元素

<<validators-element,validators>>

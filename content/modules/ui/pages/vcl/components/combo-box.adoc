= ComboBox
:page-aliases: backoffice-ui:vcl/components/combo-box.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=combobox-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`ComboBox - 下拉列表` 支持从下拉列表中选择单一值。支持基于用户的输入对选项进行过滤的功能。

组件的 XML 名称：`comboBox`。

== 基本用法

满足下列情况可以使用 `ComboBox`：

* 用户需要选择单一选项。
* 选项列表应该比较紧凑。如果选项列表对于 xref:vcl/components/radio-button-group.adoc[RadioButtonGroup] 或 xref:vcl/components/single-select-list.adoc[SingleSelectList] 太长时，用下拉列表更方便。
* 用户需要过滤功能。

也可以参阅 xref:vcl/components/entity-combo-box.adoc[]。

Jmix Studio 在创建实体编辑器时，会给实体的枚举属性生成 `ComboBox` 组件。例如，`Customer` 实体有 `hobby` 属性，这是一个 `Hobby` 枚举类型的属性。

image::vcl/components/combo-box.png[align="center"]

在下面的例子中，界面为 `Customer` 实体定义了 `customerDc` 数据容器，该实体有 `hobby` 属性。`comboBox` 元素中，`dataContainer` 属性使用 `customerDc` 数据容器，`property` 引用 `hobby` 实体属性。这里，实体的属性为枚举类型，下拉列表显示所有枚举值的本地化名称。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=data;data-end;layout-start;basic;layout-end]
----

[[custom-options]]
== 自定义选项
`ComboBox` 的选项列表还可以通过 `setOptionsList()`、`setOptionsMap()` 和 `setOptionsEnum()` 方法设置。

=== setOptionsList()
* `setOptionsList()` 方法可以通过代码指定选项列表。
+
首先在 XML 描述中声明组件：
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=options-list]
----
+
然后将组件注入界面控制器，在 `onInit()` 方法中设置选项列表：
+
[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=options-list;options-list-2;init-end]
----
+
组件的下拉列表中会显示 `"Married"`、`"Widowed"`、`"Separated"`、`"Divorced"` 和 `"Single"`。选择的值会设置到 `customerDc` 数据容器中的 `maritalStatus` 属性上。

=== setOptionsMap()
* `setOptionsMap()` 支持为每个选项值单独设置字符串标题。
+
首先在 XML 描述中声明组件：
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=options-map]
----
+
然后将组件注入界面控制器，在 `onInit()` 方法中设置选项列表映射：
+
[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=options-map;options-map-2;options-map-3;init-end]
----
+
组件的下拉列表中会显示 `"Poor"`、`"Average"`、`"Good"`、`"Excellent"` 字符串。但是组件的值是选中字符串对应的数字。选择的值会设置到 `orderDc` 数据容器中的 `rating` 属性上。

=== setOptionsEnum()
* `setOptionsEnum()` 方法使用枚举类作为参数。下拉列表中展示枚举值的本地化名称，而组件值为枚举值。
+
[[options-enum]]
+
使用枚举类设置选项最简便的方式是使用 XML 描述中的 `optionsEnum` 属性：
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=options-enum]
----

== Null 选项
[[null-name]]
=== nullName
如果 `ComboBox` 下拉框组件非必需，并且对应的实体属性也非必需，下拉选项会包含一个空行。如果选择了空行，组件值为 `null`. 使用 `nullName` 属性设置在“空行”上显示的文本。以下为一个示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=null-name]
----

这样，下拉框中的“空行”上会显示 `(not selected)` 文本。如果用户选择了该行，对应的实体属性值会设置为 `null`。

image::vcl/components/combo-box-null-name.png[align="center"]

如果在代码中通过 `setOptionsList()` 设置选项，则可以用 `setNullSelectionCaption()` 方法设置空行文本，这样，如果用户选择了该行，组件值则为 `null`。

[[null-option-visible]]
=== nullOptionVisible
`nullOptionVisible` XML 属性设置是否在下拉列表显示空值。设置为 `false`，令 `ComboBox` 为非必需，但是不提供空值选项。该属性默认为 `true`。

[[filter-mode]]
== 过滤模式

`ComboBox` 支持过滤。用 `filterMode` 属性设置基于用户输入的过滤模式：

* `NO` - `ComboBox` 不使用过滤器。
* `STARTS_WITH` - `ComboBox` 展示以输入文本开头的选项。
* `CONTAINS` - `ComboBox` 展示包含输入文本的选项（默认）。

[[text-input-allowed]]
可以使用 `textInputAllowed` 属性禁用过滤：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=disable-text-input]
----

下拉列表很短时，禁用过滤会方便一些。默认值是 `true`。

[[paging]]
== 分页

`ComboBox` 提供一种分页机制，可以将选项分页显示。分页数由每页选项数和下拉框的选项总数决定。

用 `pageLength` 属性设置每页展示的选项数。

`pageLength` 设置为 0 会禁用选项建议弹窗（所有选项可见）。

默认值在 xref:app-properties.adoc#jmix.ui.component.combo-box-page-length[jmix.ui.component.comboBoxPageLength] 应用程序属性中定义。

== 设置弹窗宽度

`setPopupWidth()` 可以设置下拉列表的宽度，宽度用字符串格式传递给该方法。使用相对单位（例如，`"50%"`），可以设置下拉列表的宽度是针对于 `ComboBox` 本身的相对值。默认情况下，该宽度设置为 `null`，此时，下拉列表的宽度为了适应显示内容的宽度可以大于组件的宽度。设置该值为 `"100%"`，可以使得下拉列表的宽度等于 `ComboBox` 的宽度。

[[validators-element]]
== 验证

如需检查输入 `ComboBox` 组件内的值，可以在内部的 `validators` 元素中使用 xref:vcl/miscellaneous/validator.adoc[validator]。

[[predefined-validators]]
`ComboBox` 可使用下列预定义的验证器：

* xref:vcl/miscellaneous/validator.adoc#custom-validator[CustomValidator]
* xref:vcl/miscellaneous/validator.adoc#decimal-max-validator[DecimalMaxValidator]
* xref:vcl/miscellaneous/validator.adoc#decimal-min-validator[DecimalMinValidator]
* xref:vcl/miscellaneous/validator.adoc#digits-validator[DigitsValidator]
* xref:vcl/miscellaneous/validator.adoc#double-max-validator[DoubleMaxValidator]
* xref:vcl/miscellaneous/validator.adoc#double-min-validator[DoubleMinValidator]
* xref:vcl/miscellaneous/validator.adoc#email-validator[EmailValidator]
* xref:vcl/miscellaneous/validator.adoc#max-validator[MaxValidator]
* xref:vcl/miscellaneous/validator.adoc#min-validator[MinValidator]
* xref:vcl/miscellaneous/validator.adoc#negative-or-zero-validator[NegativeOrZeroValidator]
* xref:vcl/miscellaneous/validator.adoc#negative-validator[NegativeValidator]
* xref:vcl/miscellaneous/validator.adoc#not-blank-validator[NotBlankValidator]
* xref:vcl/miscellaneous/validator.adoc#not-empty-validator[NotEmptyValidator]
* xref:vcl/miscellaneous/validator.adoc#not-null-validator[NotNullValidator]
* xref:vcl/miscellaneous/validator.adoc#positive-or-zero-validator[PositiveOrZeroValidator]
* xref:vcl/miscellaneous/validator.adoc#positive-validator[PositiveValidator]
* xref:vcl/miscellaneous/validator.adoc#regexp-validator[RegexpValidator]
* xref:vcl/miscellaneous/validator.adoc#size-validator[SizeValidator]

下面的例子中，我们展示为 `hobbyValidField` 使用 `NotEmptyValidator`：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=validator]
----

[[handling-user-input]]
== 处理用户输入

用 `setEnterPressHandler()` 方法支持用户输入初始下拉列表中没有的值，并将输入的值保存至选项列表而无需再次输入：

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=options-list-2;new-option-handler;init-end]
----

`setEnterPressHandler()` 会在用户输入值并按下回车时调用。然后会在选项列表加入输入的新值，之后都能使用。

[[handlers]]
== 事件和处理器

include::../events-hanlers-generation-tip.adoc[]

[[context-help-icon-click-handler]]
=== ContextHelpIconClickHandler

参阅 xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickHandler]。

[[enter-press-handler]]
=== EnterPressHandler

参考 `ComboBox` 的 <<handling-user-input,处理用户输入>> 章节的示例，如何以编程的方式进行注册。

`EnterPressHandler` 也可以在界面控制器用 `@Install` 注解声明式的注册。参考 `EntityComboBox` 的 xref:vcl/components/entity-combo-box.adoc#handling-user-input[处理用户输入] 章节的示例。

[[options-caption-filter]]
=== OptionsCaptionFilter

`OptionsCaptionFilter` 用来测试选项的标题是否与搜索字符串匹配。

下面例子中，检查用户输入的搜索字符串是否匹配选项标题（考虑大小写）。

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=options-caption-filter]
----

如需编程式的设置这个检查断言，可以用组件的 `setOptionsCaptionFilter()` 方法。

[[option-caption-provider]]
=== OptionCaptionProvider

参阅 xref:vcl/api.adoc#option-caption-provider[OptionCaptionProvider]。

[[option-icon-provider]]
=== OptionIconProvider

每个下拉列表选项的左侧可以有一个图标，需要实现 `HasOptionIconProvider` 接口：

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=icon-combo-box;options-map-2;init-end;icon-map;icon-provider]
----

image::vcl/components/combo-box-icons.png[align="center"]

如需编程式的设置图标的 provider，可以用组件的 `setOptionIconProvider()` 方法。

[[option-image-provider]]
=== OptionImageProvider

`OptionImageProvider` 代理方法可以为 `ComboBox` 组件的选项定义图片：

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=image;options-map-2;image-create;init-end;option-image-provider]
----

代理返回一种 xref:vcl/components/image.adoc#resources[resource 类型]。

image::vcl/components/combo-box-option-image-provider.png[align="center"]

如需编程式注册选项图片 provider，可以用组件的 `setOptionImageProvider()` 方法。

[[option-style-provider]]
=== OptionStyleProvider

参阅 xref:vcl/api.adoc#option-style-provider[OptionStyleProvider]。

[[validator]]
=== Validator

为组件添加 xref:vcl/miscellaneous/validator.adoc[validator] 实例。如果值验证失败，`validator` 必须抛出 `ValidationException` 异常。

如果 <<predefined-validators,预定义>> 的验证器不能满足要求，可以添加自定义验证器：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=validator]
----

[[value-change-event]]
=== ValueChangeEvent

参阅 xref:vcl/api.adoc#value-change-event[ValueChangeEvent]。

[[xml]]
== ComboBox XML 属性

include::../xml-studio-tip.adoc[]

xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#buffered[buffered] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#editable[editable] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
<<filter-mode,filterMode>> -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#input-prompt[inputPrompt] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
<<null-name,nullName>> -
<<null-option-visible,nullOptionVisible>> -
<<options-enum,optionsEnum>> -
<<paging,pageLength>> -
xref:vcl/xml.adoc#property[property] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
<<text-input-allowed,textInputAllowed>> -
xref:vcl/xml.adoc#tab-index[tabIndex] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

== ComboBox XML 元素

<<validators-element,validator>>

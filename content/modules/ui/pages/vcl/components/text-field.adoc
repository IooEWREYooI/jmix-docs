= TextField 文本框
:page-aliases: backoffice-ui:vcl/components/text-field.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=textfield-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`TextField - 文本框` 是用于文本编辑的组件，可以用于处理实体属性，也可用于输入/显示任何文本信息。

组件的 XML 名称：`textField`。

[[basics]]
== 基本用法

示例：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/textfield/textField-screen.xml[tags=simple-text-field]
----

image::vcl/components/simple-text-field.png[align="center"]

如需创建关联至数据的 `TextField`，可以用 XML 的 xref:vcl/xml.adoc#data-container[dataContainer] 和 xref:vcl/xml.adoc#property[property] 属性：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/textfield/textField-screen.xml[tags=data-aware-text-field]
----

如上所示，界面描述中为具有 `firstName` 属性的 `Customer` 定义了数据容器 `customerDc`。`TextField` 通过 `dataContainer` 属性连接到数据容器，`property` 属性设置为要显示在 `TextField` 中的实体属性的名称。

[[attributes]]
== 属性

[[data-type]]
=== datatype
如果文本框没有连接到任何实体属性（即，未设置数据容器和属性名称），可以使用 `datatype` 属性设置数据类型。数据类型用来格式化控件值。`datatype` 属性值可以是应用程序元数据中注册的任何 xref:data-model:data-types.adoc[数据类型]。

通常，`TextField` 使用下面的数据类型：

* `decimal`
* `double`
* `int`
* `long`

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/textfield/textField-screen.xml[tags=integer-text-field]
----

[[max-length]]
=== maxLength

如果 `TextField` 连接到实体属性（通过 `dataContainer` 和 `property`），并且实体属性具有定义在 `@Column` JPA 注解中的 `length` 参数，那么 `TextField` 将相应地限制输入文本的最大长度。

如果 `TextField` 未链接到属性，或者属性未定义 `length` 值，或者需要覆盖此值，则可以使用 `maxLength` 属性限制输入文本的最大长度。值 "-1" 表示没有限制。示例：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/textfield/textField-screen.xml[tags=short-text-field]
----

[[trim]]
=== trim

默认情况下，`TextField` 会截去字符串的前后空格。例如，用户输入 "  aaa bbb  "，则 `getValue()` 方法返回并保存到连接实体属性的控件值将为 "aaa bbb"。可以将 `trim` 属性设置为 `false` 来禁用此功能。

请注意，去除空格仅在用户输入新值时起作用。如果连接属性的值中已包含空格，则将显示空格，直到用户编辑该值。

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/textfield/textField-screen.xml[tags=trim-text-field]
----

`TextField` 始终返回 `null` 而不是输入的空字符串。因此，启用 `trim` 属性后，任何只包含空格的字符串都将转换为 `null`。

[[html-name]]
=== htmlName

文本输入在 HTML 中以 `input` 组件展示，`htmlName` 用于设置 `input` 的 `name` 属性值。

[[conversions]]
== 转换

[[case-conversion]]
=== 大小写转换

`TextField` 支持自动大小写转换。`caseConvertion` 属性包含下列取值：

* `UPPER` - 转换为大写。
* `LOWER` - 转换为小写。
* `NONE` - 不转换（默认值）。用这个选项来支持在输入法连续输入（比如，在输入中文、日文、韩文的时候）。

[[data-type-conversion]]
=== 数据类型转换

如果用户输入了一个无法通过 xref:data-model:data-types.adoc[数据类型] 解析的值，则会显示默认的转换错误消息。

下面是一个数据类型是 `Integer` 的 `TextField`：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/textfield/textField-screen.xml[tags=integer-text-field]
----

如果用户输入的字符不能解析为整数，应用程序将显示默认的错误消息。

image::vcl/components/integer-text-field.png[align="center"]

默认的错误消息可以按照 xref:data-model:data-types.adoc#conversion-error[错误消息转换] 章节介绍的方法在项目中进行全局定义。

[[conversion-error-message]]
可以在界面 XML 描述中声明式的定义自己的类型转换错误消息，使用 `conversionErrorMessage` 属性，示例：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/textfield/textField-screen.xml[tags=conversion-text-field]
----

或者在界面控制器中通过编程的方式创建：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/textfield/TextFieldScreen.java[tags=conversion-text-field]
----

[[validators-element]]
== 验证

如需验证 `TextField` 组件的值，可以在内部的 `validators` 元素使用 xref:vcl/miscellaneous/validator.adoc[validator]。

[[predefined-validators]]
`TextField` 可以使用下列预定义的 validators：

* xref:vcl/miscellaneous/validator.adoc#custom-validator[CustomValidator]
* xref:vcl/miscellaneous/validator.adoc#decimal-max-validator[DecimalMaxValidator]
* xref:vcl/miscellaneous/validator.adoc#decimal-min-validator[DecimalMinValidator]
* xref:vcl/miscellaneous/validator.adoc#digits-validator[DigitsValidator]
* xref:vcl/miscellaneous/validator.adoc#double-max-validator[DoubleMaxValidator]
* xref:vcl/miscellaneous/validator.adoc#double-min-validator[DoubleMinValidator]
* xref:vcl/miscellaneous/validator.adoc#email-validator[EmailValidator]
* xref:vcl/miscellaneous/validator.adoc#max-validator[MaxValidator]
* xref:vcl/miscellaneous/validator.adoc#min-validator[MinValidator]
* xref:vcl/miscellaneous/validator.adoc#negative-or-zero-validator[NegativeOrZeroValidator]
* xref:vcl/miscellaneous/validator.adoc#negative-validator[NegativeValidator]
* xref:vcl/miscellaneous/validator.adoc#not-blank-validator[NotBlankValidator]
* xref:vcl/miscellaneous/validator.adoc#not-empty-validator[NotEmptyValidator]
* xref:vcl/miscellaneous/validator.adoc#not-null-validator[NotNullValidator]
* xref:vcl/miscellaneous/validator.adoc#positive-or-zero-validator[PositiveOrZeroValidator]
* xref:vcl/miscellaneous/validator.adoc#positive-validator[PositiveValidator]
* xref:vcl/miscellaneous/validator.adoc#regexp-validator[RegexpValidator]
* xref:vcl/miscellaneous/validator.adoc#size-validator[SizeValidator]

下面例子中，我们演示 `textValidField` 如何使用 `NegativeValidator`：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/textfield/textField-screen.xml[tags=validator]
----

[[styles]]
== 样式

可以在界面 XML 或者控制器中使用 `stylename` 属性为 `TextField` 组件设置预定义样式：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/textfield/textField-screen.xml[tags=styled-text-field]
----

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/textfield/TextFieldScreen.java[tags=styled-text-field]
----

* `align-center` - 使文本在文本框中居中显示。
* `align-right` - 使文本在文本框中居右显示。
* `borderless` - 删除文本框的边框和背景。
* `inline-icon` - 使图标显示在文本框里面。

[[methods]]
== 方法

* 使用 `setCursorPosition()` 方法可使控件获得焦点并将光标位置设置为指定索引位置，索引位置从 0 开始。

[[handlers]]
== 事件和处理器

include::../events-hanlers-generation-tip.adoc[]

[[context-help-icon-click-event]]
=== ContextHelpIconClickEvent

参阅 xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickEvent]。

[[enter-press-event]]
=== EnterPressEvent

参阅 xref:vcl/api.adoc#enter-press-event[EnterPressEvent]。

[[formatter]]
=== 格式化器

为组件添加 xref:vcl/miscellaneous/formatter.adoc[formatter] 实例。

下面示例中，我们演示为 `customerField` 文本框使用 `formatter`：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/textfield/TextFieldScreen.java[tags=formatter]
----

如需以编程的方式添加 formatter，使用组件的 `addFormatter()` 方法。

[[text-change-event]]
=== TextChangeEvent

`TextChangeEvent` 当用户在组件内输入一些内容时发送。事件会在输入时异步发送，防止阻塞用户输入。

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/textfield/TextFieldScreen.java[tags=text-field-change-event]
----

如需以编程的方式注册事件处理器，使用组件的 `addTextChangeListener()` 方法。

[[text-change-event-mode]]
`TextChangeEventMode` 定义文本的变化被发送到服务器并触发服务端事件的方式。有 3 种预定义的事件模式：

* `LAZY`（默认）- 文件输入暂停时触发事件。暂停时间可以通过 `setInputEventTimeout()` 修改。
* `TIMEOUT` - 一定时间超时后触发事件。可以使用 `setInputEventTimeout()` 设置超时时长。
* `EAGER` - 对于文本内容的每次更改，都会立即触发事件，通常是由按键触发。
* `BLUR` - 文本控件失去焦点时，发送事件。

[[text-change-timeout]]
`textChangeTimeout` 属性可以修改当 `TextChangeEventMode` 是 `LAZY` 或 `TIMEOUT` 时，事件与应用程序沟通的频率。

编程式用法，调用组件的 `setTextChangeEventMode()` 方法。

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/textfield/TextFieldScreen.java[tags=event-mode]
----

[[validator]]
=== Validator

为组件添加 xref:vcl/miscellaneous/validator.adoc[validator] 实例。如果值验证失败，`validator` 必须抛出 `ValidationException` 异常。

如果 <<predefined-validators,预定义>> 的验证器不能满足要求，可以添加自定义的验证器实例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/textfield/TextFieldScreen.java[tags=validator]
----

[[value-change-event]]
=== ValueChangeEvent

参阅 xref:vcl/api.adoc#value-change-event[ValueChangeEvent]。

[[xml]]
== TextField XML 属性

include::../xml-studio-tip.adoc[]

xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#buffered[buffered] -
<<case-conversion, caseConversion>> -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
<<conversion-error-message, conversionErrorMessage>> -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
<<data-type, dataType>> -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#editable[editable] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
<<html-name, htmlName>> -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
xref:vcl/xml.adoc#input-prompt[inputPrompt] -
<<max-length, maxLength>> -
xref:vcl/xml.adoc#property[property] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/xml.adoc#tab-index[tabIndex] -
<<text-change-event-mode, textChangeEventMode>> -
<<text-change-timeout, textChangeTimeout>> -
<<trim, trim>> -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

== TextField XML 元素

xref:vcl/miscellaneous/formatter.adoc[formatter] -
<<validators-element,validators>>

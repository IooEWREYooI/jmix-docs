= PropertyFilter
:page-aliases: backoffice-ui:vcl/components/property-filter.adoc

`PropertyFilter - 属性过滤器` 组件用来展示单一过滤条件。组件与 xref:data-model:entities.adoc[实体] 属性关联，并能自动渲染适合的布局用来设定条件值。

该组件可以在 `Filter` 组件内使用或者独立使用。

组件的 XML 名称：`propertyFilter`。

== 基本用法

一般情况下，`PropertyFilter` 包含一个实体属性标题的标签、一个运算符标签或者选择器（`=`、`contains`、`in`、`>` 等）以及一个用于编辑条件值的字段。

image::vcl/components/property-filter.png[align="center"]

`propertyFilter` 的声明示例如下。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/propertyfilter/property-filter-screen.xml[tags=data-start;customers;data-end;layout-start;property-filter-simple;layout-end]
----

`dataLoader`、`property` 和 `operation` 都是必需属性。

* `dataLoader` 设置当前 `PropertyFilter` 关联的数据加载器。
[[property]]
* `property` 包含实体属性名或者属性路径（例如，`name`、`order`、`order.date`）。

一个界面中可以使用多个 `PropertyFilter` 组件。数据加载器会使用提供了值的过滤器。

[[operation]]
== 条件运算符

`operation` 是必需属性，设置过滤运算符。有下列类型：

* `EQUAL` 适合字符串、数字、日期、引用属性。结果中的实体实例要满足：其属性列与过滤器中的条件值匹配。
* `NOT_EQUAL` 适合字符串、数字、日期、引用属性。结果中的实体实例要满足：其属性列与过滤器中的条件值不匹配。
* `GREATER` 适合数字和日期属性。结果中的实体实例要满足：其属性列大于过滤器中的条件值。
* `GREATER_OR_EQUAL` 适合数字和日期属性。结果中的实体实例要满足：其属性列大于等于过滤器中的条件值。
* `LESS` 适合数字和日期属性。结果中的实体实例要满足：其属性列小于过滤器中的条件值。
* `LESS_OR_EQUAL` 适合数字和日期属性。结果中的实体实例要满足：其属性列小于等于过滤器中的条件值。
* `CONTAINS` 适合字符串属性。结果中的实体实例要满足：其属性列包含过滤器中的条件值。
* `NOT_CONTAINS` 适合字符串属性。结果中的实体实例要满足：其属性列不包含过滤器中的条件值。
* `STARTS_WITH` 适合字符串属性。结果中的实体实例要满足：其属性列以过滤器中的条件值开头。
* `ENDS_WITH` 适合字符串属性。结果中的实体实例要满足：其属性列以过滤器中的条件值结尾。
* `IS_SET` 适合字符串、数字、日期、引用属性。该运算符仅检测属性列的数据不是 null。为该运算符生成的 xref:vcl/components/combo-box.adoc[ComboBox] 仅包含两个值：`true` 和 `false`。如果用户选择 `true`，结果包含实体实例满足：该列有数据。否则，结果包含该列没有数据的实体实例。
* `IN_LIST` 适合字符串、数字、日期、引用属性。结果中的实体实例要满足：其属性列匹配列表中的任一项。
* `NOT_IN_LIST` 适合字符串、数字、日期、引用属性。结果中的实体实例要满足：其属性列不匹配列表中的任一项。
* `DATE_INTERVAL` 适合日期属性。结果中的实体实例要满足：其属性列匹配 <<date-conditions,日期时间段编辑器>> 中设置的值。

`PropertyFilter` 可以根据对应实体属性类型和运算符自动确定并展示条件值组件。例如，对于字符串和数字类型的属性，应用程序使用 xref:vcl/components/text-field.adoc[TextField]，`Date` - xref:vcl/components/date-field.adoc[DateField]，枚举 - xref:vcl/components/combo-box.adoc[ComboBox]，实体引用 - xref:vcl/components/entity-picker.adoc[EntityPicker]，对于 `IN_LIST` 和 `NOT_IN_LIST`，则使用 xref:vcl/components/values-picker.adoc[ValuesPicker] 组件。

[[operation-caption-visible]]
`operationCaptionVisible` 属性定义运算符是否可见。可能值 `true` 和 `false`（默认为 `true`）。

[[operation-editable]]
使用 `operationEditable` 属性设置运算符选择器是否展示。可能值 `true` 和 `false`（默认为 `false`）。如果设置 `operationEditable = true`，运算符字段支持在运行时选择运算符。根据属性类型决定可选的运算符列表。

[[date-conditions]]
== 日期条件

`PropertyFilter` 有 `DATE_INTERVAL` 运算符。对于此运算符，应用程序使用带自定义操作的 xref:vcl/components/value-picker.adoc[ValuePicker] 组件。支持打开对话框配置日期时段。

image::vcl/components/date-interval-dialog.png[align="center"]

== 自动应用
[[auto-apply]]
`autoApply` 属性设置该过滤器的条件值改变时，是否会自动应用新条件。默认为 `true`。

== 名称管理

[[caption]]
可以用 `caption` 属性设置该过滤器的自定义名称。如果未指定，则根据实体属性名和运算符名（如果 <<operation-caption-visible,operationCaptionVisible>> 设置为 `true`）自动生成。

[WARNING]
====
如果设置了 `caption` 属性。<<operation,运算符>> 标签或选择器将会隐藏。
====
[[caption-position]]
`captionPosition` 属性定义过滤器名称的位置：`TOP` 或 `LEFT`。默认为 `LEFT`。

[[caption-width]]
`captionWidth` 属性定义 `PropertyFilter` 标题的固定宽度。设置为 `-1` 使用自动宽度。

[[default-value]]
== 默认值

可以在 `defaultValue` 属性设置过滤器条件的默认值。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/propertyfilter/property-filter-screen.xml[tags=property-filter-defaultValue]
----
[[parameter-name]]
== 参数名

`parameterName` 属性设置关联的查询语句中条件使用的参数名称。如果未定义，则随机生成。

== 支持 KeyValueCollectionContainer

`PropertyFilter` 可以绑定 `KeyValueCollectionContainer`，示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/propertyfilter/property-filter-screen.xml[tags=data-start;key-value-collection;data-end;layout-start;property-filter-key-collection;layout-end]
----

`PropertyFilter` 不支持包含聚合函数（`COUNT`、`SUM`、`AVG`、`MIN`、`MAX`）的键值对属性。

[[handlers]]
== 事件和处理器

include::../events-hanlers-generation-tip.adoc[]

[[context-help-icon-click-handler]]
=== ContextHelpIconClickHandler

参阅 xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickHandler]。

[[operation-change-event]]
=== OperationChangeEvent

`OperationChangeEvent` 当 `operation` 属性变更时发送。

下面示例为 XML 中 id 是 `hobbyFilter` 的 `propertyFilter` 订阅了该事件：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/propertyfilter/PropertyFilterScreen.java[tags=operation-change-event]
----

如需以编程的方式注册事件处理器，使用组件的 `addOperationChangeListener()` 方法。

[[value-change-event]]
=== ValueChangeEvent

`ValueChangeEvent` 当用户完成输入值时发送，例如，在按下 *Enter* 或者组件失去焦点时。`ValueChangeEvent` 有下列方法：

* `getPrevValue()` 返回组件修改前的值。
* `getValue()` 返回组件当前值。

下面示例为 XML 中 id 是 `hobbyFilter` 的 `propertyFilter` 订阅了该事件：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/propertyfilter/PropertyFilterScreen.java[tags=value-change-event]
----

如需以编程的方式注册事件处理器，使用组件的 `addValueChangeListener()` 方法。

[[xml]]
== XML 属性

include::../xml-studio-tip.adoc[]

xref:vcl/xml.adoc#align[align] -
<<auto-apply,autoApply>> -
<<caption,caption>> -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
<<caption-position,captionPosition>> -
<<caption-width,captionWidth>> -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-loader[dataLoader] -
<<default-value,defaultValue>> -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#editable[editable] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
<<operation,operation>> -
<<operation-caption-visible,operationCaptionVisible>> -
<<operation-editable,operationEditable>> -
<<parameter-name,parameterName>> -
<<property,property>> -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/xml.adoc#tab-index[tabIndex] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

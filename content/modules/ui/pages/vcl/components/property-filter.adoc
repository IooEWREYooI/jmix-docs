= PropertyFilter

Компонент `PropertyFilter` используется для отображения одного условия фильтрации. Он связан со свойством xref:data-model:entities.adoc[entity] и может автоматически отображать нужную компоновку для установки значения условия.

Данный компонент может использоваться как внутри компонента `Filter`, так и отдельно от него.

XML-имя компонента: `propertyFilter`.

== Основы

В общем случае `PropertyFilter` состоит из надписей с именем свойства сущности, с операцией (`=`, `contains`, `in`, `>`, и т.д.) и поля для редактирования значения условия.

image::vcl/components/property-filter.png[align="center"]

Пример объявления `propertyFilter` приведен ниже.

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/propertyfilter/property-filter-screen.xml[tags=data-start;customers;data-end;layout-start;property-filter-simple;layout-end]
----

`dataLoader`, `property`, и `operation` являются обязательными атрибутами.

* `dataLoader` задает загрузчик данных, связанный с текущим `PropertyFilter`.
[[property]]
* `property` содержит имя атрибута сущности или путь к атрибуту (например, `name`, `order`, `order.date`).

Можно использовать несколько компонентов `PropertyFilter` в экране. Имеющие значения компоненты применяются к загрузчикам данных.

[[operation]]
== Операции

`operation` – обязательный атрибут, который задает операцию фильтрации. Операция может быть следующих типов:

* `EQUAL` подходит для строковых, числовых, ссылочных атрибутов и атрибутов даты. Результаты включают только те экземпляры сущностей, у которых значение атрибута равно значению условия в фильтре.
* `NOT_EQUAL` подходит для строковых, числовых, ссылочных атрибутов и атрибутов даты. Результаты включают только те экземпляры сущностей, у которых значение атрибута не равно значению условия в фильтре.
* `GREATER` подходит для числовых атрибутов и атрибутов даты. Результаты включают только те экземпляры сущностей, у которых значение атрибута больше значения условия в фильтре.
* `GREATER_OR_EQUAL` подходит для числовых атрибутов и атрибутов даты. Результаты включают только те экземпляры сущностей, у которых значение атрибута больше или равно значению условия в фильтре.
* `LESS` подходит для числовых атрибутов и атрибутов даты. Результаты включают только те экземпляры сущностей, у которых значение атрибута меньше значения условия в фильтре.
* `LESS_OR_EQUAL` подходит для числовых атрибутов и атрибутов даты. Результаты включают только те экземпляры сущностей, у которых значение атрибута меньше или равно значению условия в фильтре.
* `CONTAINS` подходит для строковых атрибутов. Результаты включают только те экземпляры сущностей, у которых значение атрибута содержит значение условия в фильтре.
* `NOT_CONTAINS` подходит для строковых атрибутов. Результаты включают только те экземпляры сущностей, у которых значение атрибута не содержит значение условия в фильтре.
* `STARTS_WITH` подходит для строковых атрибутов. Результаты включают только те экземпляры сущностей, у которых значение атрибута начинается со значения условия в фильтре.
* `ENDS_WITH` подходит для строковых атрибутов. Результаты включают только те экземпляры сущностей, у которых значение атрибута заканчивается значением условия в фильтре.
* `IS_SET` подходит для строковых, числовых, ссылочных атрибутов и атрибутов даты. Оператор проверяет только те значения атрибутов, которые не являются нулевыми. Компонент xref:vcl/components/combo-box.adoc[ComboBox], созданный для этой операции, отображает два значения: `true` и `false`. Если пользователь выбирает `true`, результаты включают только те экземпляры сущностей, у которых есть значение атрибута. В противном случае результаты включают только те экземпляры сущностей, у которых нет значения атрибута.
* `IN_LIST` подходит для строковых, числовых, ссылочных атрибутов и атрибутов даты. Результаты включают только те экземпляры сущностей, у которых значение атрибута соответствует любому элементу списка.
* `NOT_IN_LIST` подходит для строковых, числовых, ссылочных атрибутов и атрибутов даты. Результаты включают только те экземпляры сущностей, у которых значение атрибута не соответствует ни одному элементу списка.
* `DATE_INTERVAL` подходит для атрибутов даты. Результаты включают только те экземпляры сущностей, у которых значение атрибута соответствует значению, заданному в <<date-conditions,Редакторе интервалов дат>>.

`PropertyFilter` может автоматически определять и отображать компонент для ввода значения согласно типу соответствующего свойства сущности и операции. Например, для строковых и числовых атрибутов приложение использует xref:vcl/components/text-field.adoc[TextField], для `Date` – xref:vcl/components/date-field.adoc[DateField], для enum значений – xref:vcl/components/combo-box.adoc[ComboBox], для ссылок на другие сущности – xref:vcl/components/entity-picker.adoc[EntityPicker]. Для `IN_LIST` и `NOT_IN_LIST` приложение использует компонент xref:vcl/components/values-picker.adoc[ValuesPicker].

[[using-custom-components]]
`PropertyFilter` also supports custom UI components for its value. You may describe UI component inside the `propertyFilter` tag.

For example, you can use xref:ui:vcl/components/entity-combo-box.adoc[EntityComboBox] instead of `EntityPicker`:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/propertyfilter/property-filter-screen.xml[tags=data-start;customers;cities;data-end;layout-start;property-filter-custom-component;layout-end]
----

You can use `EntityPicker` with custom lookup screen, for example:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/propertyfilter/property-filter-screen.xml[tags=property-filter-custom-component2]
----

[[operation-caption-visible]]
Атрибут `operationCaptionVisible` определяет видимость заголовка операции. Возможные значения – `true` и `false` (по умолчанию `true`).

[[operation-editable]]
Используя атрибут `operationEditable` можно задать видимость селектора операции. Возможные значения – `true` и `false`. Значение по умолчанию – `false`. Если задать `operationEditable = true`, то поле операции позволит выбирать оператор условия во время выполнения. Список доступных операторов зависит от типа атрибута.

[[date-conditions]]
== Условия даты

`PropertyFilter` имеет операцию `DATE_INTERVAL`. Для нее приложение использует компонент xref:vcl/components/value-picker.adoc[ValuePicker] со специальным действием. Это позволяет отображать диалоговое окно для настройки интервала дат.

image::vcl/components/date-interval-dialog.png[align="center"]

== Автоматическое применение
[[auto-apply]]
Атрибут `autoApply` задает, должен ли фильтр свойств автоматически применяться к загрузчику данных при изменении значения условия. Значение по умолчанию – `true`.

== Настройка Caption

[[caption]]
С помощью атрибута `caption` можно задать собственные надписи для условий фильтра. Если значение не задано, то они генерируются автоматически на основе имени свойства сущности и ярлыка операции (если <<operation-caption-visible,operationCaptionVisible>> установлено в `true`).

[WARNING]
====
Если атрибут `caption` задан, то <<operation,операция>> не отображается.
====
[[caption-position]]
Атрибут `captionPosition` определяет расположение надписи: `TOP` или `LEFT`. Значение по умолчанию – `LEFT`.

[[caption-width]]
Атрибут `captionWidth` задает фиксированную ширину надписи для `PropertyFilter`. Установите значение `-1`, чтобы использовать автоматический размер.

[[default-value]]
== Значение по умолчанию

В атрибуте `defaultValue` можно установить значение по умолчанию для условия фильтра.

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/propertyfilter/property-filter-screen.xml[tags=property-filter-defaultValue]
----
[[parameter-name]]
== Имя параметра

Атрибут `parameterName` задает имя связанного параметра запроса, используемого условием. Если значение не задано, то имя параметра генерируется случайным образом.

== Поддержка KeyValueCollectionContainer

`PropertyFilter` может быть привязан к `KeyValueCollectionContainer`, например:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/propertyfilter/property-filter-screen.xml[tags=data-start;key-value-collection;data-end;layout-start;property-filter-key-collection;layout-end]
----

`PropertyFilter` не поддерживает свойства key-value, содержащие агрегатные функции (`COUNT`, `SUM`, `AVG`, `MIN`, `MAX`).

[[handlers]]
== События и слушатели

include::../events-hanlers-generation-tip.adoc[]

[[context-help-icon-click-handler]]
=== ContextHelpIconClickHandler

См. xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickHandler].

[[operation-change-event]]
=== OperationChangeEvent

`OperationChangeEvent` отправляется при изменении свойства `operation`. Пример подписки на событие `propertyFilter`, объявленного в XML с идентификатором `hobbyFilter`:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/propertyfilter/PropertyFilterScreen.java[tags=operation-change-event]
----

Чтобы создать слушателя события программно, используйте метод компонента `addOperationChangeListener()`.

[[value-change-event]]
=== ValueChangeEvent

`ValueChangeEvent` отправляется при изменении значения, когда пользователь завершил его ввод, например, после нажатия кнопки *Enter* или потере компонентом фокуса. `ValueChangeEvent` имеет следующие методы:

* `getPrevValue()` возвращает значение компонента до изменения.
* `getValue()` возвращает текущее значение компонента.

Пример подписки на событие `propertyFilter`, объявленного в XML с идентификатором `hobbyFilter`:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/propertyfilter/PropertyFilterScreen.java[tags=value-change-event]
----

Чтобы создать слушателя события программно, используйте метод компонента `addValueChangeListener()`.

[[xml]]
== Все XML-атрибуты

include::../xml-studio-tip.adoc[]

xref:vcl/xml.adoc#align[align] -
<<auto-apply,autoApply>> -
<<caption,caption>> -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
<<caption-position,captionPosition>> -
<<caption-width,captionWidth>> -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-loader[dataLoader] -
<<default-value,defaultValue>> -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#editable[editable] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
<<operation,operation>> -
<<operation-caption-visible,operationCaptionVisible>> -
<<operation-editable,operationEditable>> -
<<parameter-name,parameterName>> -
<<property,property>> -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/xml.adoc#tab-index[tabIndex] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]
= Table
:page-aliases: backoffice-ui:vcl/components/table.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=table-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`Table - 表格` 组件以表格的方式展示信息、对数据进行排序、管理表格列和表头，并对选中的行执行操作。

组件的 XML 名称：`table`。

[[basics]]
== 基本用法

典型的表格如下所示：

image::vcl/components/table-anatomy.png[align="center"]

. 表头
. 数据行
. 列控制按钮
. 分页器
. 排序按钮
. 按钮面板

在界面 XML 描述中定义表格组件的示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=data-start;collection-customers;data-end;layout-start;table;layout-end;]
----

在上面的示例中，为 `Customer` 实体使用了 xref:data/collection-container.adoc[集合数据容器]。`Table` 组件通过 `dataContainer` 属性与数据容器绑定，`columns` 元素定义那些实体属性要显示在数据网格的列中。

[[data-binding]]
== 数据绑定

[[declarative-binding]]
=== 声明式绑定

通常，使用 `dataContainer` 属性在界面 XML 描述中将数据与 `table` 绑定。此时需要使用一个 xref:data/collection-container.adoc[集合数据容器]。

[[using-key-value-containers]]
=== 使用键值对容器

表格还可以绑定至 xref:data/key-value-containers.adoc[键值对容器] 展示查询的纯数值和聚合值。示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=data-start;key-value-collection-sales;data-end;layout-start;key-value-table;layout-end;]
----

[[meta-class]]
=== 编程式绑定

如需以编程的方式在界面控制器定义数据容器，则可以在 XML 中设置 xref:vcl/xml.adoc#meta-class[metaClass] 属性而非 xref:vcl/xml.adoc#data-container[dataContainer]。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=meta-class-table]
----

界面控制器中，使用 `ContainerTableItems` 类将表格和数据容器绑定：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=programmatic-binding]
----

[[columns]]
== columns 元素

表格的列集合定义在 `columns` 元素中。如果未指定，则通过 `dataContainer` 定义的 xref:data-access:fetching.adoc#fetch-plan[fetch plan] 自动确定。

`columns` 元素有如下属性：

[[include-all]]
* `includeAll` 加载 `dataContainer` 中定义的 `fetchPlan` 的所有属性。
+
在下面的例子中，我们显示了 `customersDc` 中使用 fetch plan 的所有属性：
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=columns-include-all]
----
+
如果实体的 fetch plan 包含引用属性，该属性会按照其 xref:data-model:entities.adoc#instance-name[实例名] 进行展示。如果需要展示一个特定的级联属性，则需要在 fetch plan 和 `column` 元素中定义：
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=data-start;collection-customers-with-country;data-end;layout-start;columns-include-all-reference;layout-end]
----

[[exclude]]
* `exclude` `exclude` 英文逗号分隔的属性列表，这些属性不会被加载到表格。
+
在下面的例子中，我们会显示除了 `id`、`maritalStatus` 和 `email` 之外的所有属性：
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=columns-exclude]
----

[[column]]
=== column 元素

每一列是在内部的 `column` 元素中描述。

[[column-id]]
`id` 是一个必需属性，指定展示在列中实体属性的名称。可以是数据容器中实体的一个属性或者一个关联实体（用 `.` 访问对象关系图）。示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-column]
----

[[column-alignment]]
=== 列对齐

支持三种类型的列对齐方式：`LEFT`（默认）、`CENTER`、`RIGHT`。

通常数字采用右对齐，而其他内容采用左对齐。示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=key-value-table]
----

image::vcl/components/table-column-align.png[align="center"]

[[column-caption-options]]
=== 列标题

[[column-caption]]
`caption` - 可选属性，定义列标题。如果未设置，会使用实体属性的 xref:localization:message-bundles.adoc#localizing-data-model[本地化名称]。

[[column-caption-as-html]]
`captionAsHtml` - 可选属性，定义是否可以在列标题中使用 HTML 标签。默认为 `false`。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-caption-column]
----
<1> 列标题含有 HTML 标签：
+
[source,properties,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/messages.properties[tags=table-column-message]
----
<2> 默认标题列

image::vcl/components/table-captions.png[align="center"]

[[column-visibility]]
=== 列可见性

[[column-collapsed]]
`collapsed` - 可选属性，设置为 `true` 时自动隐藏该列。`collapsed` 属性默认值为 `false`。用户可以通过表格右上角的 image:vcl/components/table-column-control-button.png[] 按钮提供的菜单控制列的可见性，此时需要设置 `columnControlVisible` 为 `true`。

[[column-visible]]
`visible` 属性设置列的可见性。可选值：`true`、`false`。默认所有列都可见。

下面示例中，我们看看 `collapsed` 和 `visible` 属性的不同之处：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-collapsed-column]
----

image::vcl/components/table-columns-visibility.gif[align="center"]

可以看到，`firstName` 列默认是折叠不显示的，但是用户可以通过 image:vcl/components/table-column-control-button.png[] 按钮的下拉菜单显示它。

同时，`lastName` 是无法通过用户操作看见的。

[[column-width]]
=== 列宽度

`width` - 可选属性，定义列宽。只支持以像素为单位的数值类型。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-width-column]
----

image::vcl/components/table-column-width.png[align="center"]

[[column-expand-ratio]]
`expandRatio` - 可选属性，设置列宽占比。比值必须大于等于 0。如果至少有一列设置了其他值，则忽略所有的隐式值，并且只使用设置的值。如果同时设置了 `width` 和 `expandRatio` 属性，会导致应用程序错误。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-expandRatio-column]
----

image::vcl/components/table-column-expand-ratio.png[align="center"]

用户可以调整列宽：

image::vcl/components/table-columns-resize.gif[align="center"]

只有当整个表的 `enable` 属性设置为 `false` 时，列才维持固定宽度。

[[reordering-allowed]]
=== 列重排

`Table` 提供拖拽功能，用户可以改变表格内列的展示顺序。

image::vcl/components/table-columns-reordering.gif[align="center"]

列重排的功能是默认开启的。如需禁用，可设置 `reorderingAllowed` 属性为 `false`。

[[link-to-edit-screen]]
=== 编辑界面链接

[[column-link]]
如果设置 `link` 属性为 `true`，则列的内容显示为一个指向实体编辑器的链接。这个方法可用于简化导航：用户能够通过单击一些关键属性快速地打开实体编辑器，例如，点击用户名称时。

[[column-link-screen-id]]
`linkScreenId` 属性指定点击链接时打开的界面标识符。如果未设置，则框架尝试打开 id 为 `\{entity_name\}.edit` 的界面。

[[column-link-screen-open-mode]]
`linkScreenOpenMode` 设置界面打开模式（`THIS_TAB`、`NEW_TAB`、`NEW_WINDOW` 或 `DIALOG`）。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-link-column]
----

image::vcl/components/table-columns-link.gif[align="center"]

[[column-max-text-length]]
=== Maximum Text Length

`maxTextLength` - 可选属性，允许限制单元格中的字符数。多余字符用省略号代替。用户可以点击可见部分来查看完整的文本。

如果实际值和最大允许字符数之间的差异不超过 10 个字符，则多余字符仍然显示。

下面例子中，有些单元格的值长度大于 `maxTextLength+10`，则省略。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-max-text-length]
----

image::vcl/components/table-max-text-length.png[align="center"]

[[column-formatter]]
=== 文本格式化

`column` 元素可以包含一个内部的 xref:vcl/miscellaneous/formatter.adoc[formatter] 元素，支持以不同于 `Datatype` 标准的格式显示属性值：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-column-formatter]
----

[[caption-property]]
=== 标题属性

`captionProperty` 属性指定一个要显示在列中的实体属性名称，而不是显示 `id` 指定的实体属性值。例如，如果有一个包含 `name` 和 `id` 属性的实体 `City`，则可以定义以下列：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-captionProperty]
----

此时，列中将会显示 `City` 实体的 `id` 属性，但是列的排序是根据 `City` 实体的 `name` 属性。

image::vcl/components/table-captions.png[align="center"]

[[multi-line-cells]]
== Multi-Line Cells

将 `multiLineCells` 设置为 `true` 可以让包含多行文本的单元格显示多行。在这种模式下，浏览器会一次加载表格中当前页的所有行，而不是延迟加载表格的可见部分。这样会使得数据带滚动条并可能影响性能。默认值为 `false`。

image::vcl/components/table-multi-line-cell.png[align="center"]

[[selection]]
== 选择

`Table` 组件支持对数据行进行单选和多选。

[[single-selection]]
=== 单选模式

在单选模式中，用户一次只能选择单一的数据行。这是表格默认的选择模式。

[[multiselect]]
=== 多选模式

`multiselect` 属性可以为表格行设置多选模式。如果 `multiselect` 为 `true`，用户可以按住 *Ctrl* 或 *Shift* 键在表格中选择多行。默认情况下关闭多选模式。

[[show-selection]]
=== Show Selection

如果 `showSelection` 属性设置为 `false`，则不高亮显示当前行。

[[text-selection-enabled]]
=== Text Selection

`textSelectionEnabled` 属性定义是否可以在单元格中选取文本。默认值 `false`。

== 空状态

在数据容器没有数据或者没有设置数据容器时，支持为 `Table` 设置展示空状态消息或链接。

[[empty-state-message]]
空状态消息通过 `emptyStateMessage` 属性定义。可以用于显示无数据的原因。

[[empty-state-link-message]]
空状态链接通过 `emptyStateLinkMessage` 属性定义。可以显示加载数据需要进行的操作。

示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-placeholder]
----

image::vcl/components/table-placeholder.png[align="center"]

[[empty-state-click-event]]
生成 `emptyStateLinkClickHandler` 处理空状态链接的点击：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=empty-state-link-click-handler]
----

如需以编程的方式注册点击处理器，使用组件的 `setEmptyStateLinkClickHandler()` 方法。

`emptyStateMessage` 和 `emptyStateLinkMessage` 属性都可以从 xref:localization:message-bundles.adoc#using-messages-in-ui[消息包] 中加载本地化消息。

[[column-header-visible]]
== 表头可见性

`columnHeaderVisible` 设置表格的表头是否展示。默认展示。

[[column-control-visible]]
== 列可见控制

用户可以用表格 header 右侧的 image:vcl/components/table-column-control-button.png[] 列控制按钮选择显示哪些列。

当前展示列在下拉列表中是勾选状态。其他的菜单项：

* `Select all` - 展示所有列。
* `Deselect all` - 隐藏除了第一列之外所有能隐藏的列。第一列必须显示，以保证表格功能正常。

image::vcl/components/table-column-control-using.png[align="center"]

如果 `columnControlVisible` 属性设置为 `false`，则用户不能隐藏列。

[[aggregatable]]
== 聚合

`Table` 支持对行内值进行聚合运算。

支持下列运算符：

* `SUM` - 求和
* `AVG` - 求平均值
* `COUNT` - 计数
* `MIN` - 最小值
* `MAX` - 最大值

如需启用对表格的行进行聚合运算，按照下列配置：

. 设置 `aggregatable` 属性值为 `true`。
. 为表格的聚合列设置 `aggregation` 元素。
+
[[aggregation-type]]
. 设置 `aggregation` 元素的 `type` 属性，表示聚合的函数。

聚合值展示在附加行中。

[[aggregation-style]]
`aggregationStyle` 属性可以设置聚合值行的位置：`TOP` 或 `BOTTOM`。默认为 `TOP`。

[NOTE]
====
默认情况下，聚合列只支持数字类型，比如 `Integer`、`Double`、`Long` 和 `BigDecimal`。
====

带聚合列的 `Table` XML 描述示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-aggregatable]
----

image::vcl/components/table-aggregation.png[align="center"]

[[aggregation-value-description]]
`valueDescription` 属性定义一个提示，当用户的光标悬停在聚合值上时通过弹出框展示这个提示。对于上面列出的运算（`SUM`、`AVG`、`COUNT`、`MIN`、`MAX`），提示弹窗已经默认开启。

[[aggregation-editable]]
`aggregation` 元素支持 `editable` 属性。设置该属性为 `true`，且配合使用 <<aggregation-distribution-provider,AggregationDistributionProvider>> 可以支持开发者实现在各行之间分配数据。

[[aggregation-formatter]]
可以指定不同于 `Datatype` 标准格式的 xref:vcl/miscellaneous/formatter.adoc[formatter] 显示聚合值：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-aggregation-format]
----

[[aggregation-strategy-class]]
`aggregation` 元素还可以包含 `strategyClass` 属性，指定一个实现 `AggregationStrategy` 接口的类。

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableCustomerHobbyAggregation.java[tags=aggregation-strategy]
----

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-aggregation-strategy]
----

== 排序

`Table` 支持对列数据进行排序。排序功能默认开启。

[[table-sorting]]
`sortable` 属性可以启用表格的排序功能。默认为 `true`。开启后，点击列名会在列名右边显示 image:vcl/components/table-sortable-down.png[]/image:vcl/components/table-sortable-up.png[] 图标。

[[column-sortable]]
使用特定 <<column,列>> 的 `sortable` 属性可以禁用该列的排序功能。

下面的例子中，我们禁用了 `lastName` 列的排序：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-sortable-column]
----

[[column-sort]]

`column` 元素的 `sort` 属性可以设置该列的初始排序。值选项：

* `ASCENDING` - 顺序（0 -> 9 -> A -> Z）。
* `DESCENDING` - 倒序（Z -> A -> 9 -> 0）。

示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-sort-column]
----

[CAUTION]
====
`Table` 一次只能按照一列进行排序。如果有多列设置了 `sort` 属性或者同时设置了 `sort` 和 `sortable="false"`，界面会报错。
====

[[paging]]
== 分页

`table` 可以使用 xref:vcl/components/simple-pagination.adoc[] 组件来提供分页功能：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-paging]
----

image::vcl/components/table-pagination.png[align="center"]

或者，可以使用独立的 xref:vcl/components/pagination.adoc[] 组件。

[[actions]]
== Table 操作

`Table` 组件实现了 `ActionsHolder` 接口，可以包含自定义操作和 xref:actions/standard-actions.adoc#list-actions[标准列表操作]。

表格的操作定义在内部的 `actions` 元素中。

如果操作有标题，则会显示在表格的 <<context-menu-enabled,右键菜单>> 中。此外，表格的操作可以分配给界面中任意位置的按钮。

[[buttons-panel]]
可以用 xref:vcl/containers/buttons-panel.adoc[ButtonsPanel] 容器在表格上方显示操作按钮。

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-actions-buttons-panel]
----
<1> 定义 `create` 标准操作。
<2> 定义 `about` 自定义操作。
<3> 在表格内定义 `ButtonsPanel` 容器。

image::vcl/components/table-actions.png[align="center"]

[[table-column-generation]]
== 列生成

通过 `columnGenerator` 处理器可以提供自定义的列数据展示。

在渲染表格时，事件处理器由框架对每个单元格进行调用。处理器接收对应渲染行的实体实例作为参数，返回在单元格中需要展示的可视化组件。

可以用 Studio 为表格列创建 `columnGenerator` 处理器（参阅 <<handlers,处理器>>），并实现如下：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=column-generator]
----

如只需展示动态文本，可以用特殊的 `Table.PlainTextCell` 类而不是 xref:vcl/components/label.adoc[Label] 组件。这样渲染更快，表格性能也更好。

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=column-generator-text]
----

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-generated-columns]
----

`fullName` 和 `isEmail` 是生成列。

image::vcl/components/table-generated-columns.png[align="center"]

如需以编程的方式注册列生成处理器，使用 `Table` 组件的 `addGeneratedColumn()` 方法。
该方法需要两个参数：列的标识符和 `Table.ColumnGenerator` 接口的实现。如果标识符可以匹配 XML 描述中为表格列设置的标识符，则用新列代替 XML 中定义的列。如果标识符与任何列都不匹配，则会在右侧添加新列。

`Table.ColumnGenerator` 接口的 `generateCell()` 方法与上面介绍的 `columnGenerator` 处理器等效：接收对应渲染行的实体实例作为参数，返回在单元格中需要展示的可视化组件。

[[exporting-column-values]]
== 列值导出

使用 xref:grid-export:index.adoc[表格导出] 扩展组件可以将 `Table` 组件的内容导出成支持的文件类型。

安装完组件后，可以为表格定义 xref:grid-export:actions.adoc#excel-export-action[excelExport] 或 xref:grid-export:actions.adoc#json-export-action[jsonExport] 操作，也可使用 xref:grid-export:exporters.adoc[表格导出器]。

如过使用了自定义生成列，则默认不会导出这些列的内容。参考 xref:grid-export:limitations.adoc#exporting-tables-with-generated-columns[导出带生成列的表格] 中的示例。

下面的例子中，在使用 `excelExport` 操作导出时，为数据的某一列设置了自定义的输出。

界面描述：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=printable-table-start;printable-table-end]
----

界面控制器：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=inject-excel-export;onInit-start;column-value-provider;onInit-end]
----

<1> 该方法一个参数是列标识符，第二个是从列中获取展示值的函数。

== 表格编辑

表格可以配置支持行内编辑。

[[editable]]
用 `editable` 属性可以将表格转换至编辑模式。

[[column-editable]]
在这种模式下，具有 `editable = true` 属性的列显示用于编辑相应实体属性的组件。运行时无法修改此属性设置。

根据相应实体属性的类型自动选择每个可编辑列的组件类型。例如，对于字符串和数字类型的属性，使用 xref:vcl/components/text-field.adoc[TextField]，日期时间 - xref:vcl/components/date-field.adoc[DateField]，枚举 - xref:vcl/components/combo-box.adoc[ComboBox]，实体引用 - xref:vcl/components/entity-picker.adoc[EntityPicker]。

[[column-date-format-resolution]]
对于 `Date` 类型的可编辑列，还可以定义 xref:vcl/components/date-field.adoc#date-format[dateFormat] 或 xref:vcl/components/date-field.adoc#resolution[resolution] 属性，与 `DateField` 中相同属性类似。

[[column-options-container]]
可以为显示关联实体的可编辑列定义 xref:vcl/xml.adoc#options-container[optionsContainer] 和 xref:vcl/xml.adoc#caption-property[captionProperty] 属性。如果设置了 `optionsContainer` 属性，应用程序将使用 `ComboBox` 而不是 `EntityPicker`。

[[context-menu-enabled]]
== 右键菜单

在表格中点击右键可以激活右键菜单。

`contextMenuEnabled` 属性可以开启右键菜单。默认值为 `true`。右键菜单展示 <<actions,表格操作>>（如果有的话）。

image::vcl/components/table-context-menu.png[align="center"]

[[stylename]]
== 样式

可以在界面 XML 或者控制器中使用 `stylename` 属性为 `Table` 组件设置预定义样式：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-borderless]
----

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=table-set-style-name]
----

预定义样式：

* `borderless` - 删除表格外边框；
* `no-header` - 隐藏表格列的表头；
* `no-horizontal-lines` - 删除行之间的水平分隔线；
* `no-vertical-lines` -  删除列之间的垂直分隔线；
* `no-stripes` - 删除行间隔背景色。

`Table` 的外观可以使用带 `$jmix-table-*` 前缀的 SCSS 变量进行自定义。在创建了 xref:themes/custom_theme.adoc[自定义主题] 之后，可以在可视化编辑器中修改这些变量。

[[methods]]
== Table 接口方法

[[methods-get-selected]]
* `getSelected()` 、`getSingleSelected()` 返回表格中的选定行对应的实体实例。调用 `getSelected()` 方法来获取实例集合。如果未选择任何内容，则程序将返回空集。如果禁用了 `multiselect`，应该使用 `getSingleSelected()` 方法返回一个选定实体，如果没有选择任何内容则返回 `null`。

[[methods-request-focus]]
* `requestFocus()` 方法允许将焦点设置在某一行的具体的可编辑字段上。需要两个参数：表示行的实体实例和列的标识符。请求焦点的示例如下：
+
[source,java,indent=0]
----
table.requestFocus(item, "count");
----

[[methods-scroll-to]]
* `scrollTo()` 方法允许将表格滚动到具体行。需要一个参数：表示行的实体实例。
+
滚动条的示例：
+
[source,java,indent=0]
----
table.scrollTo(item);
----

[[methods-set-item-click-action]]
* `setItemClickAction()` 方法能够定义一个双击表格行时执行的 xref:actions.adoc[操作]。如果未定义此操作，表格将尝试按以下顺序在其操作列表中查找适当的操作：
+
** 由 `shortcut` 属性指定给 *Enter* 键的操作；
** xref:actions/standard-actions/edit-action.adoc[edit] 操作
** xref:actions/standard-actions/view-action.adoc[view] 操作
+
如果找到此操作，并且操作具有 `enabled=true` 属性，则执行该操作。
+
下面示例为 XML 中 id 是 `tableClick` 的 `Table` 组件设置了 `ItemClickAction`：
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=inject-tableClick;onInit-start;item-click-action;onInit-end]
----

[[methods-set-enter-press-action]]
* `setEnterPressAction()` 方法可以定义按下 Enter 键时执行的操作。如果未定义此操作，则表将尝试按以下顺序在其操作列表中查找适当的操作：
+
** 由 `setItemClickAction()` 方法定义的动作；
** 由 `shortcut` 属性指定给 *Enter* 键的操作；
** xref:actions/standard-actions/edit-action.adoc[edit] 操作；
** xref:actions/standard-actions/view-action.adoc[view] 操作；
+
如果找到此操作，并且操作具有 `enabled=true` 属性，则执行该操作。
+
下面示例为 XML 中 id 是 `tableClick` 的 `Table` 组件设置了 `ItemClickAction`：
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=inject-tableClick;onInit-start;enter-press-action;onInit-end]
----

[[methods-get-aggregation-results]]
* The `getAggregationResults()` 方法返回 <<aggregatable,聚合>> 结果的 map，key 为 `Table` 的列标识符，value 为聚合值。

[[handlers]]
== 事件和处理器

include::../events-hanlers-generation-tip.adoc[]

[[aggregation-distribution-provider]]
=== AggregationDistributionProvider

定义在表格行间按照自定义算法分发聚合值的规则。如果用户在聚合单元格输入值，会根据自定义的算法将值分发到贡献至该聚合值的单元格。只支持 `TOP` 聚合样式。如果要使得聚合单元格可编辑，需要使用 xml 中 `aggregation` 元素的 <<aggregation-editable,editable>> 属性。

当创建 provider 时，应当使用 `AggregationDistributionContext<E>` 对象，包含分发聚合值所需的数据：

* `Column column` 合计或分组聚合值变更的列；
* `Object value` - 新的聚合值；
* `Collection<E> scope` - 一组实体，会受到聚合值的影响；
* `boolean isTotalAggregation` 显示合计聚合值或者分组聚合值。

作为示例，我们考虑一个展示预算的表格。用户创建预算种类，并设置每种预算在收入中需要占百分比。下一步，用户在聚合单元格设置收入的总额，然后会按照不同的种类分发。

界面 XML 描述中表格的配置示例：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-aggregation-distribution-provider]
----

界面控制器示例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=aggregation-distribution-provider]
----

image::vcl/components/table-aggregation-budget.gif[align="center"]

如需以编程的方式注册聚合值分配 provider，使用组件的 `setAggregationDistributionProvider()` 方法。

[[column-collapse-event]]
=== ColumnCollapseEvent

`ColumnCollapseEvent` 当 <<column-visibility,列可见性>> 变更时发送。

下面示例为 XML 中 id 是 `tableCollapsed` 的 `Table` 订阅了该事件：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=column-collapse-event]
----

如需以编程的方式注册事件处理器，使用组件的 `addColumnCollapseListener()` 方法。

[[column-reorder-event]]
=== ColumnReorderEvent

`ColumnReorderEvent` 当用户重排表格列时发送。

下面示例为 XML 中 id 是 `tableReorder` 的 `Table` 订阅了该事件：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=column-reorder-event]
----

如需以编程的方式注册事件处理器，使用组件的 `addColumnReorderListener()` 方法。

[[context-help-icon-click-handler]]
=== ContextHelpIconClickHandler

参阅 xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickHandler]。

// TODO: Спросить у программистов и проверить самой
////
[[default-settings]]
=== DefaultSettings
////

[[empty-state-link-click-handler]]
=== EmptyStateLinkClickHandler

参阅 <<empty-state-click-event,EmptyStateClickEvent>>。

[[icon-provider]]
=== IconProvider

图标 provider 支持在每行的开头加一个图标：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=icon-provider]
----

image::vcl/components/table-icon-provider.png[align="center"]

如需以编程的方式注册图标的 provider，使用组件的 `setIconProvider()` 方法。

[[item-description-provider]]
=== ItemDescriptionProvider

当用户鼠标悬停于某个单元格之上时，内容描述 provider 会生成描述提示框。

下面例子中，我们展示了为 `tableWithDescription` 使用 `ItemDescriptionProvider`：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=item-description-provider]
----

image::vcl/components/table-item-description.gif[align="center"]

[[lookup-select-handler]]
=== LookupSelectHandler

`LookupSelectHandler` 是当用户在查找界面选中一行数据按下 *Enter* 或者双击一行时调用。接收选中的实体集合作为参数。可以定义如下：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=lookup-select-handler]
----

如需以编程的方式注册查找界面选择处理器，使用组件的 `setLookupSelectHandler()` 方法。

[[selection-event]]
=== SelectionEvent

`SelectionEvent` 当选择变更时发送。

下面示例为 XML 中 id 是 `tableSelectEvent` 的 `Table` 订阅了该事件：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=selection-event]
----

如需以编程的方式注册事件处理器，使用组件的 `addSelectionListener()` 方法。

[[style-provider]]
=== StyleProvider

`StyleProvider` 方法可以设置表格单元格显示样式。表格的每一行和每个单元分别调用这个 provider。如果某一行调用该方法，则第一个参数包含该行显示的实体实例，第二个参数为 `null`。如果单元格调用该方法，则第二个参数包含单元格显示的属性的名称。

设置样式的示例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=style-provider]
----

然后应该在应用程序主题中设置的单元格和行样式。有关创建主题的详细信息，请参阅 xref:themes.adoc[主题]。在控制器中定义的 provider 返回的样式名称作为 CSS 选择器。示例：

[source,css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/helium-extended.scss[tags=table-styles]
----

image::vcl/components/table-style-provider.png[align="center"]

如需以编程的方式注册样式 provider，使用组件的 `setStyleProvider()` 方法。

[[xml]]
== XML 属性

include::../xml-studio-tip.adoc[]

=== Table XML 属性
<<aggregatable,aggregatable>> -
<<aggregation-style,aggregationStyle>> -
xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
<<column-control-visible,columnControlVisible>> -
<<column-header-visible,columnHeaderVisible>> -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
<<context-menu-enabled,contextMenuEnabled>> -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
<<editable,editable>> -
<<empty-state-link-message,emptyStateLinkMessage>> -
<<empty-state-message,emptyStateMessage>> -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
<<meta-class,metaClass>> -
<<multi-line-cells,multiLineCells>> -
<<multiselect,multiselect>> -
<<reordering-allowed,reorderingAllowed>> -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
<<show-selection,showSelection>> -
<<table-sorting,sortable>> -
<<stylename,stylename>> -
xref:vcl/xml.adoc#tab-index[tabIndex] -
<<text-selection-enabled,textSelectionEnabled>> -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

[[xml-table-elements]]
=== Table XML 元素

<<actions,actions>> -
<<buttons-panel,buttonsPanel>> -
<<columns,columns>> -
<<paging,simplePagination>>

=== Columns XML 属性

<<exclude,exclude>> -
<<include-all,include-all>>

=== Column XML 属性

<<column-alignment,align>> -
<<column-caption,caption>> -
<<column-caption-as-html,captionAsHtml>> -
<<caption-property,captionProperty>> -
<<column-collapsed,collapsed>> -
<<column-date-format-resolution,dateFormat>> -
xref:vcl/xml.adoc#description[description] -
<<column-editable,editable>> -
<<column-expand-ratio,expandRatio>> -
<<column-id,id>> -
<<column-link,link>> -
<<column-link-screen-id,linkScreenId>> -
<<column-link-screen-open-mode,linkScreenOpenMode>> -
<<column-max-text-length,maxTextLength>> -
<<column-options-container,optionsContainer>> -
<<column-date-format-resolution,resolution>> -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
<<column-sort,sort>> -
<<column-sortable,sortable>> -
<<column-visible,visible>> -
<<column-width,width>>

=== Column XML 元素

<<aggregatable,aggregation>> -
<<column-formatter,formatter>>

=== Aggregation XML 属性

<<aggregation-editable,editable>> -
<<aggregation-strategy-class,strategyClass>>-
<<aggregation-type,type>> -
<<aggregation-value-description,valueDescription>>

=== Aggregation XML 元素

<<aggregation-formatter,formatter>>

== API

<<methods-get-aggregation-results,getAggregationResults>> -
<<methods-get-selected,getSelected>> -
<<methods-get-selected,getSingleSelected>> -
<<methods-scroll-to,scrollTo>> -
<<methods-set-enter-press-action,setEnterPressAction>> -
<<methods-set-item-click-action,setItemClickAction>> -
<<methods-request-focus,requestFocus>>


= Table

++++
<div class="backoffice-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=table-simple" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Компонент `Table` позволяет выводить информацию в табличном виде, сортировать данные, управлять колонками и заголовками таблицы, вызывать действия для выбранных строк.

XML-имя компонента: `table`.

[[basics]]
== Основы

Ниже представлена типичная таблица:

image::vcl/components/table-anatomy.png[align="center"]

. Строка заголовка
. Строки
. Кнопка управления колонкой
. Разбивка на страницы
. Кнопка сортировки
. Панель кнопок

Ниже представлен пример объявления таблицы в XML-дескрипторе экрана:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=data-start;collection-customers;data-end;layout-start;table;layout-end;]
----

В приведенном примере есть xref:data/collection-container.adoc[контейнер коллекции] для сущности `Customer`. Таблица привязана к контейнеру с помощью атрибута `dataContainer`, в то время как его элемент `columns` определяет, какие атрибуты сущности отображаются в колонках таблицы.

[[data-binding]]
== Привязка к данным

[[declarative-binding]]
=== Декларативная привязка

Обычно компонент `table` привязывается к данным декларативно в XML-дескрипторе экрана, используя атрибут `dataContainer`. Он должен ссылаться на xref:data/collection-container.adoc[контейнер коллекции].

[[using-key-value-containers]]
=== Использование контейнеров Key-Value

Таблицу можно привязать к xref:data/key-value-containers.adoc[контейнеру key-value] для отображения результатов запроса, который возвращает скалярные значения и/или агрегаты. Например:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=data-start;key-value-collection-sales;data-end;layout-start;key-value-table;layout-end;]
----

[[meta-class]]
=== Программная привязка

Если необходимо определить контейнер данных программно в контроллере экрана, установите атрибут xref:vcl/xml.adoc#meta-class[metaClass] вместо xref:vcl/xml.adoc#data-container[dataContainer] в XML-дескрипторе:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=meta-class-table]
----

В контроллере экрана используйте класс `ContainerDataGridItems` для привязки таблицы к контейнеру данных:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=programmatic-binding]
----

[[columns]]
== Columns

Набор колонок таблицы определяется элементом `columns`. Если он не задан, то колонки таблицы будут автоматически взяты из xref:data-access:fetching.adoc#fetch-plan[фетч-плана], определенного в `dataContainer`.

Элемент `columns` имеет следующие атрибуты:

[[include-all]]
* `includeAll` включает все атрибуты из `fetchPlan`, определенного в `dataContainer`.
+
В приведенном ниже примере мы покажем все атрибуты из фетч-плана, используемого в `customersDc`:
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=columns-include-all]
----
+
Если фетч-план сущности содержит ссылочный атрибут, этот атрибут выводится в соответствии с его xref:data-model:entities.adoc#instance-name[именем экземпляра]. Если нужно показать конкретный вложенный атрибут, он должен быть определен в фетч-плане, а также в элементе `column`:
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=data-start;collection-customers-with-country;data-end;layout-start;columns-include-all-reference;layout-end]
----

[[exclude]]
* `exclude` содержит разделенный запятыми список атрибутов, которые не должны быть показаны в `DataGrid`.
+
В приведенном ниже примере мы покажем все атрибуты за исключением `id`, `maritalStatus`, и `email`:
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=columns-exclude]
----

[[column]]
=== Column

Каждая колонка описывается во вложенном элементе `column`.

[[column-id]]
`id` – обязательный атрибут, содержит название атрибута сущности, выводимого в колонке. Может быть как непосредственным атрибутом сущности, находящейся в контейнере, так и атрибутом связанной сущности – переход по графу объектов обозначается точкой. Например:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-column]
----

[[column-alignment]]
=== Выравнивание колонок

Поддерживаются три различных выравнивания колонок: `LEFT` (по умолчанию), `CENTER`, and `RIGHT`.

Как правило, имеет смысл выровнять числа по правому краю и выровнять по левому краю все остальное содержимое. Например:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=key-value-table]
----

image::vcl/components/table-column-align.png[align="center"]

[[column-caption-options]]
=== Заголовок колонки

[[column-caption]]
`caption` - необязательный атрибут, содержит заголовок колонки. Если не задан, будет отображено xref:localization:message-bundles.adoc#localizing-data-model[локализованное название] атрибута сущности.

[[column-caption-as-html]]
`captionAsHtml` - необязательный атрибут, определяющий возможность использовать HTML-теги в заголовке колонки. По умолчанию – `false`.

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-caption-column]
----
<1> Заголовок колонки с HTML-тегами:
+
[source,properties,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/messages.properties[tags=table-column-message]
----
<2> Колонка с заголовком по умолчанию

image::vcl/components/table-captions.png[align="center"]

[[column-visibility]]
=== Видимость колонок

[[column-collapsed]]
`collapsed` - необязательный атрибут, при указании `true` колонка будет изначально скрыта. Пользователи могут управлять видимостью колонки с помощью меню, доступного по нажатию кнопки image:vcl/components/table-column-control-button.png[] в правом верхнем углу таблицы, если атрибут <<column-collapsing-allowed,columnsCollapsingAllowed>> имеет значение `true`. По умолчанию имеет значение `false`.

[[column-visible]]
Атрибут `visible` устанавливает видимость колонки. Возможные значения – `true`, `false`. По умолчанию все колонки видимы.

Рассмотрим разницу между атрибутами `collapsed` и `visible` в следующем примере.

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-collapsed-column]
----

image::vcl/components/table-columns-visibility.gif[align="center"]

Как можно видеть, колонка `firstName` по умолчанию свернута, но пользователи могут развернуть ее из выпадающего меню кнопки image:vcl/components/table-column-control-button.png[].

В то же время колонка `lastName` не может быть свернута пользователем.

[[column-width]]
=== Ширина колонки

`width` - необязательный атрибут, отвечает за изначальную ширину колонки. Может принимать только числовые значения в пикселах.

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-width-column]
----

image::vcl/components/table-column-width.png[align="center"]

[[column-expand-ratio]]
`expandRatio` - необязательный атрибут, устанавливает соотношение, с которым колонка расширяется. Если хотя бы одной колонке установлено иное значение, все неявные значения игнорируются и учитываются только явно присвоенные. Если одновременно установить атрибуты `width` и `expandRatio`, это вызовет ошибку в приложении.

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-expandRatio-column]
----

image::vcl/components/table-column-expand-ratio.png[align="center"]

Пользователи могут изменять размеры колонок:

image::vcl/components/table-columns-resize.gif[align="center"]

Ширина колонки остается фиксированной только если атрибут `enable` установлен в `false` для всей таблицы.

[[reordering-allowed]]
=== Изменение порядка колонок

`Table` позволяет пользователям менять порядок колонок с помощью перетаскивания.

image::vcl/components/table-columns-reordering.gif[align="center"]

Возможность менять порядок колонок включена по умолчанию. Чтобы отключить ее, задайте для атрибута `reorderingAllowed` значение `false`.

[[link-to-edit-screen]]
=== Ссылка на экран редактора

[[column-link]]
Если установить атрибут `link` в `true`, содержание колонки будет отображено в виде ссылки на экран редактора сущности. Такой подход может применяться для упрощения навигации – пользователи смогут открывать редактор одним кликом по некоторому ключевому атрибуту, например, по имени клиента.

[[column-link-screen-id]]
Атрибут `linkScreenId` содержит идентификатор экрана, который будет открыт при нажатии на ссылку. Если он не задан, фреймворк откроет экран с идентификатором `\{entity_name\}.edit`.

[[column-link-screen-open-mode]]
Атрибут `linkScreenOpenMode` задает режим открытия экрана (`THIS_TAB`, `NEW_TAB`, `NEW_WINDOW`, или `DIALOG`).

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-link-column]
----

image::vcl/components/table-columns-link.gif[align="center"]

[[column-max-text-length]]
=== Максимальная длина текста

`maxTextLength` – необязательный атрибут, позволяет ограничивать количество символов в ячейке. Лишние символы заменяются многоточием. Для просмотра полной записи пользователю надо кликнуть на ее видимую часть.

 Если разница между фактическим и допустимым количеством символов не превышает порог в 10 символов, "лишние" символы не скрываются.

В приведенном ниже примере некоторые ячейки содержат значения длиннее чем `maxTextLength+10` и обрезаются:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-max-text-length]
----

image::vcl/components/table-max-text-length.png[align="center"]

[[column-formatter]]
=== Форматирование текста

Элемент `column` может содержать вложенный элемент xref:vcl/miscellaneous/formatter.adoc[formatter] для представления значения атрибута в виде, отличном от стандартного для данного `Datatype`:

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-column-formatter]
----

[[caption-property]]
=== captionProperty

Атрибут `captionProperty` указывает имя атрибута сущности, который должен быть отображен в колонке вместо указанного в `id`. Например, если имеется связанная сущность `City` с атрибутами `name` и `id`, можно определить следующую колонку:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-captionProperty]
----

В этом случае в колонке будет отображаться `id`, а сортировка колонки будет осуществляться по атрибуту `name`.

image::vcl/components/table-captions.png[align="center"]

[[multi-line-cells]]
== Перенос строк в ячейке

Если атрибуту `multiLineCells` таблицы присвоить значение `true`, то ячейки, содержащие текст с переносами строк, будут отображать его в несколько строк. В таком режиме в веб-клиенте для правильной работы полосы прокрутки все строки текущей страницы таблицы будут загружены веб-браузером сразу, без ленивой загрузки видимой части таблицы. Это необходимо для правильной прокрутки и может повлиять на производительность. По умолчанию атрибут имеет значение `false`.

image::vcl/components/table-multi-line-cell.png[align="center"]

[[selection]]
== Выделение

Компонент `Table` позволяет пользователям выделять одну или несколько строк.

[[single-selection]]
=== Единичный выбор строки

В режиме единичного выбора строки пользователи смогут выделять одну строку за раз. Единичный выбор строки установлен по умолчанию.

[[multiselect]]
=== Множественный выбор

Атрибут `multiselect` включает множественный выбор строк таблицы. Если ему задано значение `true`, то пользователи смогут выделять несколько строк за раз, используя клавиатуру или мышь и зажимая клавиши *Ctrl* или *Shift*. По умолчанию множественный выбор отключен.

[[show-selection]]
=== Видимость выделения

При установленном в `false` атрибуте `showSelection` текущая строка не имеет выделения.

[[text-selection-enabled]]
=== Выделение текста

Атрибут `textSelectionEnabled` определяет, разрешено ли выделение текста в ячейках таблицы. По умолчанию `false`.

== Заполнитель

`Table` позволяет задать позволяет настроить заполнитель в виде сообщения и/или ссылки, отображаемый в случае, если контейнер данных пуст или не задан.

[[empty-state-message]]
Заполнитель-сообщение определяется атрибутом `emptyStateMessage`. Он должен содержать информацию о том, почему таблица пуста.

[[empty-state-link-message]]
Заполнитель-ссылка определяется атрибутом `emptyStateLinkMessage`. В нем должно быть описано действие, которое необходимо выполнить для заполнения таблицы.

Например:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-placeholder]
----

image::vcl/components/table-placeholder.png[align="center"]

[[empty-state-click-event]]
Сгенерируйте `emptyStateLinkClickHandler` для обработки нажатий по ссылке:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=empty-state-link-click-handler]
----

Чтобы создать слушателя нажатий программно, используйте метод компонента `setEmptyStateLinkClickHandler()`.

И `emptyStateMessage`, и `emptyStateLinkMessage` могут загружать сообщения из xref:localization:message-bundles.adoc#using-messages-in-ui[пакета сообщений].

[[column-header-visible]]
== Видимость заголовка

Атрибут `columnHeaderVisible` устанавливает видимость заголовка таблицы. По умолчанию имеет значение `true`.

[[column-control-visible]]
== Управление видимостью колонок

Пользователи могут выбрать, какие колонки будут видимы, используя кнопку управления колонками image:vcl/components/table-column-control-button.png[] в правой части заголовка таблицы.

Отображаемые в данный момент колонки отмечены в выпадающем меню. В нем есть дополнительные пункты:

* `Select all` - показать все колонки;
* `Deselect all` - спрятать все возможные колонки, кроме первой. Первая колонка остается видимой всегда для правильного отображения таблицы.

image::vcl/components/table-column-control-using.png[align="center"]

Если `columnControlVisible` имеет значение `false`, пользователи не смогут скрывать колонки.

[[aggregatable]]
== Агрегация

`Table` поддерживает агрегацию значений в строки.

Поддерживаются следующие операции:

* `SUM` - вычисление суммы;
* `AVG` - вычисление среднего значения;
* `COUNT` - вычисление общего количества;
* `MIN` - вывод минимального значения;
* `MAX` - вывод максимального значения.

Чтобы включить агрегацию для таблицы, необходимо:

. Установить для атрибута `aggregatable` значение `true`.
. Указать элемент `aggregation` для агрегируемых колонок.
+
[[aggregation-type]]
. Указать для элемента `aggregation` атрибут `type`, задающий функцию агрегации.

Агрегированные значения выводятся в дополнительной строке.

[[aggregation-style]]
Атрибут `aggregationStyle` позволяет задать расположение строки агрегации: `TOP` или `BOTTOM`. `TOP` используется по умолчанию.

[NOTE]
====
По умолчанию в агрегируемых колонках поддерживаются только числовые типы данных, такие как `Integer`, `Double`, `Long`, и `BigDecimal`.
====

Пример описания таблицы с агрегацией:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-aggregatable]
----

image::vcl/components/table-aggregation.png[align="center"]

[[aggregation-value-description]]
Атрибут `valueDescription` задает текст всплывающей подсказки, отображаемой при наведении курсора мыши по агрегированному значению. Для операций, перечисленных выше (`SUM`, `AVG`, `COUNT`, `MIN`, `MAX`), всплывающие подсказки уже есть по умолчанию.

[[aggregation-editable]]
Элемент `aggregation` может содержать атрибут `editable`. Установка атрибута в значение `true` совместно с использованием <<aggregation-distribution-provider,AggregationDistributionProvider>> позволяет реализовать функциональность распределения значения агрегируемой ячейки между строками таблицы.

[[aggregation-formatter]]
Для отображения агрегированного значения в виде, отличном от стандартного для данного `Datatype`, для него можно указать xref:vcl/miscellaneous/formatter.adoc[Formatter]:

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-aggregation-format]
----

[[aggregation-strategy-class]]
Элемент `aggregation` может также содержать атрибут `strategyClass`, указывающий класс, реализующий интерфейс `AggregationStrategy`.

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableCustomerHobbyAggregation.java[tags=aggregation-strategy]
----

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-aggregation-strategy]
----

== Сортировка

`Table` позволяет пользователям сортировать данные колонки. Функция сортировки включена по умолчанию.

[[table-sorting]]
Атрибут `sortable` позволяет сортировать данные в таблице. По умолчанию имеет значение `true`. Если сортировка разрешена, при щелчке по заголовку колонки появится image:vcl/components/table-sortable-down.png[]/image:vcl/components/table-sortable-up.png[] значок справа от названия колонки.

[[column-sortable]]
Можно отключить сортировку для конкретной <<column,колонки>>, используя ее атрибут `sortable`.

В примере ниже отключим сортировку по колонке `lastName`:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-sortable-column]
----

[[column-sort]]

Атрибут `sort` элемента `column` позволяющий задать начальную сортировку таблицы по указанной колонке в соответствии с направлением сортировки. Возможные значения:

* `ASCENDING` - сортировка по возрастанию (0 -> 9 -> A -> Z).
* `DESCENDING` -  сортировка по убыванию (Z -> A -> 9 -> 0).

Например:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-sort-column]
----

[CAUTION]
====

В одно и то же время таблица может быть сортирована только по одной колонке. Если установить атрибут `sort` для нескольких колонок или установить для колонки атрибуты `sort` и `sortable="false"` одновременно, это вызовет исключение.
====

[[paging]]
== Разбивка на страницы

Компонент xref:vcl/components/simple-pagination.adoc[] может быть использован внутри `table` для обеспечения разбивки на страницы:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-paging]
----

image::vcl/components/table-pagination.png[align="center"]

В качестве альтернативы можно использовать отдельный компонент xref:vcl/components/pagination.adoc[].

[[actions]]
== Действия Table

Компонент `Table` реализует интерфейс `ActionsHolder` и может содержать настраиваемые действия и xref:actions/standard-actions.adoc#list-actions[стандартные действия со списками].

Действия таблицы определяются во вложенном элементе `actions`.

Если действие имеет название, оно отображается как элемент <<context-menu-enabled,контекстного меню>> таблицы. Кроме того, действие таблицы может быть назначено кнопке, расположенной в любом месте экрана.

[[buttons-panel]]
Для отображения кнопок действий над таблицей данных можно использовать контейнер xref:vcl/containers/buttons-panel.adoc[ButtonsPanel].

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-actions-buttons-panel]
----
<1> Определение стандартного действия `create`.
<2> Определение настраиваемого действия `about`.
<3> Определение контейнера `ButtonsPanel` в таблице.

image::vcl/components/table-actions.png[align="center"]

[[table-column-generation]]
== Генерация колонок

Обработчик `columnGenerator` позволяет задавать собственное отображение данных в колонке.

Этот обработчик вызывается фреймворком для каждой ячейки при рендеринге таблицы. Он получает экземпляр сущности, соответствующий отображаемой строке, и должен вернуть визуальный компонент, который будет отображаться в ячейке.

Обработчик `columnGenerator` для таблицы можно создать с помощью Studio (см. <<handlers,ниже>>) и реализовать его следующим образом:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=column-generator]
----

Если в ячейке необходимо отобразить просто динамически сформированный текст, вместо компонента xref:vcl/components/label.adoc[Label] используйте класс `Table.PlainTextCell`. Это упростит рендеринг и сделает таблицу быстрее:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=column-generator-text]
----

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-generated-columns]
----

`fullName` и `isEmail` являются генерированными колонками.

image::vcl/components/table-generated-columns.png[align="center"]

Если идентификатор колонки указывает на атрибут связанной сущности (то есть содержит точки), то обработчик `columnGenerator` должен быть объявлен как на примере ниже.

* Колонка, ассоциированная с атрибутом связанной сущности:
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=city-column]
----

* Соответствующий обработчик `columnGenerator`:
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=column-generator-linked-column]
----

Чтобы создать генератора колонок программно, используйте метод `addGeneratedColumn()` компонента `Table`. Он принимает два параметра: идентификатор колонки и реализацию интерфейса `Table.ColumnGenerator`. Идентификатор может совпадать с одним из идентификаторов, указанных для колонок таблицы в XML-дескрипторе – в этом случае новая колонка вставляется вместо заданной в XML. Если идентификатор не совпадает ни с одной колонкой, создается новая справа.

Метод `generateCell()` интерфейса `Table. ColumnGenerator` является аналогом описанного выше обработчика `columnGenerator`: он принимает экземпляр сущности, отображаемой в данной строке, и должен вернуть визуальный компонент, который будет отображаться в ячейке.

[[exporting-column-values]]
== Экспорт значений колонок

Чтобы экспортировать содержимое компонента `Table` в виде файла в одном из поддерживаемых форматов, используйте дополнение xref:grid-export:index.adoc[Grid Export Actions].

После установки дополнения вы можете определить для таблицы действие xref:grid-export:actions.adoc#excel-export-action[excelExport] или xref:grid-export:actions.adoc#json-export-action[jsonExport] или использовать xref:grid-export:exporters.adoc[TableExporter].

Если вы используете собственные генерируемые колонки, их содержимое по умолчанию не экспортируется. См. пример в разделе xref:grid-export:limitations.adoc#exporting-tables-with-generated-columns[Экспорт таблиц со сгенерированными колонками].

Ниже приведен пример настройки пользовательского представления данных в колонке при экспорте в файл XLS с помощью действия `excelExport`.

Дескриптор экрана:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=printable-table-start;printable-table-end]
----

Контроллер экрана:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=inject-excel-export;onInit-start;column-value-provider;onInit-end]
----

<1> Метод принимает идентификатор колонки и функцию для получения значения из колонки.

== Редактирование значений

Таблица может быть настроена таким образом, чтобы разрешить внутристрочное редактирование.

[[editable]]
Используйте атрибут `editable` для переключения таблицы в режим редактирования.

[[column-editable]]
В этом режиме в колонках, имеющих атрибут `editable = true`, отображаются компоненты для редактирования значений атрибутов соответствующей сущности. Изменение этого атрибута во время выполнения не поддерживается.

Тип компонента для каждой редактируемой колонки выбирается автоматически на основе типа соответствующего атрибута сущности. Например, для строковых и числовых атрибутов приложение будет использовать xref:vcl/components/text-field.adoc[TextField], для `Date` – xref:vcl/components/date-field.adoc[DateField], для перечислений – xref:vcl/components/combo-box.adoc[ComboBox], для ссылок на другие сущности – xref:vcl/components/entity-picker.adoc[EntityPicker].

[[column-date-format-resolution]]
Для редактируемой колонки типа `Date` можно дополнительно указать атрибуты xref:vcl/components/date-field.adoc#date-format[dateFormat] или xref:vcl/components/date-field.adoc#resolution[resolution] аналогично описанным для `DateField`.

[[column-options-container]]
Для редактируемой колонки, отображающей связанную сущность, можно дополнительно указать атрибуты xref:vcl/xml.adoc#options-container[optionsContainer] и xref:vcl/xml.adoc#caption-property[captionProperty]. При указании `optionsContainer` приложение будет использовать `ComboBox` вместо `EntityPicker`.

[[context-menu-enabled]]
== Контекстное меню

Контекстное меню активируется щелчком правой кнопки мыши в таблице данных.

Атрибут `contextMenuEnabled` включает или выключает контекстное меню. По умолчанию имеет значение `true`. В контекстном меню отображаются <<actions,действия таблицы>> (если таковые имеются).

image::vcl/components/table-context-menu.png[align="center"]

[[stylename]]
== Стили

Компоненту `Table` можно задать предопределенные стили с помощью атрибута `stylename` в XML-дескрипторе или в контроллере экрана:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-borderless]
----

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=table-set-style-name]
----

Предопределенные стили:

* `borderless` - удаляет внешнюю рамку;
* `no-header` - скрывает заголовки колонок;
* `no-horizontal-lines` - удаляет горизонтальные строковые разделители;
* `no-vertical-lines` - удаляет вертикальные разделители колонок.
* `no-stripes` - отключает чередование цветов строк таблицы.

Внешний вид компонента `Table` можно настроить с помощью переменных SCSS с префиксом `$jmix-table-*`. Эти переменные можно изменить в визуальном редакторе после создания xref:themes/custom_theme.adoc[новой темы].

[[methods]]
== Методы интерфейса Table

[[methods-get-selected]]
* `getSelected()`, `getSingleSelected()` возвращают экземпляры сущностей, соответствующие выделенным в таблице строкам. Коллекцию можно получить вызовом метода `getSelected()`. Если ничего не выбрано, возвращается пустой набор. Если `multiselect` отключен, удобно пользоваться методом `getSingleSelected()`, возвращающим одну выбранную сущность или `null`, если ничего не выбрано.

[[methods-request-focus]]
* Метод `requestFocus()` позволяет установить фокус на определенное поле конкретной записи. Принимает два параметра: экземпляр сущности, определяющий строку и идентификатор колонки. Пример программной установки фокуса::
+
[source,java,indent=0]
----
table.requestFocus(item, "count");
----

[[methods-scroll-to]]
* Метод `scrollTo()` позволяет программно прокрутить таблицу до нужной записи. Метод принимает экземпляр сущности, определяющий нужную строку в таблице.
+
Пример использования метода:
+
[source,java,indent=0]
----
table.scrollTo(item);
----

[[methods-set-item-click-action]]
* Метод `setItemClickAction()` позволяет задать xref:actions.adoc[действие], выполняемое при двойном клике на строке таблицы. Если такое действие не задано, при двойном клике таблица пытается найти среди своих действий подходящее в следующем порядке:
+
** Действие, назначенное на клавишу *Enter* посредством свойства `shortcut`;
** Действие с именем xref:actions/standard-actions/edit-action.adoc[edit];
** Действие с именем xref:actions/standard-actions/view-action.adoc[view].
+
Если такое действие найдено и имеет свойство `enabled = true`, оно выполняется.
+
Пример задания `ItemClickAction` для компонента `Table`, определенного в XML-файле экрана с идентификатором `tableClick`:
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=inject-tableClick;onInit-start;item-click-action;onInit-end]
----

[[methods-set-enter-press-action]]
* Метод `setEnterPressAction()` позволяет задать действие, выполняемое при нажатии клавиши *Enter*. Если такое действие не задано, таблица пытается найти среди своих действий подходящее в следующем порядке:
+
** Действие, назначенное методом `setItemClickAction()`;
** Действие, назначенное на клавишу *Enter* посредством свойства `shortcut`;
** Действие с именем xref:actions/standard-actions/edit-action.adoc[edit];
** Действие с именем xref:actions/standard-actions/view-action.adoc[view].
+
Если такое действие найдено и имеет свойство `enabled = true`, оно выполняется.
+
Пример задания `ItemClickAction` для компонента `Table`, определенного в XML-файле экрана с идентификатором `tableClick`:
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=inject-tableClick;onInit-start;enter-press-action;onInit-end]
----

[[methods-get-aggregation-results]]
* Метод `getAggregationResults()` возвращает мэп с результатами <<aggregatable,агрегации>>, где ключи в мэп – идентификаторы колонок таблицы, а значения – значения агрегации.

[[handlers]]
== Слушатели и события

include::../events-hanlers-generation-tip.adoc[]

[[aggregation-distribution-provider]]
=== AggregationDistributionProvider

Определяет правила распределения агрегированного значения между ячейками таблицы в соответствии с кастомным алгоритмом. Если пользователь вводит значение в агрегированную ячейку, оно распределяется по составляющим ячейкам. Поддерживается только для стиля агрегации `TOP`. Для того чтобы сделать агрегированные ячейки редактируемыми, используйте атрибут <<aggregation-editable,editable>> элемента `aggregation`.

При создании провайдера используется объект `AggregationDistributionContext<E>`, который содержит данные, необходимые для распределения агрегируемого значения:

* `Column column` − колонка, в которой произошло изменение значения в общей или групповой агрегации;
*  `Object value` − новое значение агрегации;
* `Collection<E> scope` − коллекция сущностей, на которые повлияет изменение значения агрегации;
* `boolean isTotalAggregation` - указывает, в какой агрегации произошли изменения: в общей или групповой.

В качестве примера рассмотрим таблицу, представляющую бюджет. Пользователь создает категории бюджета и задает для каждой из них проценты, в соответствии с которыми должна распределяться сумма дохода. Далее в агрегируемой ячейке указывается общая сумма дохода, после чего происходит распределение по категориям.

Пример настройки таблицы в XML-дескрипторе экрана:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/table/table-screen.xml[tags=table-aggregation-distribution-provider]
----

Пример в контроллере экрана:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=aggregation-distribution-provider]
----

image::vcl/components/table-aggregation-budget.gif[align="center"]

Чтобы создать провайдера программно, используйте метод компонента `setAggregationDistributionProvider()`.

[[column-collapse-event]]
=== ColumnCollapseEvent

`ColumnCollapseEvent` отправляется при изменении <<column-visibility,видимости колонки>>.

Пример подписки на событие таблицы, объявленного в XML с идентификатором `tableCollapsed`:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=column-collapse-event]
----

Чтобы создать слушателя события программно, используйте метод компонента `addColumnCollapseListener()`.

[[column-reorder-event]]
=== ColumnReorderEvent

`ColumnReorderEvent` отправляется при изменении пользователем порядка колонок.

Пример подписки на событие таблицы, объявленного в XML с идентификатором `tableReorder`:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=column-reorder-event]
----

Чтобы создать слушателя события программно, используйте метод компонента `addColumnReorderListener()`.

[[context-help-icon-click-handler]]
=== ContextHelpIconClickHandler

См. xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickHandler].

// TODO: Спросить у программистов и проверить самой
////
[[default-settings]]
=== DefaultSettings
////

[[empty-state-link-click-handler]]
=== EmptyStateLinkClickHandler

См. <<empty-state-click-event,EmptyStateClickEvent>>.

[[icon-provider]]
=== IconProvider

Данный провайдер позволяет добавлять значок в начало каждой строки таблицы:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=icon-provider]
----

image::vcl/components/table-icon-provider.png[align="center"]

Чтобы создать провайдер программно, используйте метод компонента `setIconProvider()`.

[[item-description-provider]]
=== ItemDescriptionProvider

Данный провайдер служит для генерации всплывающих подсказок для ячеек таблицы.

В приведенном ниже примере покажем использование `ItemDescriptionProvider` для `tableWithDescription`:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=item-description-provider]
----

image::vcl/components/table-item-description.gif[align="center"]

[[lookup-select-handler]]
=== LookupSelectHandler

`LookupSelectHandler` – это обработчик, вызываемый, когда пользователь нажимает *Enter* или дважды щелкает по строке таблицы на экране выбора. Он принимает коллекцию выделенных сущностей. Можно определить данный обработчик следующим образом:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=lookup-select-handler]
----

Чтобы создать обработчик программно, используйте метод компонента `setLookupSelectHandler()`.

[[selection-event]]
=== SelectionEvent

`SelectionEvent` отправляется при изменении выделения.

Пример подписки на событие таблицы, объявленного в XML с идентификатором `tableSelectEvent`:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=selection-event]
----

Чтобы создать слушателя события программно, используйте метод компонента `addSelectionListener()`.

[[style-provider]]
=== StyleProvider

`StyleProvider` позволяет задать стиль отображения ячеек таблицы. Провайдер вызывается таблицей отдельно для каждой строки и для каждой ячейки. Если метод вызван для строки, то первый параметр содержит экземпляр сущности, отображаемый этой строкой, а второй параметр `null`. Если же метод вызван для ячейки, то второй параметр содержит имя атрибута, отображаемого этой ячейкой.

Пример задания стилей:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/table/TableScreen.java[tags=style-provider]
----

Далее нужно определить заданные для строк и ячеек стили в теме приложения. Подробная информация о создании темы находится в разделе xref:themes.adoc[Темы]. Имена стилей, возвращаемые провайдером в контроллере должны использоваться как CSS-селекторы. Например:

[source,css,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/helium-extended.scss[tags=table-styles]
----

image::vcl/components/table-style-provider.png[align="center"]

Чтобы создать провайдер программно, используйте метод компонента `setStyleProvider()`.

[[xml]]
== Все XML-атрибуты

include::../xml-studio-tip.adoc[]

=== XML-атрибуты Table
<<aggregatable,aggregatable>> -
<<aggregation-style,aggregationStyle>> -
xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
<<column-control-visible,columnControlVisible>> -
<<column-header-visible,columnHeaderVisible>> -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
<<context-menu-enabled,contextMenuEnabled>> -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
<<editable,editable>> -
<<empty-state-link-message,emptyStateLinkMessage>> -
<<empty-state-message,emptyStateMessage>> -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
<<meta-class,metaClass>> -
<<multi-line-cells,multiLineCells>> -
<<multiselect,multiselect>> -
<<reordering-allowed,reorderingAllowed>> -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
<<show-selection,showSelection>> -
<<table-sorting,sortable>> -
<<stylename,stylename>> -
xref:vcl/xml.adoc#tab-index[tabIndex] -
<<text-selection-enabled,textSelectionEnabled>> -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

[[xml-table-elements]]
=== XML-элементы Table

<<actions,actions>> -
<<buttons-panel,buttonsPanel>> -
<<columns,columns>> -
<<paging,simplePagination>>

=== XML-атрибуты Columns

<<exclude,exclude>> -
<<include-all,include-all>>

=== XML-атрибуты Column

<<column-alignment,align>> -
<<column-caption,caption>> -
<<column-caption-as-html,captionAsHtml>> -
<<caption-property,captionProperty>> -
<<column-collapsed,collapsed>> -
<<column-date-format-resolution,dateFormat>> -
xref:vcl/xml.adoc#description[description] -
<<column-editable,editable>> -
<<column-expand-ratio,expandRatio>> -
<<column-id,id>> -
<<column-link,link>> -
<<column-link-screen-id,linkScreenId>> -
<<column-link-screen-open-mode,linkScreenOpenMode>> -
<<column-max-text-length,maxTextLength>> -
<<column-options-container,optionsContainer>> -
<<column-date-format-resolution,resolution>> -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
<<column-sort,sort>> -
<<column-sortable,sortable>> -
<<column-visible,visible>> -
<<column-width,width>>

=== XML-элементы Column

<<aggregatable,aggregation>> -
<<column-formatter,formatter>>

=== XML-атрибуты Aggregation

<<aggregation-editable,editable>> -
<<aggregation-strategy-class,strategyClass>>-
<<aggregation-type,type>> -
<<aggregation-value-description,valueDescription>>

=== XML-элементы Aggregation

<<aggregation-formatter,formatter>>

== API

<<methods-get-aggregation-results,getAggregationResults>> -
<<methods-get-selected,getSelected>> -
<<methods-get-selected,getSingleSelected>> -
<<methods-scroll-to,scrollTo>> -
<<methods-set-enter-press-action,setEnterPressAction>> -
<<methods-set-item-click-action,setItemClickAction>> -
<<methods-request-focus,requestFocus>>


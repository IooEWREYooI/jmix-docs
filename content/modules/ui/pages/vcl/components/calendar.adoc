= Calendar
:page-aliases: backoffice-ui:vcl/components/calendar.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=calendar-month" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`Calendar - 日历` 组件用来组织和展示日历事件。

image::vcl/components/calendar-week.png[align="center"]

组件的 XML 名称：`calendar`。

[[view-mode]]
== 视图模式

[[start-end-attributes]]
日历组件有三种查看模式，根据 `calendar` 展示日期的范围自动选择，日期范围由 `startDate` 和 `endDate` 属性定义：

1. 月视图 - 当日历范围大于 7 天时。
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/calendar/calendar-screen.xml[tags=monthly-view]
----
+
image::vcl/components/calendar-monthly-view.png[align="center"]

2. 周视图 - 当日历范围大于 1 天，小于 7 天时。
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/calendar/calendar-screen.xml[tags=weekly-view]
----
+
image::vcl/components/calendar-weekly-view.png[align="center"]

3. 日视图 - 当日历范围小于 1 天时。
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/calendar/calendar-screen.xml[tags=single-day-view]
----
+
image::vcl/components/calendar-single-day-view.png[align="center"]

[[navigation-buttons-visible]]
在周视图和日视图模式的 `Calendar` 支持导航按钮，用户可以往前或者往后调整日历。导航按钮默认不可见，通过设置 `navigationButtonsVisible` 属性为 `true` 可以显示。

[[customization]]
== 自定义

默认情况下，`calendar` 展示一周 7 天，每天 24 个小时。如需修改，有以下属性可以配置：

[[first-and-last-visible-day]]
* `firstVisibleDayOfWeek` 和 `lastVisibleDayOfWeek` - 取值范围 `1` ~ `7`，`1` 表示星期日，`7` 表示星期六。

[[first-and-last-visible-hour]]
* `firstVisibleHourOfDay` 和 `lastVisibleHourOfDay` - 取值范围 `1` ~ `23`，`1` 表示 01:00 am，`23` 表示 23:00 pm。

例如，我们可以这样自定义：

1. 当日历以日视图打开时，只展示每天的前半天。
2. 当日历以月视图打开时，每周只展示周二和周三。

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/calendar/calendar-screen.xml[tags=customized-calendar]
----

image::vcl/components/calendar-customized.gif[align="center"]

[[weekly-caption-format]]
还可以使用 `weeklyCaptionFormat` 修改一周每天的标题。`https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html[SimpleDateFormat^]` 类的规则定义 `weeklyCaptionFormat` 值的格式。

[[time-format]]
如需修改时间格式，可以使用 `timeFormat` 属性：

* `24H`
* `12H` - 默认值。

如需修改星期和月的名称，则用 `setDayNames()` 和 `setMonthNames()` 方法，传入新值的映射：

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/calendar/CalendarScreen.java[tags=customized-calendar;init-start;customized-calendar-1;init-end]
----

image::vcl/components/calendar-customized-captions.png[align="center"]

== 日历事件

[[creating-events-programmatically]]
=== 编程式创建事件

1. 如需展示日历事件，可以用 `CalendarEventProvider` 接口的 `addEvent()` 方法为日历添加 `SimpleCalendarEvent`：
+
[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/calendar/CalendarScreen.java[tags=calendar;init-start;direct-adding;init-end]
----

2. 还可以使用 `setEventProvider()` 方法为日历添加 `SimpleCalendarEvent` 对象列表，该方法接收 `ListCalendarEventProvider` 对象作为参数。

3. 如需删除事件，可以用 `CalendarEventProvider` 接口的 `removeEvent()` 或 `removeAllEvents()` 方法。

[[data-aware-events]]
=== 数据感知事件

`CalendarEventProvider` 接口有一个实现是 `ContainerCalendarEventProvider`，通过这个实现可以用数据模型实体填充日历事件。

[[property-attributes]]
使用 `ContainerCalendarEventProvider` 时，事件实体对象必须至少包含两个属性（数据类型为 xref:vcl/components/date-field.adoc#datatype[date 类型] 之一）映射至日历的 `startDateProperty`、`endDateProperty` 属性，以及一个 `String` 类型的属性映射至 `captionProperty` 属性：

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/entity/CustomCalendarEvent.java[tags=custom-event]
----

此外，也可以为 `String` 类型的 `descriptionProperty` 和 `stylenameProperty` 以及 `Boolean` 类型的 `isAllDayProperty` 属性定义映射属性。

示例：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/calendar/calendar-screen.xml[tags=data;layout-start;data-aware-event;layout-end]
----

image::vcl/components/calendar-data-aware.png[align="center"]

[[handlers]]
== 事件和处理器

include::../events-hanlers-generation-tip.adoc[]

include::../eventsandhandlers/ContextHelpIconClickEvent.adoc[]

[[calendar-date-click-event]]
=== CalendarDateClickEvent

当用户时会触发此事件。 clicks on a day number of the month.

编程方式注册该事件监听器，请使用 `addDateClickListener()` 组件方法。

[[calendar-event-click-event]]
=== CalendarEventClickEvent

当用户时会触发此事件。 clicks on the event.

编程方式注册该事件监听器，请使用 `addEventClickListener()` 组件方法。

[[calendar-event-resize-event]]
=== CalendarEventResizeEvent

当用户时会触发此事件。 resizes the event.

编程方式注册该事件监听器，请使用 `addEventResizeListener()` 组件方法。

[[celendar-event-mode-event]]
=== CalendarEventMoveEvent

当用户时会触发此事件。 moves the event.

编程方式注册该事件监听器，请使用 `addEventMoveListener()` 组件方法。

[[calendar-week-click-event]]
=== CalendarWeekClickEvent

当用户点击星期数字时时会触发此事件。

编程方式注册该事件监听器，请使用 `addWeekClickListener()` 组件方法。

[[calendar-forward-click-event]]
=== CalendarForwardClickEvent

当用户点击前进导航按钮时会触发此事件。

编程方式注册该事件监听器，请使用 `addForwardClickListener()` 组件方法。

[[calendar-backward-click-event]]
=== CalendarBackwardClickEvent

当用户后退导航按钮时会触发此事件。

编程方式注册该事件监听器，请使用 `addBackwardClickListener()` 组件方法。

[[calendar-range-select-event]]
=== CalendarRangeSelectEvent

当用户按下鼠标拖拽选择一个时间范围时会触发此事件。

编程方式注册该事件监听器，请使用 `addRangeSelectListener()` 组件方法。

[[calendar-day-click-event]]
=== CalendarDayClickEvent

当用户点击一天内的空闲时间时会触发此事件。

编程方式注册该事件监听器，请使用 `addDayClickListener()` 组件方法。

[[styling]]
== 样式

可以用 CSS 设置日历事件的样式。创建一个 xref:themes/custom_theme.adoc[自定义主题]，然后在 SCSS 文件中按需定义样式名称和参数，示例：

[source,scss,indent=0]
----
include::example$/ex1/src/main/themes/helium-extended/helium-extended.scss[tags=calendar-event-red]
----

然后可以在界面控制器中编程式的设置上面创建的样式了：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/calendar/CalendarScreen.java[tags=style-red]
----

或者用 `stylenameProperty` 属性，在实体中指定一个字段包含创建的样式名作为该属性的映射。

[[xml]]
== Calendar XML 属性

include::../xml-studio-tip.adoc[]

xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
<<property-attributes, captionProperty>> -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
xref:vcl/components/date-field.adoc#datatype[datatype] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
<<property-attributes, descriptionProperty>> -
xref:vcl/xml.adoc#enable[enable] -
<<start-end-attributes, endDate>> -
<<property-attributes, endDateProperty>> -
<<first-and-last-visible-day, firstVisibleDayOfWeek>> -
<<first-and-last-visible-hour, firstVisibleHourOfDay>> -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
<<property-attributes, isAllDayProperty>>
<<first-and-last-visible-day, lastVisibleDayOfWeek>> -
<<first-and-last-visible-hour, lastVisibleHourOfDay>> -
<<navigation-buttons-visible, navigationButtonsVisible>> -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
<<start-end-attributes, startDate>> -
<<property-attributes, startDateProperty>> -
xref:vcl/xml.adoc#stylename[stylename] -
<<property-attributes, stylenameProperty>> -
<<time-format, timeFormat>> -
xref:vcl/xml.adoc#visible[visible] -
<<weekly-caption-format, weeklyCaptionFormat>> -
xref:vcl/xml.adoc#width[width]

= Pagination
:page-aliases: backoffice-ui:vcl/components/pagination.adoc

`Pagination - 分页` 组件用来按页加载数据。支持用户以可预测的性能访问大量数据。

参阅 xref:vcl/components/simple-pagination.adoc[SimplePagination] 组件，有不同的外观，并可用在 `Table`、`DataGrid` 和其他列表组件内部。

组件的 XML 名称：`pagination`。

== 基本用法

`Pagination` 包含页码，用户可以选择特定的页；还有一个下拉列表，用于选择每页展示的条目数。

如需将分页组件与列表组件一起使用，需要将 `Pagination` 组件和列表组件 <<data-binding,绑定>> 至同一数据源。

image::vcl/components/pagination.png[align="center"]

[[data-binding]]
== 数据绑定

如需创建连接至数据的 `Pagination`，使用 `containerProvider` 或 `loaderProvider` 内部属性。

[NOTE]
====
`Pagination` 只能有一个 provider。
====

[[container-provider]]
=== containerProvider

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/pagination/pagination-screen.xml[tags=data-start;customers-collection;data-end;layout-start;pagination-container-provider;layout-end]
----
<1> `Customer` 实体的 `CollectionContainer`。
<2> `Pagination` 组件用内部的 `containerProvider` 元素的 `dataContainer` 属性连接至数据源。

[TIP]
====
如需在 Jmix Studio 中定义 `containerProvider`，可以在界面 XML 或者 *Component Hierarchy* 面板中选择 `Pagination` 组件，然后点击 *Component Inspector* 面板的 xref:studio:screen-designer.adoc#component-inspector-add-button[Add]*->Container Provider* 按钮。
====

[[loader-provider]]
=== loaderProvider

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/pagination/pagination-screen.xml[tags=data-start;cities-collection;data-end;layout-start;pagination-loader-provider;layout-end]
----
<1> `citiesDl` `CollectionLoader` 用 JPQL 查询语句加载实体集合。
<2> `Pagination` 组件用内部的 `loaderProvider` 元素的 `loaderId` 属性连接至数据源。

[TIP]
====
如需在 Jmix Studio 中定义 `loaderProvider`，可以在界面 XML 或者 *Component Hierarchy* 面板中选择 `Pagination` 组件，然后点击 *Component Inspector* 面板的 xref:studio:screen-designer.adoc#component-inspector-add-button[Add]*->Loader Provider* 按钮。
====

[[items-per-page]]
== 每页展示数量

[[items-per-page-visible]]
`Pagination` 有个特殊的 `ComboBox`，用来限定每页展示的条目数。如需展示，设置 `itemsPerPageVisible` 属性为 `true`。默认为 `false`。

image::vcl/components/pagination-items-per-page-combo-box.png[align="center"]

[[items-per-page-options]]
该列表的默认值在 xref:app-properties.adoc#jmix.ui.component.pagination-items-per-page-options[jmix.ui.component.pagination-items-per-page-options] 属性设置。

可以使用 `itemsPerPageOptions` 属性配置自定义的选项列表。属性值需要是英文逗号分隔的选项列表：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/pagination/pagination-screen.xml[tags=items-options]
----

[NOTE]
====
会忽略小于等于 `0` 的选项值；大于实体的最大读取数量值（`jmix.ui.entityMaxFetchSize`）的选项会用该值替换。
====

[[items-per-page-default-value]]
如需设置选项的默认值，可以用 `itemsPerPageDefaultValue` 属性：

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/pagination/pagination-screen.xml[tags=items-options-default]
----

[[items-per-page-unlimited-option-visible]]
`itemsPerPageUnlimitedOptionVisible` 属性设置每页数量 `ComboBox` 中的无限制选项（null）是否展示。如果选中该选项，组件会尝试加载最多 `jmix.ui.entityMaxFetchSize` 条数据。该属性的默认值为 `true`。

[[max-visible-pages]]
== 最大可见页

`Pagination` 组件支持修改最多可看到的页数，使用 `maxVisiblePages` 属性修改。组件可以有很多页，但是用户只能一次看到 `maxVisiblePages` 属性定义的页数。默认为 `5`。例如，我们如果设置 `maxVisiblePages="3"`，则一次只能看到 3 页：

image::vcl/components/pagination-max-visible-pages.png[align="center"]

[[handlers]]
== 事件和处理器

include::../events-hanlers-generation-tip.adoc[]

[[page-change-event]]
=== PageChangeEvent

`PageChangeEvent` 当用户选择另一页，或点击导航按钮（下一页、前一页等）时触发。

下面示例为 XML 中 id 是 `pagination` 的 `Pagination` 订阅了该事件：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/pagination/PaginationScreen.java[tags=page-change-event]
----

如需以编程的方式注册事件处理器，使用组件的 `addPageChangeListener()` 方法。

[[before-refresh-event]]
=== BeforeRefreshEvent

`BeforeRefreshEvent` 当用户点击下一页、前一页，在数据加载之前触发。可以调用 `preventRefresh()` 方法阻止数据容器刷新，示例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/pagination/PaginationScreen.java[tags=before-refresh-event]
----
<1> 检查数据存储中的实体数量。
<2> 阻止刷新数据。

如需以编程的方式注册事件处理器，使用组件的 `addBeforeRefreshListener()` 方法。

[[after-refresh-event]]
=== AfterRefreshEvent

`AfterRefreshEvent` 在数据刷新之后触发。

下面示例为 XML 中 id 是 `paginationWithDefault` 的 `Pagination` 订阅了该事件：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/pagination/PaginationScreen.java[tags=after-refresh-event]
----

如需以编程的方式注册事件处理器，使用组件的 `addAfterRefreshListener()` 方法。

[[total-count-delegate]]
=== TotalCountDelegate

`TotalCountDelegate` 是获取条目总数的处理器。示例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/pagination/PaginationScreen.java[tags=total-count-delegate]
----

`setTotalCountDelegate()` 方法以编程的方式设置 `TotalCountDelegate` 处理器。

[[xml]]
== XML 属性

include::../xml-studio-tip.adoc[]

xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#height[height] -
<<items-per-page-default-value,itemsPerPageDefaultValue>> -
<<items-per-page-options,itemsPerPageOptions>> -
<<items-per-page-unlimited-option-visible,itemsPerPageUnlimitedOptionVisible>> -
<<items-per-page-visible,itemsPerPageVisible>> -
<<max-visible-pages,maxVisiblePages>> -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

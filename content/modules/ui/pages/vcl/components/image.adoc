= Image 图片
:page-aliases: backoffice-ui:vcl/components/image.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=image-url" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`Image - 图片` 组件可以显示不同源的图片。可以绑定到 xref:vcl/xml.adoc#data-container[数据容器] 或通过代码设置。

组件的 XML 名称：`image`。

[[basics]]
== 基本用法

`Image` 图片组件可以显示实体属性为 `FileRef` 或 `byte[]` 类型的数据。

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/entity/Person.java[tags=file-storage-upload-field]
----

最简单的方法是通过 xref:vcl/xml.adoc#data-container[dataContainer] 和 xref:vcl/xml.adoc#property[property] 属性声明式地关联图片：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=data-start;instance;data-end;layout-start;simple-image;layout-end]
----

上面例子中，该组件展示 `personDc` 数据容器中 `Person` 实体的 `image` 属性。

[[resources]]
== 图片源

`Image` 图片组件还可以展示其他源的图片。通过下列内部的 XML 元素设置不同的源类型，或者通过 `setSource()` 方法编程式设置。

[TIP]
====
如需在 Jmix Studio 中定义 `resource`，可以在界面 XML 或者 *Component Hierarchy* 面板中选择组件，然后点击 *Component Inspector* 面板的 xref:studio:screen-designer.adoc#component-inspector-add-button[Add]*->Resource* 按钮。再选择合适的资源。
====

[[classpath-resource]]
=== ClasspathResource

classpath 中的资源。

* XML 中，使用 `classpath` 元素以及 `path` 属性。
+
例如，如果图片位于 `src/main/resources` 下面的 `"ui/ex1/screen/component/image/jmix-logo.png"`，可以这样设置资源：
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=classpath]
----

* Java 中，使用 `ClasspathResource` 接口。
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageResourceScreen.java[tags=image-classpath]
----

[[file-resource]]
=== FileResource

服务器文件系统中的资源。

* XML 中，使用 `file` 元素以及 `path` 属性。
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=file-resource]
----

* Java 中，使用 `FileResource` 接口。
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageResourceScreen.java[tags=image-file-resource]
----

[[file-storage-resource]]
=== FileStorageResource

保存在 xref:files:file-storage.adoc[文件存储] 中的图片

* XML 中，使用 `image` 元素以及 `property` 属性。
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=simple-image]
----

* Java 中，使用 `FileStorageResource` 接口。
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageResourceScreen.java[tags=image-file-storage-resource]
----

[[relative-path-resource]]
=== RelativePathResource

应用程序提供的静态图片。

默认情况下，静态内容存放在 `/static`、`/public`、`/resources` 目录或 classpath 中的 `/META-INF/resources` 目录（详情参阅 https://docs.spring.io/spring-boot/docs/current/reference/html/web.html#web.servlet.spring-mvc.static-content[Spring Boot 文档^]）。

* XML 中，使用 `relativePath` 元素以及 `path` 属性。
+
例如，位于 `src/main/resources/static/images/jmix-icon-login.svg` 的图片可以这样展示：
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=relative-path]
----
+
图片也可以通过 `++http://{host}:{port}/images/jmix-icon-login.svg++` 访问。

* Java 中，使用 `RelativePathResource` 接口。
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageResourceScreen.java[tags=image-relative-path]
----

[[stream-resource]]
=== StreamResource

由 `InputStream` 提供的图片。

* Java 中，使用 `StreamResource` 接口。
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageResourceScreen.java[tags=image-stream]
----

[[theme-resource]]
=== ThemeResource

当前 xref:themes.adoc[主题] 中的图片。

下面示例中，图片位于 `helium-ext` 自定义主题的 `images` 文件夹：

image::vcl/components/images-theme-resources.png[align="center"]

然后可以在 `Image` 组件这样使用：

* XML 中，使用 `theme` 元素以及 `path` 属性。
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=theme-resource]
----

* Java 中，使用 `ThemeResource` 接口。
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageResourceScreen.java[tags=image-theme]
----

[[url-resource]]
=== UrlResource

由任意 URL 提供的图片。

* XML 中，使用 `url` 元素以及 `url` 属性。
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=url-resource]
----

* Java 中，使用 `UrlResource` 接口。
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageResourceScreen.java[tags=image-url]
----

[[resource-settings]]
=== 资源设置

* `bufferSize` - 下载该资源时的缓存大小，以字节为单位。
* `cacheTime` - 该资源缓存过期时间，以毫秒为单位。
* `mimeType` - 该资源的 MIME 类型。

示例：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=mime]
----

[[attributes]]
== 属性

[[alternate-text]]
* `alternateText` - 设置替换文本，当资源未设置或不可用时显示该文本。

[[scale-mode]]
* `scaleMode` - 图片的缩放模式，对应 CSS 中的 `object-fit` 属性，有以下几种模式可选：
** `FILL` - 根据组件大小拉伸图片。
** `CONTAIN` - 保留长宽比压缩图片到能刚好在组件中全部展示。
** `COVER` - 图片会被压缩或者拉升以适应组件的整个区域，维持组件本身的比例。如果图片的比例和组件的比例不匹配，会将图片做裁剪以适配组件的比例。
** `SCALE_DOWN` - 在 `NONE` 和 `CONTAIN` 中选择图片能全部展示并且尺寸最小的方式。
** `NONE` - 图片保持原本大小。

[[methods]]
== 方法

如需以编程的方式管理 `Image` 组件，可以使用下列方法：

* `setValueSource()` - 设置数据容器和实体属性名称，只支持 `FileRef` 和 `byte[]` 两种类型的属性。
+
数据容器可以通过编程的方式设置，比如在单元格中显示图片：
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=data-start;collection;data-end;layout-start;group-table;layout-end]
----
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageScreen.java[tags=value-source]
----

* `setSource()` - 设置图片 <<resources,内容源>>。输入源类型，返回源对象，并继续通过流式接口配置源内容。
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=layout-start;programmatic-image;layout-end]
----
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageScreen.java[tags=set-source]
----

[[handlers]]
== 事件和处理器

include::../events-hanlers-generation-tip.adoc[]

[[click-event]]
=== ClickEvent

参阅 xref:vcl/components/button.adoc#click-event[ClickEvent]。

[[context-help-icon-click-event]]
=== ContextHelpIconClickEvent

参阅 xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickEvent]。

[[source-change-event]]
=== SourceChangeEvent

`SourceChangeEvent` 当图片的资源变化时发送。`SourceChangeEvent` 有下列方法：

* `getNewSource()`
* `getOldSource()`

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageScreen.java[tags=source-change-event]
----

如需以编程的方式注册事件处理器，使用组件的 `addSourceChangeListener()` 方法。

[[xml]]
== XML 属性

include::../xml-studio-tip.adoc[]

=== Image XML 属性

xref:vcl/xml.adoc#align[align] -
<<alternate-text, alternateText>> -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#editable[editable] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
xref:vcl/xml.adoc#property[property] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/xml.adoc#property[property] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/xml.adoc#rowspan[rowspan] -
<<scale-mode, scaleMode>> -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

=== Image XML 元素

<<resources,resource>>

=== Resources XML 元素

<<classpath-resource,classpath>> -
<<file-resource,file>> -
<<relative-path-resource,relativePath>> -
<<theme-resource,theme>> -
<<url-resource,url>>

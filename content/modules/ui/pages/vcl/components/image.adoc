= Image
:page-aliases: backoffice-ui:vcl/components/image.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=image-url" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`Image - 图片` 组件可以显示不同源的图片。可以绑定到 xref:vcl/xml.adoc#data-container[数据容器] 或通过代码设置。

组件的 XML 名称：`image`。

[[basics]]
== 基本用法

`Image` 图片组件可以显示实体属性为 `FileRef` 或 `byte[]` 类型的数据。

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/entity/Person.java[tags=file-storage-upload-field]
----

最简单的方法是通过 xref:vcl/xml.adoc#data-container[dataContainer] 和 xref:vcl/xml.adoc#property[property] 属性声明式地关联图片：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=data-start;instance;data-end;layout-start;simple-image;layout-end]
----

上面例子中，该组件展示 `personDc` 数据容器中 `Person` 实体的 `image` 属性。

[[resources]]
== 图片源

`Image` 图片组件还可以展示其他源的图片。通过以下 `image` 的元素设置不同的源类型：

[[resource-classpath]]
* `classpath` - classpath 中的某个资源。
+
例如，如果资源位于 `"ui/ex1/screen/component/image/jmix-logo.png"`，则声明式设置资源如下：
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=classpath]
----

[[resource-file]]
* `file` - 文件系统中的某个资源。示例：
+
[source,xml,indent=0]
----
            <image>
                <resource>
                    <file path="D:\JMIX\jmix-logo.png"/>
                </resource>
            </image>
----

[[resource-relative-path]]
* `relativePath` - 部署的应用程序目录中的某个资源。
+
如需用相对路径访问资源，需要在 `resource` 根目录创建 `VAADIN` 文件夹。该文件夹里的文件可以用 URL 访问。
+
image::vcl/components/image-relative-path.png[align="center"]
+
然后，声明式设置资源，示例：
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=relative-path]
----
+
生成的相对路径 URL：`++http://localhost:8080/VAADIN/images/jmix-icon-login.svg++`。

[[resource-theme]]
* `theme` - xref:themes.adoc[主题] 资源，例如，对于 `helium-ext` 自定义主题，可以创建 `images` 资源文件夹：
+
image::vcl/components/images-theme-resources.png[align="center"]
+
然后，声明式设置资源，示例：
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=theme-resource]
----

[[resource-url]]
* `url` - 可以从指定 URL 加载的资源。
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=url-resource]
----

另外，支持以编程的方式使用一种 <<resource-types,资源类型>> 设置资源。

[[resource-settings]]
=== 资源设置

* `bufferSize` - 下载该资源时的缓存大小，以字节为单位。
* `cacheTime` - 该资源缓存过期时间，以毫秒为单位。
* `mimeType` - 该资源的 MIME 类型。

示例：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=mime]
----

[[attributes]]
== 属性

[[alternate-text]]
* `alternateText` - 设置替换文本，当资源未设置或不可用时显示该文本。

[[scale-mode]]
* `scaleMode` - 图片的缩放模式，有以下几种模式可选：
** `FILL` - 根据组件大小拉伸图片。
** `CONTAIN` - 保留长宽比压缩图片到能刚好在组件中全部展示。
** `COVER` - 图片会被压缩或者拉升以适应组件的整个区域，维持组件本身的比例。如果图片的比例和组件的比例不匹配，会将图片做裁剪以适配组件的比例。
** `SCALE_DOWN` - 在 `NONE` 和 `CONTAIN` 中选择图片能全部展示并且尺寸最小的方式。
** `NONE` - 图片保持原本大小。

[[methods]]
== 方法

如需以编程的方式管理 `Image` 组件，可以使用下列方法：

* `setValueSource()` - 设置数据容器和实体属性名称，只支持 `FileRef` 和 `byte[]` 两种类型的属性。
+
数据容器可以通过编程的方式设置，比如在单元格中显示图片：
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=data-start;collection;data-end;layout-start;group-table;layout-end]
----
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageScreen.java[tags=value-source]
----

* `setSource()` - 设置图片内容源。输入源类型，返回源对象，并继续通过流式接口配置源内容。
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/image/image-screen.xml[tags=layout-start;programmatic-image;layout-end]
----
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageScreen.java[tags=set-source]
----

[[resource-types]]
=== 资源类型

使用以下实现了 `Resource` 接口的资源类型，或者通过继承实现自定义资源：

* `ClasspathResource` - 位于 classpath 中的图片
* `FileResource` - 位于文件系统中的图片。
* `FileStorageResource` - 位于 xref:files:file-storage.adoc[文件存储] 中的图片。
* `RelativePathResource` - 位于部署的应用程序文件夹的图片。
* `StreamResource` - 来自流的图片。
* `ThemeResource` - 主题图片，例如，`VAADIN/themes/yourtheme/some/path/image.png`。
* `UrlResource` - 使用给定 URL 加载的图片。

[[handlers]]
== 事件和处理器

include::../events-hanlers-generation-tip.adoc[]

[[click-event]]
=== ClickEvent

参阅 xref:vcl/components/button.adoc#click-event[ClickEvent]。

[[context-help-icon-click-event]]
=== ContextHelpIconClickEvent

参阅 xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickEvent]。

[[source-change-event]]
=== SourceChangeEvent

`SourceChangeEvent` 当图片的资源变化时发送。`SourceChangeEvent` 有下列方法：

* `getNewSource()`
* `getOldSource()`

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/image/ImageScreen.java[tags=source-change-event]
----

如需以编程的方式注册事件处理器，使用组件的 `addSourceChangeListener()` 方法。

[[xml]]
== XML 属性

include::../xml-studio-tip.adoc[]

=== Image XML 属性

xref:vcl/xml.adoc#align[align] -
<<alternate-text, alternateText>> -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#editable[editable] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
xref:vcl/xml.adoc#property[property] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/xml.adoc#property[property] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/xml.adoc#rowspan[rowspan] -
<<scale-mode, scaleMode>> -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

=== Image XML 元素

<<resources,resource>>

=== Resources XML 元素

<<resource-classpath,classpath>> -
<<resource-file,file>> -
<<resource-relative-path,relativePath>> -
<<resource-theme,theme>> -
<<resource-url,url>>

= Formatter
:page-aliases: backoffice-ui:vcl/miscellaneous/formatter.adoc

== 基本用法

`Formatter - 格式化器` 用于将某些值转换成字符串类型展示。

[WARNING]
====
// уточнить по поводу этого предупреждения
Formatter 仅能用于只读组件，比如 xref:vcl/components/label.adoc[文本标签]，xref:vcl/components/table.adoc[表格列] 等等。对于可编辑的组件值，比如 xref:vcl/components/text-field.adoc[TextField] 应该用 xref:data-model:data-types.adoc[Datatype] 机制来格式化。
====

在界面的 XML 描述中，组件的 formatter 可以在内部的 `formatter` 元素中定义。

[TIP]
====
如需在 Jmix Studio 中添加内部的 `formatter` 元素，可以在界面 XML 或者 *Jmix UI* 层级结构面板中选择组件或者其内部元素，然后点击 *Jmix UI* 组件面板的 xref:studio:screen-designer.adoc#component-inspector-add-button[Add] 按钮。
====

下面是为 `Table.Column` 组件添加 formatter 的示例：

image::misc/add-formatter.gif[align="center"]

框架包含了一组最常用的 formatter 实现，可以直接在项目中使用。

每个 formatter 都是一个 `Prototype Bean`，如果希望在 Java 代码中使用验证器，需要通过 `ApplicationContext` 来获取。

使用编程的方式给组件设置 formatter 类，调用组件的 `setFormatter()` 方法添加 formatter 的实例。

在界面控制器中编程式设置 formatter 类的示例请参阅 <<setting-formatter-example,数字 formatter>>。

[[number-formatter]]
== 数字 Formatter

数字 formatter 用于将 `Number` 值按照特定格式转换为字符串。

支持下列属性：

* `format` - 设置数字格式的字符串，用来创建 `DecimalFormat` 实例。该值可以是一个格式字符串或者 xref:localization:message-bundles.adoc[消息包] 中的键值。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/formatter/formatter-screen.xml[tags=orders-table-start;number-formatter;orders-table-end]
----

[[setting-formatter-example]]
Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/formatter/FormatterScreen.java[tags=inject-application-context;inject-orders-table;init-start;set-formatter;init-end]
----

<1> 用 `ApplicationContext` 获取 `NumberFormatter` 实例。

[[date-time-formatter]]
== 日期时间 Formatter

日期 formatter 用于将 `Date` 值按照特定格式转换为字符串。

支持下列属性：

* `format` - 设置日期格式的字符串，用来创建 `SimpleDateFormat` 实例。该值可以是一个格式字符串或者 xref:localization:message-bundles.adoc[消息包] 中的键值。
* `type` - 设置 formatter 类型，可取值 `DATE` 或 `DATETIME`。因此，会分别使用 `DateDatatype` 或 `DateTimeDatatype` 类型对值进行格式化。
* `useUserTimezone` - 设置 formatter 是否以当前用户的时区展示日期和时间。默认情况下，`DateFormatter` 以服务器的时区展示日期和时间。如需显示用户的时区，设置 formatter 的 `useUserTimezone` 属性为 `true`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/formatter/formatter-screen.xml[tags=orders-table-start;date-formatter;orders-table-end]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/formatter/FormatterScreen.java[tags=inject-application-context;inject-orders-table;init-start;set-date-formatter;init-end]
----

[[collection-formatter]]
== 集合 Formatter

日期 formatter 用于将集合（Collection）按照特定格式转换为字符串，其中多个元素用逗号分隔。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/formatter/formatter-screen.xml[tags=customers-table-start;collection-formatter;customers-table-end]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/formatter/FormatterScreen.java[tags=inject-application-context;inject-customers-table;init-start;set-collection-formatter;init-end]
----

[[custom-formatter]]
== 自定义 Formatter

可以自定义 Java 类作为 formatter。需实现 `Formatter` 接口。

实现一个自定义 formatter：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/formatter/CurrencyFormatter.java[tags=custom-formatter]
----

在界面 XML 中，自定义 formatter 可以在内部的 `custom` 元素定义：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/formatter/formatter-screen.xml[tags=custom-formatter]
----

在界面控制器中创建自定义 formatter 的示例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/formatter/FormatterScreen.java[tags=inject-customers-table;init-start;set-custom-formatter;init-end]
----

= Validator
:page-aliases: backoffice-ui:vcl/miscellaneous/validator.adoc

== 基本用法

`Validator - 验证器` 用来检查可视化组件中输入的值。

[WARNING]
====
验证和输入检查是需要区分开来的，输入检查是说：假设一个文本组件（比如，xref:vcl/components/text-field.adoc[TextField]）的数据类型设置的不是字符串（这种情况可能出现在绑定实体属性或者手动设置控件的 xref:vcl/components/text-field.adoc#data-type[datatype]），那么这个组件会阻止用户输入不符合它定义的数据类型的值。当这个组件失去焦点时或者用户按了 *回车*，会显示验证错误信息。

但是，验证不会在输入同时或者失去焦点时马上反馈，而是会在组件的 `validate()` 方法调用的时候。也就是说这个组件（还有这个组件绑定的实体属性）暂时会包含一个可能并不符合验证规则的值。但是这没关系，因为需要验证的字段一般都会在编辑界面，所有的字段提交前会自动调用验证方法。如果组件不在一个编辑界面，那么这个组件的 `validate()` 方法需要在界面控制器显式的调用。
====

框架包含了一组最常用的验证器实现，可以直接在项目中使用：

在界面的 XML 描述中，组件的验证器可以在内部的 `validators` 元素中定义。可以通过 Jmix Studio 添加验证器。下面是给 `TextField` 组件添加验证器的例子：

image::misc/validator.gif[align="center"]

有些验证器在错误消息中使用了 Groovy 字符串。这样的话，可以给错误消息传递参数（比如，`++${value}++`）。这些参数会考虑用户的 locale 配置。

每个验证器都是一个 `Prototype Bean`，如果希望在 Java 代码中使用验证器，需要通过 `ApplicationContext` 来获取：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=get-validator]
----

使用编程的方式给组件设置验证类，调用组件的 `addValidator()` 方法添加验证器的实例。

在界面控制器中编程式设置验证器类的示例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=add-predefined-validator]
----

[[custom-validator]]
== 使用自定义验证器

可以使用自定义的 Java 类作为验证器，自定义类需要实现 `Validator` 接口。

创建验证邮编的验证器类：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ZipValidator.java[tags=zip-validator]
----

在界面的 XML 描述中，自定义的验证器可以在内部的 `custom` 元素中定义。

为 `TextField` 组件使用邮编验证器的示例：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=custom-validator]
----

在界面控制器中编程式设置验证器类的示例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=add-validator]
----

[[decimal-max-validator]]
== DecimalMaxValidator

检查值小于等于指定的最大值。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer` 以及使用当前 locale 表示 `BigDecimal` 的 `String` 类型。

支持下列属性：

* `value` - 最大值（必需）；
* `inclusive` - 当设置成 `true` 时，值应当小于或等于指定的最大值。设置成 `false` 时，值应当小于指定的最大值。默认值是 `true`；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 和 `++${max}++` 关键字，用于格式化输出。

默认消息键值：

* `validation.constraints.decimalMaxInclusive`；
* `validation.constraints.decimalMax`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=decimal-max]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField;inject-application-context;decimal-max-validator]
----

[[decimal-min-validator]]
== DecimalMinValidator

检查值大于等于指定的最小值。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer` 以及使用当前 locale 表示 `BigDecimal` 的 `String` 类型。

支持下列属性：

* `value` - 最小值（必需）；
* `inclusive` - 当设置成 `true` 时，值应当大于或等于指定的最小值。设置成 `false` 时，值应当大于指定的最小值。默认值是 `true`；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 和 `++${min}++` 关键字，用于格式化输出。

默认消息键值：

* `validation.constraints.decimalMinInclusive`；
* `validation.constraints.decimalMin`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=decimal-min]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField2;inject-application-context;decimal-min-validator]
----

[[digits-validator]]
== DigitsValidator

检查值是一个指定范围内的数字。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer` 以及使用当前 locale 表示 `BigDecimal` 的 `String` 类型。

支持下列属性：

* `integer` - 整数部分数字的个数（必需）；
* `fraction` - 小数部分数字的个数（必需）；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++`、`++${integer}++` 和 `++${fraction}++` 关键字，用于格式化输出。

默认消息键值：

* `validation.constraints.digits`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=digits-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField3;inject-application-context;digits-validator]
----

[[double-max-validator]]
== DoubleMaxValidator

检查值是否小于或等于指定的最大值。支持的类型：`Double` 以及使用当前 locale 表示 `Double` 值的 `String` 类型。

支持下列属性：

* `value` - 最大值（必需）；
* `inclusive` - 当设置成 `true` 时，值应当小于或等于指定的最大值。设置成 `false` 时，值应当小于指定的最大值。默认值是 `true`；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 和 `++${max}++` 关键字，用于格式化输出。

默认消息键值：

* `validation.constraints.decimalMaxInclusive`；
* `validation.constraints.decimalMax`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=double-max-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField4;inject-application-context;double-max-validator]
----

[[double-min-validator]]
== DoubleMinValidator

检查值大于等于指定的最小值。支持的类型：`Double` 以及使用当前 locale 表示 `Double` 值的 `String` 类型。

支持下列属性：

* `value` - 最小值（必需）;
* `inclusive` - 当设置成 `true` 时，值应当大于或等于指定的最小值。设置成 `false` 时，值应当大于指定的最小值。默认值是 `true`；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 和 `++${min}++` 关键字，用于格式化输出。

默认消息键值：

* `validation.constraints.decimalMinInclusive`；
* `validation.constraints.decimalMin`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=double-min-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField5;inject-application-context;double-min-validator]
----

[[email-validator]]
== EmailValidator

检查 `String` 类型的值是否是电子邮件地址或者包含多个用英文分号、逗号分隔的电子邮件地址。支持类型：`String`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.invalidEmail`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=email-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField23;inject-application-context;email-validator]
----

[[future-or-present-validator]]
== FutureOrPresentValidator

检查日期或时间是否是将来时间或者当前时间。不使用 Groovy 字符串，所以没有参数可用于消息格式化。支持的类型：`java.util.Date`、`LocalDate`、`LocalDateTime`、`LocalTime`、`OffsetDateTime`、`OffsetTime`。

支持下列属性：

* `checkSeconds` - 当设置成 `true` 时，验证器需要使用秒和毫秒比较日期或者时间。默认值是 `false`；
* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.futureOrPresent`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=future-or-present-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-dateTimeField;inject-application-context;future-or-present-validator]
----

[[future-validator]]
== FutureValidator

检查日期或时间是否是将来时间。不使用 Groovy 字符串，所以没有参数可用于消息格式化。支持的类型：`java.util.Date`、`LocalDate`、`LocalDateTime`、`LocalTime`、`OffsetDateTime`、`OffsetTime`。

支持下列属性：

* `checkSeconds` - 当设置成 `true` 时，验证器需要使用秒和毫秒比较日期或者时间。默认值是 `false`；
* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.future`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=future-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-localTimeField;inject-application-context;future-validator]
----

[[max-validator]]
== MaxValidator

检查值是否小于或等于指定的最大值。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`。

支持下列属性：

* `value` - 最大值（必需）;
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 和 `++${max}++` 关键字，用于格式化输出。

默认消息键值：

* `validation.constraints.max`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=max-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField8;inject-application-context;max-validator]
----

[[min-validator]]
== MinValidator

检查值大于等于指定的最小值。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`。

支持下列属性：

* `value` - 最小值（必需）;
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 和 `++${min}++` 关键字，用于格式化输出。

默认消息键值：

* `validation.constraints.min`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=min-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField9;inject-application-context;min-validator]
----

[[negative-or-zero-validator]]
== NegativeOrZeroValidator


检查值小于等于 0。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`、`Double`、`Float`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 关键字，用于格式化输出。注意，`Float` 并没有它自己的数据类型，不会使用用户的 locale 进行格式化。

默认消息键值：

* `validation.constraints.negativeOrZero`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=negative-or-zero-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField10;inject-application-context;negative-or-zero-validator]
----

[[negative-validator]]
== NegativeValidator

检查值严格小于 0。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`、`Double`、`Float`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 关键字，用于格式化输出。注意，`Float` 并没有它自己的数据类型，不会使用用户的 locale 进行格式化。

默认消息键值：

* `validation.constraints.negative`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=negative-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField11;inject-application-context;negative-validator]
----

[[not-blank-validator]]
== NotBlankValidator

检查值至少包含一个非空字符。不使用 Groovy 字符串，所以没有参数可用于消息格式化。支持的类型：`String`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.notBlank`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=not-blank-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField12;inject-application-context;not-blank-validator]
----

[[not-empty-validator]]
== NotEmptyValidator

检查值不是 `null` 也非空。支持的类型：`Collection` 和 `String`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 关键字，用于格式化输出，只对 `String` 类型有效。

默认消息键值：

* `validation.constraints.notEmpty`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=not-empty-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField13;inject-application-context;not-empty-validator]
----

[[not-null-validator]]
== NotNullValidator

检查值不是 `null`。不使用 Groovy 字符串，所以没有参数可用于消息格式化。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.notNull`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=not-null-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField14;inject-application-context;not-null-validator]
----

[[past-or-present-validator]]
== PastOrPresentValidator

检查日期或时间是过去时间或者当前时间。不使用 Groovy 字符串，所以没有参数可用于消息格式化。支持的类型：`java.util.Date`、`LocalDate`、`LocalDateTime`、`LocalTime`、`OffsetDateTime`、`OffsetTime`。

支持下列属性：

* `checkSeconds` - 当设置为 `ture` 时，验证器需要使用秒和毫秒比较日期或者时间。默认值是 `false`；
* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.pastOrPresent`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=past-or-present-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-dateField;inject-application-context;past-or-present-validator]
----

[[past-validator]]
== PastValidator

检查日期或时间是过去时间。不使用 Groovy 字符串，所以没有参数可用于消息格式化。支持的类型：`java.util.Date`、`LocalDate`、`LocalDateTime`、`LocalTime`、`OffsetDateTime`、`OffsetTime`。

支持下列属性：

* `checkSeconds` - 当设置为 `ture` 时，验证器需要使用秒和毫秒比较日期或者时间。默认值是 `false`；
* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.past`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=past-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-dateField16;inject-application-context;past-validator]
----

[[positive-or-zero-validator]]
== PositiveOrZeroValidator

检查值大于等于 0。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`、`Double`、`Float`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 关键字，用于格式化输出。注意，`Float` 并没有它自己的数据类型，不会使用用户的 locale 进行格式化。

默认消息键值：

* `validation.constraints.positiveOrZero`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=positive-or-zero-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField17;inject-application-context;positive-or-zero-validator]
----

[[positive-validator]]
== PositiveValidator

检查值严格大于 0。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`、`Double`、`Float`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 关键字，用于格式化输出。注意，`Float` 并没有它自己的数据类型，不会使用用户的 locale 进行格式化。

默认消息键值：

* `validation.constraints.positive`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=positive-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField18;inject-application-context;positive-validator]
----

[[regexp-validator]]
== RegexpValidator

检查 `String` 的值是否能匹配提供的正则表达式。支持的类型：`String`。

支持下列属性：

* `regexp` - 一个用于匹配的正则表达式（必需）；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++` 关键字，用于格式化输出。

默认消息键值：

* `validation.constraints.regexp`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=regexp-validator]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField18;inject-application-context;regexp-validator]
----

[[size-validator]]
== SizeValidator

检查值在一定范围内。支持的类型：`Collection` 和 `String`。

支持下列属性：

* min - 最小值（含），不能小于 0。默认值是 0；
* max - 最大值（含），不能小于 0。默认值是 `Integer.MAX_VALUE`；
* message - 自定义的消息，在验证失败时展示。该消息可以包含 `++${value}++`（只对 `String` 类型有效），`++${min}++`、`++${max}++` 关键字，用于格式化输出。

默认消息键值：

* `validation.constraints.collectionSizeRange`；
* `validation.constraints.sizeRange`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/validator/validator-screen.xml[tags=size-validator;size-validator2]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/validator/ValidatorScreen.java[tags=inject-numberField20;inject-application-context;size-validator]
----

= Декларативные действия

В XML-дескрипторе экрана для любого компонента, реализующего интерфейс `ActionsHolder`, в том числе для всего экрана или фрагмента, может быть задан набор действий. Это делается в элементе `actions`, который содержит вложенные элементы action.

== Атрибуты Action

Элемент `action` может иметь следующие атрибуты:

* `id` - идентификатор, должен быть уникален в рамках данного компонента `ActionsHolder`.
* `type` - задает тип действия. Если данный атрибут установлен, фреймворк находит класс, имеющий аннотацию `@ActionType` с таким же значением, и использует его для инстанциирования действия. Если тип не задан, фреймворк создает экземпляр класса xref:actions/base-action.adoc[BaseAction]. Раздел xref:actions/standard-actions.adoc[] описывает типы действий, предоставляемые фреймворком, раздел xref:actions/custom-action-type.adoc[] объясняет, как создавать собственные типы действий.
* `caption` - название действия.
* `description` - описание действия.
* `enable` - признак доступности действия. Возможные значения: `true`, `false`.
* `icon` - значок действия.

[[primary]]
* `primary` - атрибут, определяющий подсветку кнопок, обеспечивающих выполнение этого действия. Возможные значения: `true`, `false`. Если выбрано `true`, для подсветки будет использован особый стиль.
+
В темах `hover` and `helium` подсветка доступна по умолчанию; для ее активации в теме `halo` установите значение `true` для xref:themes/custom_theme.adoc#theme-modify-common-parameters[переменной стиля] `$jmix-highlight-primary-action`.
+
Действие стандартного списка `create` и действие `lookupSelectAction` на экране поиска являются `primary` по умолчанию.
+
.Кнопка *Create* с `primary` действием `create`
image::actions/primary-actions.png[align="center"]

* `shortcut` - комбинация клавиш для вызова.
+
Комбинации можно жестко задавать в XML-дескрипторе. Возможные модификаторы – ALT, CTRL, SHIFT – отделяются символом "-". Например:
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/actions/action-screen.xml[tags=action-shortcut]
----
+
Чтобы избежать жестко закодированных значений, для большей гибкости можно использовать готовые псевдонимы комбинаций из списка ниже, например:
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/actions/action-screen.xml[tags=action-predefined-shortcut]
----
+
Поддерживаются следующие предопределенные псевдонимы комбинаций:
+
** `TABLE_EDIT_SHORTCUT`
** `TABLE_INSERT_SHORTCUT`
** `TABLE_ADD_SHORTCUT`
** `TABLE_REMOVE_SHORTCUT`
** `COMMIT_SHORTCUT`
** `CLOSE_SHORTCUT`
** `NEXT_TAB_SHORTCUT`
** `PREVIOUS_TAB_SHORTCUT`
** `PICKER_LOOKUP_SHORTCUT`
** `PICKER_OPEN_SHORTCUT`
** `PICKER_CLEAR_SHORTCUT`
+
Кроме того, есть возможность задавать комбинацию с помощью полного имени класса `UiComponentProperties` и имени метода, возвращающего нужную комбинацию:
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/actions/action-screen.xml[tags=action-shortcut-fully-name]
----
* `visible` - признак видимости действия. Возможные значения: `true`, `false`.

== Примеры

Рассмотрим примеры декларативного объявления действий.

=== Действия экранов

В нижеприведенном примере объявляется действие с идентификатором `sayHello` и названием из пакета сообщений. С этим действием связывается кнопка, заголовок которой будет установлен в название действия.

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/actions/action-screen.xml[tags=window-start;window-actions-start;actions-whole-screen;window-actions-end;layout-start;button-sayHello;layout-end;window-end]
----

Контроллер экрана подписан на событие действия `ActionPerformedEvent`, так что метод `onSayHello()` будет вызван при нажатии на кнопку, а также при нажатии комбинации клавиш *ALT-T*.

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/actions/ActionScreen.java[tags=notifications;say-hello]
----
<1> Аннотация `@Subscribe` содержит id действия.

[NOTE]
====
Обратите внимание, что действия, объявленные на уровне экрана, не обновляют свое состояние. Это значит, если действие имеет установленный `enabledRule`, то он не будет применен пока `refreshState()` не будет вызван вручную.
====

[TIP]
====
Заглушку реализации слушателя `Action.ActionPerformedEvent` можно сгенерировать с помощью xref:studio:index.adoc[Studio].
====

=== Действия PopupButton

В нижеприведенном примере `popupButton` с действиями объявляется в XML-дескрипторе:

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/actions/action-screen.xml[tags=popup-button-actions]
----

Подписка на `ActionPerformedEvent` действия в контроллере экрана:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/actions/ActionScreen.java[tags=notifications;say-hello-goodbye]
----
<1> Аннотация `@Subscribe` содержит `id` `PopupButton` и `id` действия, разделенные точкой.

=== Действия Table

В нижеприведенном примере `groupTable` с действиями объявляется в XML-дескрипторе:

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/actions/action-screen.xml[tags=group-table-actions]
----

Здесь помимо стандартных действий таблицы `create`, `edit` и `remove` объявлено действие `copy`. Для этого действия также указан атрибут `trackSelection="true"`, в результате чего действие и связанная с ним кнопка становятся недоступными, если в таблице не выбрана ни одна строка. Это удобно, если действие предназначено для выполнения над текущей выбранной строкой таблицы.

Подписка на `ActionPerformedEvent` действия в контроллере экрана:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/actions/ActionScreen.java[tags=copy-action]
----

=== Действия EntityPicker

В данном примере для компонента xref:vcl/components/entity-picker.adoc[EntityPicker] объявлено стандартное действие `entity_lookup` и дополнительное действие `points`. Атрибут `description` позволяет отображать всплывающую подсказку при наведении мыши на кнопку действия.

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/entitypicker/entityPicker-screen.xml[tags=customAction]
----

Затем реализуйте собственную логику в контроллере экрана, подписавшись на `Action.ActionPerformedEvent`:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/entitypicker/EntityPickerScreen.java[tags=customerEntityPicker;customAction]
----

<1> Аннотация `@Subscribe` содержит `id` `EntityPicker` и `id` действия, разделенные точкой.

== Получение ссылок на действия

Ссылки на любые декларативно объявленные действия можно получить в контроллере экрана либо непосредственно путем инжекции, либо из компонентов, реализующих интерфейс `ActionsHolder`. Это может понадобиться для программной установки свойств действия. Например:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/actions/ActionScreen.java[tags=say-btn-hello;say-btn;before-show]
----
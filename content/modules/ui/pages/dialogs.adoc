= Диалоговые окна

Интерфейс `Dialogs` предназначен для отображения стандартных диалоговых окон. Диалоги – это небольшие окна, используемые для отображения информации и элементов UI поверх остального интерфейса.

Его методы `createMessageDialog()`, `createOptionDialog()` и `createInputDialog()` являются точками входа в fluent API, позволяющий конструировать и отображать диалоги.

Внешний вид диалоговых окон можно настроить с помощью переменных SCSS с префиксом `$jmix-window-modal-*`. Эти переменные можно изменить в визуальном редакторе после создания xref:themes/custom_theme.adoc[новой темы].

[[message-dialog]]
== Диалог сообщения

++++
<div class="backoffice-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=message-dialog" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Самый простой вариант использования диалогового окна – это показ пользователю некоторого сообщения.

image::dialogs/message-dialog.png[align="center"]

В примере ниже диалог отображает сообщение при нажатии кнопки:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-message-dialog]
----

[[msg-dialog-caption]]
Используйте метод `withCaption()`, чтобы задать заголовок диалогового окна.

[[msg-dialog-message]]
Используйте метод `withMessage()`, чтобы передать текст сообщения.

[[msg-dialog-content-mode]]
Используя метод `withContentMode()`, можно определить, как должен отображаться текст сообщения. Существует три предопределенных режима:

* `ContentMode.TEXT` - текстовые значения отображаются в виде обычного текста.
* `ContentMode.PREFORMATTED` - текстовые значения отображаются в виде предварительно отформатированного текста. В этом режиме новые строки сохраняются при отображении на экран
* `ContentMode.HTML` - текстовые значения интерпретируются и отображаются как HTML. При использовании HTML обязательно экранируйте данные во избежание инжекции вредоносного кода.

В тексте можно использовать символы `\n` для перевода строк. Для отображения HTML необходимо передать параметр `ContentMode.HTML` в метод `withContentMode()`.

[[msg-dialog-html-sanitizer]]
Вы можете передать значение `true` в метод `withHtmlSanitizer()`, чтобы сделать доступной HTML санитизацию для содержимого диалога. Также в этом случае параметр `ContentMode.HTML` должен быть передан в метод `withContentMode().`

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=unsafe-html;inject-dialogs;create-message-dialog-sanitize]
----

Значение, переданное в метод `withHtmlSanitizer()`, имеет приоритет над значением глобального свойства xref:app-properties.adoc#jmix-ui-component-html-sanitizer-enabled[jmix.ui.component.htmlSanitizerEnabled].

Следующие методы позволяют изменить параметры отображения и поведения диалога:

[[msg-dialog-modal]]
* `withModal()` - если передано `false`, диалог отображается как немодальный, что позволяет пользователю взаимодействовать с другими частями приложения. Диалоги являются модальными по умолчанию.

[[msg-dialog-close-on-click-outside]]
* `withCloseOnClickOutside()` - если передано `true` и диалог модальный, то пользователь может закрыть диалог, щелкнув на любой части окна приложения вне диалога.

[[msg-dialog-windowMode]]
* `withWindowMode()` - задает режим диалогового окна. Есть два предопределенных режима:

** `WindowMode.NORMAL` - размер и положение окна определяются его состоянием.
** `WindowMode.MAXIMIZED` - окно расположено в верхнем левом углу и заполняет весь экран.

[[msg-dialog-stylename]]
* Используя метод `withStyleName()`, для диалогового окна можно задать пользовательское имя CSS стиля. Подробнее см. в разделе xref:themes/custom_theme.adoc#creating-new-styles[Создание новых стилей].

[[msg-dialog-width-height]]
* `withWidth()`, `withHeight()` позволяют указать желаемую геометрию диалога.

Например:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-message-dialog-customize]
----

[[option-dialog]]
== Диалог выбора

++++
<div class="backoffice-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=option-dialog" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Диалог выбора отображает некоторое сообщение и набор кнопок для выбора пользователем.

image::dialogs/option-dialog.png[align="center"]

[[opt-dialog-actions]]
Передайте в метод `withActions()` массив xref:actions.adoc[действий], для каждого из которых в диалоге создается кнопка. Например:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-option-dialog]
----

При нажатии на кнопку диалог закрывается и вызывается метод `actionPerform()` соответствующего действия.

В качестве кнопок со стандартными названиями и значками удобно использовать классы, унаследованные от `DialogAction`. Поддерживаются пять видов действий, определяемых перечислением `DialogAction.Type`: `OK`, `CANCEL`, `YES`, `NO`, `CLOSE`. Названия соответствующих кнопок извлекаются из главного пакета локализованных сообщений.

Второй параметр конструктора `DialogAction` используется для задания визуального стиля кнопки, к которой привязано данное действие. Статус `Status.PRIMARY` подсвечивает кнопку и задает ей выделение по умолчанию, что обеспечивается стилем `jmix-primary-action`. Если для диалога задано несколько действий с `Status.PRIMARY`, то фокус и стиль получает только кнопка первого такого действия в списке.

[[input-dialog]]
== Диалог ввода

++++
<div class="backoffice-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=input-dialog" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Диалог ввода – это мощный инструмент для конструирования форм ввода с помощью API, который часто может избавить от необходимости создавать экраны для тривиального ввода данных. Он позволяет вводить значения разнообразных типов, валидировать их и предоставлять различные действия для выбора пользователем.

image::dialogs/input-dialog.png[align="center"]

Рассмотрим несколько примеров.

[[standart-parameters]]
=== Стандартные параметры

В примере ниже представлен диалог ввода с параметрами стандартных типов и стандартными действиями `OK`/`Cancel`:

[source,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-input-dialog]
----
<1> Задает строковый обязательный параметр.
<2> Задает числовой параметр со значением по умолчанию.
<3> Задает параметр типа сущность.
<4> Задает параметр типа перечисление.
<5> Задает набор действий, представляемых кнопками внизу диалога.
<6> В слушателе на закрытие можно определить, какое действие было выбрано пользователем.
<7> Событие закрытия содержит введенные значения, которые можно получить по идентификаторам параметров.

[[custom-parameters]]
=== Нестандартные параметры

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;inject-uiComponents;create-input-dialog-params]
----
<1> Задает нестандартный параметр.
<2> В создаваемом компоненте задается заголовок нестандартного параметра.
<3> Значение нестандартного параметра получается таким же способом, как и стандартного.

[[custom-actions]]
=== Нестандартные действия

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-input-dialog-actions]
----
<1> Метод `withActions()` может принимать массив нестандартных действий.
<2> В обработчике действия можно получить значение параметра из объекта диалога.
<3> Нестандартное действие не закрывает диалог само, поэтому в какой-то момент это надо сделать явно.

[[custom-validator]]
=== Нестандартный валидатор

[source,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-input-dialog-validator]
----
<1> Нестандартный валидатор в данном примере необходим для того, чтобы обеспечить ввод как минимум одного параметра.
<2> Значения параметров в валидаторе можно получить через объект контекста.

[[exception-dialog]]
== Диалог исключения

Это специальный диалог для отображения исключений, содержащий сворачиваемую область с полным стектрейсом исключения.

image::dialogs/exception-dialog.png[align="center"]

Это диалоговое окно используется в обработчике по умолчанию, но вы можете использовать его и для своих исключений, например:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-exception-dialog]
----

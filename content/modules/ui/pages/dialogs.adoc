= 对话框
:page-aliases: backoffice-ui:dialogs.adoc

`Dialogs` 接口用来展示标准对话框窗口。对话框窗口是覆盖于其他界面之上的小窗口，可以展示一些信息或 UI 元素。

其 `createMessageDialog()`、`createOptionDialog()` 和 `createInputDialog()` 方法是流式 API 的入口点，可以用来创建和显示对话框。

`Dialogs` 的外观可以使用带 `$jmix-window-modal-*` 前缀的 SCSS 变量进行自定义。在创建了 xref:themes/custom_theme.adoc[自定义主题] 之后，可以在可视化编辑器中修改这些变量。

[[message-dialog]]
== 消息对话框

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=message-dialog" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

消息对话框的最基本用法是为用户展示一些信息。

image::dialogs/message-dialog.png[align="center"]

下面的例子中，当用户点击按钮时，会显示一个消息对话框：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-message-dialog]
----

[[msg-dialog-caption]]
使用 `withCaption()` 方法设置对话框标题。

[[msg-dialog-message]]
使用 `withMessage()` 方法传递消息文本。

[[msg-dialog-content-mode]]
使用 `withContentMode()` 方法可以定义消息文本的展示方式。有三种预定义的内容模式：

* `ContentMode.TEXT` - 文本值作为纯文本展示。
* `ContentMode.PREFORMATTED` - 文本值作为预格式化文本展示。该模式下，会保留换行并在界面展示。
* `ContentMode.HTML` - 文本值作为 HTML 进行解析和展示。当使用 HTML 时，别忘了转义内容以防恶意代码注入。

可以在消息中使用 `\n` 字符来换行。如果要显示 HTML，可以用 `withContentMode()` 方法带 `ContentMode.HTML` 参数。

[[msg-dialog-html-sanitizer]]
为 `withHtmlSanitizer()` 方法传参 `true` 可以启用对话框内容的 HTML 清理功能。此时，必须为 `withContentMode()` 方法传递 `ContentMode.HTML` 参数。

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=unsafe-html;inject-dialogs;create-message-dialog-sanitize]
----

`withHtmlSanitizer()` 接收的参数会覆盖全局的 xref:app-properties.adoc#jmix-ui-component-html-sanitizer-enabled[jmix.ui.component.htmlSanitizerEnabled] 配置。

使用下面的方法可以自定义消息对话框的外观和行为：

[[msg-dialog-modal]]
* `withModal()` - 如果为 `false`，对话框不以模态窗展示，此时用户可以与应用程序的其他部分交互。对话框默认以模态框展示。

[[msg-dialog-close-on-click-outside]]
* `withCloseOnClickOutside()` - 如果为 `true`，并且窗口是模态展示时，用户可以点击对话框之外的地方来关闭对话框。

[[msg-dialog-windowMode]]
* `withWindowMode()` - 设置对话框窗口的模式。有两种预定义模式：

** `WindowMode.NORMAL` - 窗口大小和位置根据窗口状态确定。
** `WindowMode.MAXIMIZED` - 窗口最大化，左上角对齐后占满整个界面。

[[msg-dialog-stylename]]
* `withStyleName()` 可以为对话框设置自定义的 CSS 样式名称。参阅 xref:themes/custom_theme.adoc#creating-new-styles[创建新样式] 了解详情。

[[msg-dialog-width-height]]
* `withWidth()`、`withHeight()` 支持指定对话框大小。

示例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-message-dialog-customize]
----

[[option-dialog]]
== 选项对话框

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=option-dialog" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

选项对话框展示消息和一组用户交互的按钮。

image::dialogs/option-dialog.png[align="center"]

[[opt-dialog-actions]]
使用 `withActions()` 方法可以为对话框提供 xref:actions.adoc[操作]，每个操作在对话框中以按钮的形式展示。示例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-option-dialog]
----

当按钮被点击时，对话框会关闭并且调用相应操作的 `actionPerform()` 方法。

`DialogAction` 基类可以用来创建带有标准名称和图标的操作。支持五种使用 `DialogAction.Type` 枚举定义的操作类型：`OK`，`CANCEL`，`YES`，`NO`，`CLOSE`。对应的按钮名称通过主语言消息包获取。

`DialogAction` 构造器的第二个参数用来为操作的按钮设置特殊的可视化样式。`c-primary-action` 样式提供的 `Status.PRIMARY` 会高亮对应的按钮并默认选中。如果对话框中有多个操作使用了 `Status.PRIMARY`，只有第一个操作的按钮能使用正确的样式并获得焦点。

[[input-dialog]]
== 输入对话框

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=input-dialog" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

输入对话框是一个多功能的工具，可以使用 API 构建输入表单，摆脱为琐碎的数据输入创建界面的麻烦。支持不同类型数据的输入、验证输入数据以及为用户提供不同的操作。

image::dialogs/input-dialog.png[align="center"]

下面我们看几个例子。

[[standart-parameters]]
=== 标准参数

下面例子中，输入对话框带有标准类型的参数和标准的 `OK`/`Cancel` 操作：

[source,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-input-dialog]
----
<1> 指定一个必填的字符串参数。
<2> 指定一个带有默认值的双浮点参数。
<3> 指定一个实体参数。
<4> 指定一个枚举参数。
<5> 指定一组用按钮表示的操作，放置于对话框底部。
<6> 在关闭事件监听器中，我们可以检查用户使用了什么操作。
<7> 关闭事件包含了输入的值，可以通过参数标识符进行获取。

[[custom-parameters]]
=== 自定义参数

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;inject-uiComponents;create-input-dialog-params]
----
<1> 指定一个自定义参数
<2> 在创建的组件中指定自定义参数的标题。
<3> 跟标准的参数一样的方法获取自定义参数的值。

[[custom-actions]]
=== 自定义操作

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-input-dialog-actions]
----
<1> `withActions()` 方法能接收一组用户自定义的操作。
<2> 在操作处理器中，可以从对话框获取参数值。
<3> 自定义操作不会关闭对话框本身，所以需要同时手动关闭。

[[custom-validator]]
=== 自定义校验

[source,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-input-dialog-validator]
----
<1> 需要自定义 Validator 确保至少输入了一个参数。
<2> 在 Validator 中，参数值可以通过上下文对象获取。

[[exception-dialog]]
== 捕获异常对话框

这是一个特殊的对话框，用于展示后台异常。对话框包含一个可折叠的区域，展示完整的异常堆栈信息。

image::dialogs/exception-dialog.png[align="center"]

此对话框用在默认的处理器中，但是也可以用于自己的异常。示例：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/dialogs/DialogsScreen.java[tags=inject-dialogs;create-exception-dialog]
----

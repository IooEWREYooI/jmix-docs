[[heatmap-layer]]
= 热力图层

热力图层 `HeatMapLayer` 提供一组地理点数据密度的可视化展示。

image::maps-heatmap.png[]

`HeatMapLayer` 可以在 XML 中声明：

[source,xml]
----
<maps:heatmap id="heatmapLayer" dataContainer="ordersDc"/>
----

此外，在界面控制器中可以用 `io.jmix.mapsui.component.layer.HeatMapLayer` 类编程式的创建热力图：

[source,java,indent=0]
----
include::example$/ex1/src/main/java/maps/ex1/screen/order/Heatmap1.java[tags=heatmap-java;end]
----

== 提供数据

热力图的数据可以用下列方法提供数据：

* 使用 `dataContainer`。
+
数据容器内应包含具有 `Point` 类型的 `@Geometry` 属性的几何对象。默认情况下，每个点的强度值等于 `1`。如果强度值需要由其他一些数字类型的属性（例如，`amount`）提供，在指定数据容器的同时指定该属性：
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/maps/ex1/screen/order/heatmap.xml[tags=heatmap-xml]
----
+
* 通过制定 `dataDelegate` 函数，用来构建一组点和强度值的映射：
+
[source,java,indent=0]
----
include::example$/ex1/src/main/java/maps/ex1/screen/order/Heatmap2.java[tags=datadelegate;end]
----
NOTE: 点的强度值默认在 `0` 和 `1` 之间。可以在 `maximumIntensity` 属性中设置不同的最大强度值改变这个范围。

== 热力图属性

可以用下列属性自定义热力图的展示：

* `maximumIntensity` — 点强度最大值。默认为 `1`。
* `blur` — 点的模糊大小。默认值是 `15`。
* `radius` — 热力图中每个点的半径，以像素为单位。默认为 `25`。
* `minOpacity` — 表示热力范围的最小透明度。默认为 `0.05`。
* `maxIntensityZoom` — 图中点能达到最大强度的缩放级别（强度与缩放级别相关）。默认与地图的最大缩放级别一致。
* `gradient` — 由一组 `[intensityValue : rgbColor]` 映射定义的渐变色范围。可以在 XML 中这样定义：
+
[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/maps/ex1/screen/order/heatmap.xml[tags=gradient]
----

= ComboBox

++++
<div class="backoffice-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=combobox-simple" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

`ComboBox` позволяет пользователям выбрать один элемент из выпадающего списка. Он поддерживает фильтрацию элементов на основе пользовательского ввода.

XML-имя компонента: `comboBox`.

== Основы

Используйте `ComboBox`, если:

* Пользователям необходимо выбрать один вариант.
* Список должен быть компактным. Это удобно, когда список опций слишком длинный для xref:vcl/components/radio-button-group.adoc[RadioButtonGroup] или xref:vcl/components/single-select-list.adoc[SingleSelectList].
* Пользователям нужна функция фильтрации.

См. также xref:vcl/components/entity-combo-box.adoc[].

По умолчанию Jmix Studio генерирует `ComboBox` при создании экрана редактора сущностей с атрибутом перечисления. Например, сущность `Customer` имеет атрибут `hobby` типа `Hobby`, который представляет собой перечисление.

image::vcl/components/combo-box.png[align="center"]

В следующем примере экран определяет контейнер данных `customerDc` для сущности `Customer`, имеющей атрибут `hobby`. В элементе `comboBox` атрибут `dataContainer` содержит ссылку на контейнер данных `customerDc`, а атрибут `property` ссылается на атрибут сущности `hobby`. В данном случае атрибут сущности является перечислением, и в выпадающем списке отображаются локализованные имена всех значений перечисления.

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=data;data-end;layout-start;basic;layout-end]
----

[[custom-options]]
== Список опций
Список опций `ComboBox` можно задать с помощью методов `setOptionsList()`, `setOptionsMap()` и `setOptionsEnum()`.

=== setOptionsList()
* Метод `setOptionsList()` позволяет задать список опций компонента программно.
+
Сначала объявите компонент в XML-дескрипторе:
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=options-list]
----
+
Затем инжектируйте компонент в контроллер и задайте список опций в методе `onInit()`:
+
[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=options-list;options-list-2;init-end]
----
+
В выпадающем списке компонента будут отображены значения `"Married"`, `"Widowed"`, `"Separated"`, `"Divorced"` и `"Single"`. Выбранный статус будет помещен в атрибут `maritalStatus` сущности, расположенной в контейнере данных `maritalStatus`.

=== setOptionsMap()
* Метод `setOptionsMap()` позволяет явно указать название строки для каждого значения опции.
+
Сначала объявите компонент в XML-дескрипторе:
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=options-map]
----
+
Затем инжектируйте компонент в контроллер и задайте мэп опций в методе `onInit()`:
+
[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=options-map;options-map-2;options-map-3;init-end]
----
+
В выпадающем списке компонента будут отображены строки `"Poor"`, `"Average"`, `"Good"`, `"Excellent"`. Однако значением компонента будет число, соответствующее выбранной строке. Оно будет помещено в атрибут `rating` сущности, находящейся в контейнере данных `orderDc`.

=== setOptionsEnum()
* Метод `setOptionsEnum()` принимает в качестве параметра класс перечисления. Выпадающий список будет содержать локализованные названия значений перечисления, значением компонента будет являться выбранное значение перечисления.
+
[[options-enum]]
+
Самый простой способ задать опции из класса перечисления – использовать атрибут `optionsEnum` в XML-дескрипторе:
+
[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=options-enum]
----

== Пустая строка
[[null-name]]
=== nullName
Если у компонента `ComboBox` не установлен атрибут `required`, и если связанный атрибут сущности не объявлен как обязательный, то в списке опций компонента присутствует пустая строка, при выборе которой компонент возвращает значение `null`. Атрибут `nullName` позволяет задать строку, отображаемую в этом случае вместо пустой. Например:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=null-name]
----

В данном случае вместо пустой строки отобразится строка `(not selected)`, при выборе которой в связанный атрибут сущности подставится значение `null`.

image::vcl/components/combo-box-null-name.png[align="center"]

При программном задании списка опций методом `setOptionsList()` можно передать одну из опций в метод `setNullSelectionCaption()`. Тогда при ее выборе пользователем значением компонента будет `null`.

[[null-option-visible]]
=== nullOptionVisible
XML-атрибут `nullOptionVisible` устанавливает видимость элемента со значением `null` в списке опций. Значение `false` позволяет сделать `ComboBox` необязательным, но без `null` опции. Значение по умолчанию – `true`.

[[filter-mode]]
== Фильтрация опций

`ComboBox` поддерживает фильтрацию элементов. Атрибут `filterMode` задает тип фильтрации опций при вводе пользователя:

* `NO` - `ComboBox` не использует фильтрацию.
* `STARTS_WITH` - `ComboBox` показывает значения, заголовки которых начинаются с введенного текста.
* `CONTAINS` - `ComboBox` показывает значения, заголовки которых содержат введенный текст (используется по умолчанию).

[[text-input-allowed]]
Используйте атрибут `textInputAllowed` для отключения фильтрации:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=disable-text-input]
----

Это может быть удобно для коротких списков. Значение по умолчанию – `true`.

[[paging]]
== Пейджинг

`ComboBox` поддерживает механизм пейджинга, который помогает разбить длинный список элементов на несколько отдельных страниц. Количество страниц определяется размером страницы и количеством элементов в выпадающем списке.

Используйте атрибут `pageLength`, чтобы задать необходимое количество элементов на одной странице.

Если установить для `pageLength` значение 0, пейджинг будет отключен (т.е. все элементы видны).

Значение по умолчанию задано в свойстве xref:app-properties.adoc#jmix-ui-component-combo-box-page-length[jmix.ui.component.comboBoxPageLength].

== Настройка ширины окна

Метод `setPopupWidth()` позволяет установить ширину выпадающего списка, которая передается в метод в виде строки. Используя относительное значение (например, `"50%"`), можно установить ширину выпадающего списка относительно ширины `ComboBox`. По умолчанию эта ширина имеет значение `null`, поэтому ширина выпадающего списка может быть больше ширины компонента, для того чтобы соответствовать содержимому всех отображаемых элементов. Если установить значение `"100%"`, ширина выпадающего списка будет равна ширине `ComboBox`.

[[validators-element]]
== Валидация

Для проверки введенных в компонент `ComboBox` значений можно использовать xref:vcl/miscellaneous/validator.adoc[валидатор] во вложенном элементе `validators`.

[[predefined-validators]]
Для `ComboBox` доступны следующие предопределенные валидаторы:

* xref:vcl/miscellaneous/validator.adoc#custom-validator[CustomValidator]
* xref:vcl/miscellaneous/validator.adoc#decimal-max-validator[DecimalMaxValidator]
* xref:vcl/miscellaneous/validator.adoc#decimal-min-validator[DecimalMinValidator]
* xref:vcl/miscellaneous/validator.adoc#digits-validator[DigitsValidator]
* xref:vcl/miscellaneous/validator.adoc#double-max-validator[DoubleMaxValidator]
* xref:vcl/miscellaneous/validator.adoc#double-min-validator[DoubleMinValidator]
* xref:vcl/miscellaneous/validator.adoc#email-validator[EmailValidator]
* xref:vcl/miscellaneous/validator.adoc#max-validator[MaxValidator]
* xref:vcl/miscellaneous/validator.adoc#min-validator[MinValidator]
* xref:vcl/miscellaneous/validator.adoc#negative-or-zero-validator[NegativeOrZeroValidator]
* xref:vcl/miscellaneous/validator.adoc#negative-validator[NegativeValidator]
* xref:vcl/miscellaneous/validator.adoc#not-blank-validator[NotBlankValidator]
* xref:vcl/miscellaneous/validator.adoc#not-empty-validator[NotEmptyValidator]
* xref:vcl/miscellaneous/validator.adoc#not-null-validator[NotNullValidator]
* xref:vcl/miscellaneous/validator.adoc#positive-or-zero-validator[PositiveOrZeroValidator]
* xref:vcl/miscellaneous/validator.adoc#positive-validator[PositiveValidator]
* xref:vcl/miscellaneous/validator.adoc#regexp-validator[RegexpValidator]
* xref:vcl/miscellaneous/validator.adoc#size-validator[SizeValidator]

В приведенном ниже примере показано использование ``NotEmptyValidator` для `hobbyValidField`:

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/combobox/combobox-screen.xml[tags=validator]
----

[[handling-user-input]]
== Обработка пользовательского ввода

Используйте метод `setEnterPressHandler()`, чтобы позволить пользователям вводить значение, которого нет в изначальном выпадающем списке, и сохранять его, чтобы выбрать элемент позже, не вводя снова:

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=options-list-2;new-option-handler;init-end]
----

`setEnterPressHandler()` вызывается, если пользователь ввел значение и нажал *Enter*. В данном случае новое значение добавляется в список опций и становится доступным для последующего использования.

[[handlers]]
== События и слушатели

include::../events-hanlers-generation-tip.adoc[]

[[context-help-icon-click-handler]]
=== ContextHelpIconClickHandler

См. xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickHandler].

[[enter-press-handler]]
=== EnterPressHandler

См. пример программной регистрации в разделе  <<handling-user-input>> для `ComboBox`.

`EnterPressHandler` может быть предоставлен декларативно с помощью аннотации `@Install` в контроллере экрана. См. пример в разделе xref:vcl/components/entity-combo-box.adoc#handling-user-input[Обработка пользовательского ввода] для `EntityComboBox`.

[[options-caption-filter]]
=== OptionsCaptionFilter

`OptionsCaptionFilter` используется для проверки того, соответствует ли элемент с заданной надписью заданной строке поиска.

В следующем примере введенная пользователем строка поиска проверяется на соответствие надписи элемента с учетом регистра.

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=options-caption-filter]
----

Чтобы задать предикат программно, используйте метод компонента `setOptionsCaptionFilter()`.

[[option-caption-provider]]
=== OptionCaptionProvider

См. xref:vcl/api.adoc#option-caption-provider[OptionCaptionProvider].

[[option-icon-provider]]
=== OptionIconProvider

Каждый элемент выпадающего списка может иметь значок слева. Чтобы установить значки, создайте реализацию интерфейса `HasOptionIconProvider`:

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=icon-combo-box;options-map-2;init-end;icon-map;icon-provider]
----

image::vcl/components/combo-box-icons.png[align="center"]

Чтобы задать функцию, которая предоставляет значок для опций программно, используйте метод компонента `setOptionIconProvider()`.

[[option-image-provider]]
=== OptionImageProvider

Делегирующий метод `OptionImageProvider` позволяет задать изображения для опций, отображаемых компонентом `ComboBox`.

[source, java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=image;options-map-2;image-create;init-end;option-image-provider]
----

Этот делегат возвращает один из xref:vcl/components/image.adoc#resources[типов ресурсов].

image::vcl/components/combo-box-option-image-provider.png[align="center"]

Чтобы создать его программно, используйте метод компонента `setOptionImageProvider()`.

[[option-style-provider]]
=== OptionStyleProvider

См. xref:vcl/api.adoc#option-style-provider[OptionStyleProvider].

[[validator]]
=== Validator

Добавляет экземпляр xref:vcl/miscellaneous/validator.adoc[валидатора] в компонент. `validator` должен выбросить `ValidationException`, если значение недопустимо.

Если вас не устраивают <<predefined-validators,предопределенные валидаторы>>, добавьте свой собственный экземпляр валидатора:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/combobox/ComboBoxScreen.java[tags=validator]
----

[[value-change-event]]
=== ValueChangeEvent

См. xref:vcl/api.adoc#value-change-event[ValueChangeEvent].

[[xml]]
== XML-атрибуты ComboBox

include::../xml-studio-tip.adoc[]

xref:vcl/xml.adoc#align[align] -
xref:vcl/xml.adoc#buffered[buffered] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#editable[editable] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
<<filter-mode,filterMode>> -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#input-prompt[inputPrompt] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
<<null-name,nullName>> -
<<null-option-visible,nullOptionVisible>> -
<<options-enum,optionsEnum>> -
<<paging,pageLength>> -
xref:vcl/xml.adoc#property[property] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
<<text-input-allowed,textInputAllowed>> -
xref:vcl/xml.adoc#tab-index[tabIndex] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

== XML-элемент ComboBox

<<validators-element,validator>>

= Formatter

`Formatter - 格式化器` 用于将某些值转换成字符串类型展示。

WARNING: Formatter 仅能用于只读组件，比如 xref:vc/components/valuePicker.adoc[valuePicker]、xref:vc/components/multiValuePicker.adoc[multiValuePicker] 以及 xref:vc/components/entityPicker.adoc[entityPicker]。对于可编辑的组件值，比如 xref:vc/components/textField.adoc[textField] 应该用 xref:data-model:data-types.adoc[Datatype] 机制来格式化。

在视图的 XML 描述中，组件的格式化器可以在内部的 `formatter` 元素中定义。

TIP: 如需在 Jmix Studio 中添加内部的 `formatter` 元素，可以在视图 XML 或者 Jmix UI 层级结构面板中选择组件或者其内部元素，然后点击 *Jmix UI* 组件面板的 *Add* 按钮。

下面是为 xref:vc/components/valuePicker.adoc[valuePicker] 组件添加格式化器的示例：

image::visual-components/add-formatter.png[align="center",width="607"]

框架包含了一组最常用的格式化器实现，可以直接在项目中使用。

每个格式化器都是一个 `Prototype Bean`，如果希望在 Java 代码中使用格式化器，需要通过 `ApplicationContext` 来获取。

使用编程的方式给组件设置格式化器时，需要调用组件的 `setFormatter()` 方法添加格式化器的实例。

在视图控制器中编程式设置格式化器的示例请参阅 <<number-formatter,数字>> 格式化器部分。

[[number-formatter]]
== 数字

数字格式化器用于将 `Number` 值按照特定格式转换为字符串。

支持下列属性：

* `format` - 设置数字格式的字符串，用来创建 `DecimalFormat` 实例。该值可以是一个格式字符串或者 xref:localization:message-bundles.adoc[消息包] 中的键值。

XML 描述中的用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/formatter/formatter-view.xml[tags=number]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/formatter/FormatterView.java[tags=valueNumberPicker;applicationContext;onInit;setFormatter]
----

[[date-time-formatter]]
== 日期时间

日期格式化器用于将 `Date` 值按照特定格式转换为字符串。

支持下列属性：

* `format` - 设置日期格式的字符串，用来创建 `SimpleDateFormat` 实例。该值可以是一个格式字符串或者 xref:localization:message-bundles.adoc[消息包] 中的键值。
* `type` - 设置格式化器的类型，可取值 `DATE` 或 `DATETIME`。因此，会分别使用 `DateDatatype` 或 `DateTimeDatatype` 类型对值进行格式化。
* `useUserTimezone` - 设置格式化器是否以当前用户的时区展示日期和时间。默认情况下，`DateFormatter` 以服务器的时区展示日期和时间。如需显示用户的时区，设置格式化器的 `useUserTimezone` 属性为 `true`。

XML 描述中的用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/formatter/formatter-view.xml[tags=date]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/formatter/FormatterView.java[tags=valuePicker;applicationContext;onInit;setDateFormatter]
----

[[collection-formatter]]
== 集合

集合格式化器用于将集合（Collection）按照特定格式转换为字符串，其中多个元素用逗号分隔。

[[custom-formatter]]
== 自定义

可以自定义格式化器 Java 类。需实现 `Formatter` 接口。

实现一个自定义格式化器：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/formatters/CurrencyFormatter.java[tags=CurrencyFormatter]
----

在视图 XML 中，自定义格式化器可以在内部的 `custom` 元素定义：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/formatter/formatter-view.xml[tags=withCustomFormatter]
----

在视图控制器中创建自定义格式化器的示例：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/formatter/FormatterView.java[tags=entityPicker;onInit;customFormatter]
----

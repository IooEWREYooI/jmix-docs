= Views

A _view_ is a basic building block of the application UI. It is a root of the hierarchy of visual components and can also contain data components, actions and facets.

A view is defined by a Java class. The class usually has a corresponding XML file called _descriptor_, which defines the view content. So there is a clear separation between declarative layout of components defined in XML and programmatic initialization and event handling logic written in Java.

[[view-classes]]
== View Classes

Jmix provides the following base classes for views:

[plantuml]
....
@startuml

class View {
}

class StandardMainView {
}

class StandardView {
}

class StandardListView {
}

class StandardDetailView {
}

View ^-- StandardMainView
View ^-- StandardView
StandardView ^-- StandardListView
StandardView ^-- StandardDetailView

@enduml
....

[[view]]
=== View

`View` defines the state and behavior of all varieties of existing views.

[[standard-main-view]]
=== StandardMainView

`StandardMainView` is a root application view which is opened after login. It contains the {vaadin-docs}/components/app-layout[AppLayout^] component with the main menu.

image::views/main-view-1.png[align="center"]

[[standard-view]]
=== StandardView

`StandardView` is a base class for regular views. Such views can be shown either inside the main view using navigation to the view URL or in a popup dialog window.

Below is a standard view opened using the `/my-onboarding` URL:

image::views/standard-view-1.png[align="center"]

[[standard-list-view]]
=== StandardListView

`StandardListView` is a base class for CRUD views displaying a list of entities. It can also be used as a lookup view to select entity instances from the list and return them to the caller. A list view usually uses the {vaadin-docs}/components/grid[DataGrid^] or {vaadin-docs}/components/tree-grid[TreeDataGrid^] components.

Below is a list view opened using the `/departments` URL:

image::views/list-view-1.png[align="center"]

The same view opened in a dialog for selecting entities:

image::views/list-view-2.png[align="center"]

[[standard-detail-view]]
=== StandardDetailView

`StandardDetailView` is a base class for CRUD views displaying a single entity instance. A detail view usually uses the {vaadin-docs}/components/form-layout[FormLayout^] component.

Below is a detail view opened using entity id in the URL:

image::views/detail-view-1.png[align="center"]

The same view opened in a dialog:

image::views/detail-view-2.png[align="center"]

[[view-annotations]]
== View Annotations

Annotations on view classes provide information about the views to the framework. Some annotations are applicable to any type of view, some of them can be used only on entity list or detail views.

[[common-annotations]]
=== Common Annotations

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/myonboarding/MyOnboardingView.java[tags=annotations]
----

* `@ViewController` annotation indicates that the class is a view. The value of the annotation is the view id which can be used it to refer to the view from the main menu or when opening the view programmatically.

* `@ViewDescriptor` annotation connects the view class to the XML descriptor. The value of the annotation specifies the path to the descriptor file. If the value contains a file name only, it is assumed that the file is located in the same package as the view class.

* `@com.vaadin.flow.router.Route` defines a URL path for navigation to this view. As long as the view should be opened inside the main view, the `layout` attribute specifies the main view class.

* `@DialogMode` annotation defines parameters of the dialog window when the view is opened as a dialog.

[[list-view-annotations]]
=== List View Annotations

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/department/DepartmentListView.java[tags=annotations]
----

* `@LookupComponent` annotation specifies an id of a UI component to be used for getting a value returned from the lookup.

* `@PrimaryLookupView` annotation indicates that this view is the default lookup view for the specified entity. The annotation has greater priority than the `\{entity_name}.lookup` / `\{entity_name}.list` name convention.

[[detail-view-annotations]]
=== Detail View Annotations

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/department/DepartmentDetailView.java[tags=annotations]
----

* `@EditedEntityContainer` annotation specifies a data container that contains the edited entity.

* `@PrimaryDetailView` annotation indicates that this view is the default detail view for the specified entity. The annotation has greater priority than the `\{entity_name}.edit` name convention.

[[opening-views]]
== Opening Views

A regular (non-main) view can be opened either by navigating to its URL (specified in the `@Route` annotation) or on the current page by opening a dialog window.

When using navigation, the web browser URL reflects the state of the application UI, which allows for _deep linking_. A user of the application can copy and share the URL to provide the link to a specific view and its current state, for example, to the details of a particular entity instance.

The downside of the navigation is the relative complexity of passing parameters to the opened view. They can be passed only in the URL as the {vaadin-docs}/routing/route-parameters[route^] or {vaadin-docs}/routing/additional-guides/query-parameters[query^] parameters. Also, it is impossible to return any values from the view, after it is closed, to the calling code.

When opening a view in a dialog window, the browser URL is not changed, but the opened view instance is available to the calling code. It enables passing any values directly to the view instance and returning results after the view is closed. This approach is used when opening list views for selecting and returning entity instances in lookup fields.

The main menu opens views by navigation. Standard `create` and `edit` actions also open detail views by navigation, but can be configured to use dialogs. The `entity_lookup` standard action always opens a list view in a dialog to be able to get back selected entities.

Below we describe how to open views programmatically in your application code.

[[view-navigators]]
=== ViewNavigators

To open a view by navigating to its URL, inject the `ViewNavigators` bean and use its fluent interface to specify the view class:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=viewNavigators;navigateToView]
----

`navigate()` is the terminal method that performs the navigation.

If you want to return to the calling view after the opened view is closed, invoke the `withBackwardNavigation(true)` method:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=viewNavigators;navigateToViewThenBack]
----

To navigate to a list view, use the `listView()` method accepting the entity class. The list view class will be chosen by <<view-inference-conventions,convention>>. For example:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=viewNavigators;navigateToListView]
----

You can specify the list view id or class explicitly, for example:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=viewNavigators;navigateToListViewWithClass]
----

To navigate to a detail view, use the `detailView()` method, accepting the entity class or a visual component bound to the entity. The list view class will be chosen by <<view-inference-conventions,convention>>.

To create a new entity instance, invoke `newEntity()`. For example:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=viewNavigators;navigateToCreateEntity]
----

To edit an entity instance, invoke `editEntity()`. For example:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=viewNavigators;navigateToEditEntity]
----

You can specify the detail view id or class explicitly using `withViewId()` and `withViewClass()` methods.

TIP: Use `withRouteParameters()` and `withQueryParameters()` methods of the fluent interface to pass parameters to the view opened by navigation.

[[dialog-windows]]
=== DialogWindows

The `DialogWindows` bean provides a fluent interface for opening views in dialog windows. Its terminal methods give access to the opened view instance. It allows you to pass input parameters directly to the view instance and add listeners for getting results back from the opened view after it is closed.

To open a view as a dialog, inject the `DialogWindows` bean and invoke the `view()` method passing the current view and the opened view class to it. Then invoke the `open()` terminal method:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=dialogWindows;openView]
----

If you need to pass parameters to the opened view, invoke the `build()` terminal method, set parameters to the view, then open the window:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=dialogWindows;openViewWithParams]
----

To get a result from the opened view after it is closed, add `AfterCloseEvent` listener to the dialog window:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=dialogWindows;openViewWithParamsAndResults]
----

The `AfterCloseEvent` object contains `CloseAction` passed to the view's `close()` method. For example, when a standard entity detail view is closed with *OK* button, the close action is `save`. You can analyze the close action using the `getCloseAction()` or `closedWith()` methods of the event object.

You can also add `AfterCloseEvent` listener using the fluent interface:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=dialogWindows;openViewWithResults]
----

To select entities from a list view, open the view using the `lookup()` method:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=dialogWindows;openLookupView]
----

Use the `withSelectHandler()` method to provide a lambda which accepts the collection of entity instances selected in the opened view.

To create a new entity instance in a detail view, specify the view class and invoke `newEntity()`. Use `AfterCloseEvent` listener to get the created entity. For example:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=dialogWindows;openDetailViewToCreateEntity]
----

To edit an existing entity in a detail view, provide the instance to edit using the `editEntity()` method:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/sample/SampleView.java[tags=dialogWindows;openDetailViewToEditEntity]
----

You can provide input parameters to list and detail views in the same way as described for the simple view in the beginning of this section: invoke the `build()` terminal method, set parameters to the view, then open the window.

[[view-inference-conventions]]
== View Inference Conventions

A list or detail view can be inferred from the entity class.

When navigating to a list view using `viewNavigators.listView(SomeEntity.class).navigate()`, the framework selects a view in the following order:

. A view with `SomeEntity.list` id.
. A view annotated with `@PrimaryLookupView(SomeEntity.class)`.
. A view with `SomeEntity.lookup` id.

When opening a list view for lookup using `dialogWindows.lookup(this, SomeEntity.class).open()`, the framework selects a view in the following order:

. A view annotated with `@PrimaryLookupView(SomeEntity.class)`.
. A view with `SomeEntity.lookup` id.
. A view with `SomeEntity.list` id.

When navigating to a detail view or opening it in a dialog window, the framework selects a view in the following order:

. A view annotated with `@PrimaryDetailView(SomeEntity.class)`.
. A view with `SomeEntity.detail` id.


= Дизайнер ролей

Studio предоставляет визуальный конструктор для редактирования параметров xref:security:resource-roles.adoc[ресурсных ролей] и их разрешений во время разработки.

include::subscription-note.adoc[]

[[resource-role-designer]]
== Resource Role Designer

Чтобы создать новую ресурсную роль, используйте меню в xref:studio:tool-window.adoc[Окне инструментов Jmix].

image::role-open.png[align="center", width="287"]

В появившемся диалоговом окне введите имя роли и ее код.

image::role-create.png[align="center", width="662"]

Дизайнер ролей интегрирован с редактором кода, который доступен на вкладке *Text*. Вы можете редактировать исходный код напрямую или использовать для создания кода элементы управления дизайнера.

Вкладка *Definition* определяет основные атрибуты роли.

image::role-definition.png[align="center", width="908"]

[NOTE]
====
Код роли используется при назначении роли пользователям, поэтому его не следует изменять после того, как роль была назначена некоторым пользователям.
====

На вкладке *User Interface* вы можете определить разрешения для элементов меню и экранов.

image::role-user-interface.png[align="center", width="903"]

Дерево слева отображает структуру главного меню, экранов, определенных проектом и экранов, унаследованных от фреймворка и дополнений. В группе *All Screens* отображаются все оставшиеся экраны приложений, недоступные напрямую через главное меню. Найти нужный экран можно с помощью поля поиска, расположенного над деревом.

Все пункты меню и экраны по умолчанию запрещены. Выбрав элемент слева и *Allow* в панели справа, вы добавите разрешение на открытие соответствующего пункта меню или экрана.

Используйте панель инструментов над деревом, чтобы развернуть или свернуть его узлы. Кнопка с шестеренкой переключает отображение экранов и пунктов меню, для которых не указаны разрешения.

Флажок *Allow all screens* полезен, если нужно предоставить доступ ко всем экранам или запретить доступ только к некоторым.

На вкладке *Entities* можете определить разрешения CRUD для сущностей и атрибутов сущностей.

image::role-entities.png[align="center", width="903"]

В таблице панели слева отображаются сущности, определенные в проекте, а также унаследованные от фреймворка и дополнений. Список сущностей можно отфильтровать по имени с помощью поля поиска, расположенного над таблицей.

Панель инструментов над сущностями содержит следующие действия:

* *Current project only* – включает отображение унаследованных сущностей.
* *Assigned only* – включает отображение сущностей, не имеющих разрешений.

По умолчанию все операции с сущностями запрещены. Используя флажки в таблице, вы можете разрешить определенные операции для выбранной сущности.

В таблице справа отображаются разрешения атрибутов для выбранной сущности. Все атрибуты сущности по умолчанию запрещены для просмотра и изменения. Установив флажки *View* и *Modify*, вы можете определить необходимый уровень доступа для выбранного атрибута.

Символ подстановки [***] в таблице атрибутов позволяет пометить все атрибуты как доступные для просмотра (*View*) или изменения (*Modify*), включая те атрибуты, которые будут добавлены к выбранной сущности в будущем.

Флажок *Allow all* в таблице сущностей разрешает все операции CRUD и позволяет изменять (*Modify*) все атрибуты, делая выбранную сущность полностью доступной для текущей роли.

[[specific-tab]]
На вкладке *Specific* вы можете определить определенные разрешения.

image::role-specific.png[align="center", width="903"]

Фреймворк использует определенные разрешения для ограничения доступа к различным механизмам. В дереве можно увидеть разрешения, унаследованные от фреймворка и дополнений.

Чтобы добавить разрешение, используйте кнопку "плюс" на панели инструментов над деревом. В поле *Resource* нужно указать имя политики, определенной в вашем проекте. Узнайте, как создать специальную политику, в разделе xref:security:resource-roles.adoc#specific-policy[Специальная политика].

Все специальные политики запрещены по умолчанию. Выберите политику в дереве и разрешите доступ на панели справа.

[[row-level-role-designer]]
== Row-level Role Designer

To create a new row-level role, click *New → Row-level Role* in the xref:studio:tool-window.adoc[Jmix Tool Window].

image::row-level-role-open.png[align="center", width="287"]

Enter role parameters in the appeared dialog.

image::row-level-role-create.png[align="center", width="635"]

[NOTE]
====
Role code is used when assigning the role to users, therefore it should not be changed after the role has been already assigned to some users.
====

Studio will create and open an annotated role interface. To add a xref:security:row-level-roles.adoc#jpql-policy[JPQL policy], click *Add Policy → JPQL Policy* in the top actions panel:

image::add-policy-button.png[align="center", width="566"]

In the *Add JPQL Policy* dialog, specify the policy parameters:

image::add-jpql-policy.png[align="center", width="636"]

Click *OK*.

The created policy will be added to the role interface.

To add a xref:security:row-level-roles.adoc#predicate-policy[predicate policy], click *Add Policy → Predicate Policy* in the top actions panel. In the *Add Predicate Policy* dialog, specify an entity and select the actions for which you want to create predicates:

image::add-predicate-policy.png[align="center", width="515"]
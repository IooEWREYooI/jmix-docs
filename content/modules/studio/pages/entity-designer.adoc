= Дизайнер сущностей

Studio предоставляет визуальный дизайнер для упрощенного создания xref:data-model:entities.adoc[сущностей], поэтому вам не нужно запоминать все правила и аннотации.

[NOTE]
====
Для этой функции требуется https://www.jmix.io/subscription-plans-and-prices/[подписка^] RAD или Enterprise. Если у вас нет подписки, см. как получить xref:studio:subscription.adoc[пробную] версию.
====

[[jpa-entity-designer]]
== JPA Entity Designer

Чтобы создать сущность, используйте меню в xref:studio:tool-window.adoc[Окне инструментов Jmix].

image::entity-tree.png[align="center"]

Появится диалог *New JPA Entity*.

image::entity-create.png[align="center"]

Fill in the fields:

* *Class* - the name of the new class. It must comply with Java name requirements.
* *Package* - the package that the class will reside in. The default value automatically appears in the field. You can change it, and Studio creates the package after you click *OK*.
* *Entity type* - select the type of entity:
** *Entity* - a class to be a data model xref:data-model:entities.adoc#jpa[entity].
** *MappedSuperclass* - a base superclass that is not associated with any particular database table. A such entity class is annotated by xref:data-model:entities.adoc#mapped-superclass[@MappedSuperclass].
** *Embeddable* - an embeddable persistent entity. A such entity class is annotated by `@Embeddable`.
* *Parent* - the class that your new class inherits from.
* *Id type* - select the type of the entity primary key:
** `UUID` - the identifier of the `UUID` type.
** `Long` - the identifier of the `Long` type. It’s highly recommended to add the *UUID* xref:data-model:entities.adoc#has-uuid-trait[trait], as it enables some optimizations and allows you to identify your instances uniquely in a distributed environment.
** `Integer` - the identifier of the `Integer` type. It’s highly recommended to add the *UUID* trait, as it enables some optimizations and allows you to identify your instances uniquely in a distributed environment.
** `String` - the identifier of the `String` type. It’s highly recommended to add the *UUID* trait, as it enables some optimizations and allows you to identify your instances uniquely in a distributed environment. The concrete entity class must have a string field annotated with the `@Id` JPA annotation.
** `Embedded` - the primary key is a composite key. In this case, the concrete entity class has a field of the embeddable type representing the key, annotated with the `@EmbeddedId` JPA annotation.
* *Id value* - in the case of the `UUID` id type, this field is enabled and has the *Generated By Jmix* value. In the general case, the *Id value* dropdown has the values listed below:
** *Generated By Jmix*. The id of the entity has the xref:data-model:entities.adoc#jmix-generated-value[@JmixGeneratedValue] annotation.
** *Identity column* is suitable only for `Integer` and `Long` id types. The id of the entity has the `@GeneratedValue` JPA annotation with the `GenerationType.IDENTITY` strategy. The *Identity column* value is used for the auto-incremented identifiers. It’s highly recommended to add the *UUID* trait, as it enables some optimizations and allows you to identify your instances uniquely in a distributed environment.
** *Assigned by user* - the id is set by the user. It is suitable for `Integer`,  `Long`, `String`, and `Embedded` id types.
* *Id length* appears if the `String` id type is selected. Specify the maximum number of characters. The default value is `255`.
* *Composite id type* appears if the `Embedded` id type is selected. Select the embeddable entity representing a composite key.
* In the *Traits* checkbox group, select the necessary xref:data-model:entities.adoc#traits[traits].

Then click *OK*.

[[entity-editor]]
Для созданной сущности доступен визуальный редактор.

image::entity-designer.png[align="center"]

Studio отображает в редакторе три вкладки. Вместе они образуют визуальный Дизайнер сущностей:

* *Text* содержит исходный код сущности.
* *Designer* показывает структуру сущности. Вы можете добавлять атрибуты сущности, задавать имя экземпляра и валидации с помощью графического интерфейса вместо написания кода Java.
* *Indexes* отображает индексы и позволяет создавать новые.

[[actions-panel]]
=== Actions Panel

The actions panel is located on the top of the entity designer. It provides access to the following actions:

* *Screens* - navigates to existing screens or creates xref:studio:screen-wizard.adoc[new screens] for the current entity.
+
image::entity-designer-create-screen.png[align="center"]
* *Event Listeners* - navigates to existing xref:data-access:entity-events.adoc[event listeners] or creates a new one for the current entity:
+
image::entity-designer-create-listener.png[align="center"]
* *Lifecycle Callbacks* - adds lifecycle callbacks method stubs:
+
image::entity-designer-lifecycle-callbacks.png[align="center"]

[[entity-designer-designer]]
=== Designer Tab

The *Designer* tab shows the entity structure:

image::entity-designer-designer.png[align="center"]

In addition to the fields described in the <<jpa-entity-designer,JPA Entity Designer>> dialog, the *Designer* tab contains the following fields:

* The <<creating-instance-name, Instance name>> dropdown.
* The *DB view* checkbox. Using this checkbox you can map a JPA Entity to the database view. A such entity class is annotated by the xref:data-model:entities.adoc#db-view[@DbView] annotation.
* The *DDL Generation Settings* link button opens the visual constructor of a xref:data-model:entities.adoc#ddl-generation[@DdlGeneration] annotation value:
+
image::ddl-generation.png[align="center"]
* The *Traits* link button opens the dialog containing xref:data-model:entities.adoc#traits[traits]:
+
image::traits.png[align="center"]
* In the *Inheritance* dropdown, you can select the xref:data-model:entities.adoc#inheritance[inheritance] strategy.

The *Attributes* panel contains the actions for managing entity attributes:

* The *Add* (image:add.svg[]) button opens the <<adding-attributes,New Attribute>> dialog.
* Click the *Copy* (image:copy.png[]) button to create a copy of the existing attribute.
* The *Add to Screens* (image:add-attribute-to-screens.svg[]) button opens a dialog that shows all screens that display the current entity. Select the screens that will display the selected attribute.
+
image::attributes-collection-modified.png[align="center"]
* Click the *Remove* (image:remove.png[]) button to remove the selected attribute.
* Use the *Up* (image:move-up.svg[]) / *Down* (image:move-down.svg[]) buttons to reorder the attributes.

The right panel of the entity designer shows the properties of the selected attribute:

* Use the globe (image:main-message-pack.png[]) button next to the *Name* field to set a user-friendly name for the attribute.
* The *Attribute type* and *Type* dropdowns allow you to select the xref:data-model:entities.adoc#attributes[type of entity attribute].

The *Validation* panel is used for defining the constraints of xref:data-model:bean-validation.adoc[bean validation]. Click on the link button next to the selected constraint. The constraint editor opens:

image::email-validation.png[align="center"]

[[entity-designer-text]]
=== Text Tab

In the *Text* tab, you can see the resulting entity class generated by the designer.

image::entity-designer-text.png[align="center"]

If you have an experience with JPA, you will see familiar annotations: `@Entity`, `@Table`, `@Column`, etc. There are also a few annotations specific to Jmix. The most important one is xref:data-model:entities.adoc#jmix-entity[@JmixEntity] on the class header. In general, any POJO can be an entity in Jmix if it is annotated with `@JmixEntity`.

The entity class can be edited manually, and when you switch back to the *Designer* tab, it will reflect the changes. For example, if you remove the `nullable = false` and `@NotNull` from an attribute, the designer will unselect the *Mandatory* checkbox for it.

The actions panel is located on the top of the source code editor. The following actions are added to the actions <<actions-panel,described above>>:

* *Add Attribute* - opens a <<adding-attributes,New Attribute>> dialog.
* *Add Attributes to Screen* - opens an *Add Attributes to Screen* dialog which shows all screens that display the current entity. Select the attributes which should be appended to screens.
+
image::add-attribute-to-screens.png[align="center"]

[[entity-designer-indexes]]
=== Indexes Tab

The *Indexes* tab is used to define xref:data-model:entities.adoc#uniqueness[unique indexes].

image::entity-designer-index.png[align="center"]

To create a new index, click the *New Index* (image:add.svg[]) button in the *Database Indexes* toolbar. Studio will add a row to the indexes list.

Select an entity attribute or a set of attributes in the *Available attributes* list and click the arrow image:arrow-right.svg[] to move it to the *Selected attributes*.

Select the *Unique* and / or *Constraint* checkboxes in the index row.


[[adding-attributes]]
== Добавление атрибутов

Вы можете добавить атрибут, нажав кнопку *Plus* на вкладке *Designer*, и настроить его в появившемся диалоговом окне. В приведенном ниже примере добавлен атрибут `addresses` с `ASSOCIATION` в поле *Attribute type*. В этом случае для xref:data-model:entities.adoc#references[ссылки] "один-ко-многим" необходимо создать обратный атрибут в сущности `Address`.

image::entity-association.png[align="center"]

Кнопка со значком глобуса в правой части поля *Name* позволяет сразу же задать удобное для пользователя имя атрибута. Оно хранится в файле `messages.properties` и используется по умолчанию в компонентах UI.

image::entity-message.png[align="center"]

Кроме того, вы можете вызвать диалоговое окно создания атрибута на вкладке *Text*, нажав кнопку *Add attribute* на верхней панели или во всплывающем окне *Generate*.

image::entity-generate.png[align="center"]

[[creating-instance-name]]
== Создание имени экземпляра

Studio автоматически задает xref:data-model:entities.adoc#instance-name[имя экземпляра] для сущности, когда к ней добавляется атрибут с одним из следующих имен: `name`, `title`, `caption`, `label`, `summary`, `description`, `firstName`, `lastName`, `middleName`.

image::entity-instance-auto.png[align="center"]

Если вы хотите задать другие атрибуты для генерации имени экземпляра, используйте визуальный конструктор. Его можно открыть нажав кнопку со значком карандаша в поле *Instance name*.

image::entity-instance-editor.png[align="center"]

Имя экземпляра также можно создать на вкладке *Text*. Наведите курсор на имя класса, нажмите *Alt+Enter* (⌥↩) и выберите *Add instance name*.

image::entity-instance-text.png[align="center"]

[[dto-designer]]
== DTO Entity Designer

To create a xref:data-model:entities.adoc#dto[DTO entity], click *New* (image:add.svg[]) → *DTO Entity* in the *Jmix Tool Window*. The *New DTO Entity* dialog appears.

image::dto-entity.png[align="center"]

The displayed fields are similar to the <<jpa-entity-designer,JPA entity>> fields. Fill in the fields and click *OK*.

Studio displays two tabs for the created entity.

* *Text* contains the source code of the DTO entity.
* *Designer* shows the entity structure.

[[enumerations]]
== Перечисления

Studio помогает работать с перечислениями, предоставляя набор действий и визуальный конструктор. Используйте меню в Окне инструментов Jmix для создания перечисления.

image::entity-tree.png[align="center"]

После создания перечисления его класс будет открыт в редакторе с двумя вкладками.

image::entity-enum-editor.png[align="center"]

* *Text* содержит исходный код.
* *Designer* показывает дизайнер перечислений, в котором вы можете настроить перечисление и его значения с помощью графического интерфейса вместо написания кода Java.

Используйте таблицу *Values* и связанные с ней кнопки для настройки констант перечисления.

* Колонка *Name* позволяет ввести имя константы перечисления, которое будет использоваться в коде. Его можно переименовать позже, не затрагивая существующие данные в базе данных.
* Колонка *Value* позволяет ввести идентификатор константы перечисления. Это фактическое значение, хранящееся в базе данных.

Кнопка глобуса позволяет задать локализованные надписи для выбранной константы перечисления.

Дизайнер также предоставляет возможность изменять тип идентификатора, используемый перечислением, со `String` на `Integer` и наоборот. Studio мигрирует используемые перечисления в коде. После этого вам нужно изменить значения существующих констант перечисления.

[NOTE]
====
Такая миграция не переносит значения перечисления, уже сохраненные в таблицах базы данных; вам будет нужно реализовать такую миграцию самостоятельно.
====